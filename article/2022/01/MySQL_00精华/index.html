<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.zhaolq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"androidstudio","dark":"androidstudio"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="SQL标准 - 维基百科 ，以SQL为基础的其他延伸语言： Transact-SQL - 维基百科 、 PL-SQL(Oracle) - 维基百科  数据库官方文档https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F; https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F; https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;database&#x2F; Oracle 数据库文档 比较零散，这里">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL_00精华">
<meta property="og:url" content="https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/index.html">
<meta property="og:site_name" content="洋蔥">
<meta property="og:description" content="SQL标准 - 维基百科 ，以SQL为基础的其他延伸语言： Transact-SQL - 维基百科 、 PL-SQL(Oracle) - 维基百科  数据库官方文档https:&#x2F;&#x2F;dev.mysql.com&#x2F;doc&#x2F; https:&#x2F;&#x2F;www.postgresql.org&#x2F;docs&#x2F; https:&#x2F;&#x2F;docs.oracle.com&#x2F;en&#x2F;database&#x2F; Oracle 数据库文档 比较零散，这里">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/image-20250723171109172.png">
<meta property="og:image" content="https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/innodb-architecture-8-0.png">
<meta property="article:published_time" content="2022-01-01T00:00:00.000Z">
<meta property="article:modified_time" content="2022-01-01T00:00:00.000Z">
<meta property="article:author" content="zhaolq">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/image-20250723171109172.png">


<link rel="canonical" href="https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/","path":"article/2022/01/MySQL_00精华/","title":"MySQL_00精华"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MySQL_00精华 | 洋蔥</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">洋蔥</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">贪婪，找不到比这更好的词了，是件好事。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3"><span class="nav-number">1.</span> <span class="nav-text">数据库官方文档</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#jdbc-url%E5%B1%9E%E6%80%A7%E9%85%8D%E7%BD%AE"><span class="nav-number">2.</span> <span class="nav-text">jdbc-url属性配置</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5"><span class="nav-number">3.</span> <span class="nav-text">常用语句</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%A8%E6%88%B7"><span class="nav-number">3.1.</span> <span class="nav-text">用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A8%E5%92%8C%E7%B4%A2%E5%BC%95"><span class="nav-number">3.2.</span> <span class="nav-text">表和索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%9A%E8%AF%9D%E7%9A%84%E8%BF%9E%E6%8E%A5ID%E4%B8%8E%E7%BA%BF%E7%A8%8BID"><span class="nav-number">3.3.</span> <span class="nav-text">会话的连接ID与线程ID</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E8%A7%86%E5%9B%BE"><span class="nav-number">4.</span> <span class="nav-text">常用视图</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%8F%98%E9%87%8F"><span class="nav-number">5.</span> <span class="nav-text">常用变量</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%8F%98%E9%87%8F%E5%92%8C%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F"><span class="nav-number">5.1.</span> <span class="nav-text">系统变量和状态变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E9%95%BF"><span class="nav-number">5.2.</span> <span class="nav-text">运行时长</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5"><span class="nav-number">5.3.</span> <span class="nav-text">连接</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B"><span class="nav-number">5.4.</span> <span class="nav-text">线程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B6%85%E6%97%B6"><span class="nav-number">5.5.</span> <span class="nav-text">超时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%8C%85"><span class="nav-number">5.6.</span> <span class="nav-text">数据包</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E5%8F%A5%E6%95%B0%E9%87%8F"><span class="nav-number">5.7.</span> <span class="nav-text">语句数量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E5%BF%97"><span class="nav-number">5.8.</span> <span class="nav-text">日志</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">5.9.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86"><span class="nav-number">5.10.</span> <span class="nav-text">字符集</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%94%81%E4%B8%8E%E7%AD%89%E5%BE%85"><span class="nav-number">5.11.</span> <span class="nav-text">锁与等待</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F"><span class="nav-number">5.12.</span> <span class="nav-text">网络流量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%93%E5%AD%98"><span class="nav-number">5.13.</span> <span class="nav-text">缓存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%93%E5%AD%98%E6%B1%A0%E5%91%BD%E4%B8%AD%E7%8E%87"><span class="nav-number">5.13.1.</span> <span class="nav-text">缓存池命中率</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E6%96%87%E4%BB%B6%E5%90%88%E5%B9%B6"><span class="nav-number">5.13.2.</span> <span class="nav-text">临时文件合并</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E7%82%B9%E5%8F%98%E9%87%8F%E8%AF%A6%E7%BB%86%E8%A7%A3%E9%87%8A"><span class="nav-number">5.13.3.</span> <span class="nav-text">重点变量详细解释</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8"><span class="nav-number">5.14.</span> <span class="nav-text">临时表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%B4%E6%97%B6%E8%A1%A8%E8%90%BD%E7%9B%98%E7%8E%87"><span class="nav-number">5.14.1.</span> <span class="nav-text">临时表落盘率</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-%E7%89%88%E6%9C%AC%EF%BC%9A%E5%88%9B%E6%96%B0%E5%92%8C-LTS"><span class="nav-number">6.</span> <span class="nav-text">MySQL 版本：创新和 LTS</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-%E7%A8%8B%E5%BA%8F"><span class="nav-number">7.</span> <span class="nav-text">MySQL 程序</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E7%A8%8B%E5%BA%8F%E6%A6%82%E8%BF%B0"><span class="nav-number">7.1.</span> <span class="nav-text">MySQL 程序概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MySQL-%E7%A8%8B%E5%BA%8F"><span class="nav-number">7.2.</span> <span class="nav-text">使用 MySQL 程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%92%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%90%AF%E5%8A%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">7.3.</span> <span class="nav-text">服务器和服务器启动程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqld"><span class="nav-number">7.3.1.</span> <span class="nav-text">mysqld</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqld-safe"><span class="nav-number">7.3.2.</span> <span class="nav-text">mysqld_safe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql-server"><span class="nav-number">7.3.3.</span> <span class="nav-text">mysql.server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqld-multi"><span class="nav-number">7.3.4.</span> <span class="nav-text">mysqld_multi</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E7%A8%8B%E5%BA%8F"><span class="nav-number">7.4.</span> <span class="nav-text">客户端程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mysql"><span class="nav-number">7.4.1.</span> <span class="nav-text">mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqladmin"><span class="nav-number">7.4.2.</span> <span class="nav-text">mysqladmin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqldump"><span class="nav-number">7.4.3.</span> <span class="nav-text">mysqldump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqlimport"><span class="nav-number">7.4.4.</span> <span class="nav-text">mysqlimport</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mysqlshow"><span class="nav-number">7.4.5.</span> <span class="nav-text">mysqlshow</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MySQL-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AE%A1%E7%90%86"><span class="nav-number">8.</span> <span class="nav-text">MySQL 服务器管理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">8.1.</span> <span class="nav-text">MySQL服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%8F%92%E4%BB%B6"><span class="nav-number">8.2.</span> <span class="nav-text">MySQL服务器插件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-number">9.</span> <span class="nav-text">安全</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%92%8C%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86"><span class="nav-number">9.1.</span> <span class="nav-text">访问控制和账户管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MySQL-%E6%8F%90%E4%BE%9B%E7%9A%84%E6%9D%83%E9%99%90"><span class="nav-number">9.1.1.</span> <span class="nav-text">MySQL 提供的权限</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E8%B4%A6%E6%88%B7%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"><span class="nav-number">9.1.2.</span> <span class="nav-text">设置账户资源限制</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%8A%A0%E5%AF%86%E8%BF%9E%E6%8E%A5"><span class="nav-number">9.2.</span> <span class="nav-text">使用加密连接</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE-MySQL-%E4%BD%BF%E7%94%A8%E5%8A%A0%E5%AF%86%E8%BF%9E%E6%8E%A5"><span class="nav-number">9.2.1.</span> <span class="nav-text">配置 MySQL 使用加密连接</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A0%E5%AF%86%E8%BF%9E%E6%8E%A5-TLS-%E5%8D%8F%E8%AE%AE%E5%92%8C%E5%AF%86%E7%A0%81"><span class="nav-number">9.2.2.</span> <span class="nav-text">加密连接 TLS 协议和密码</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A4%87%E4%BB%BD%E5%92%8C%E6%81%A2%E5%A4%8D"><span class="nav-number">10.</span> <span class="nav-text">备份和恢复</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-mysqldump-%E8%BF%9B%E8%A1%8C%E5%A4%87%E4%BB%BD"><span class="nav-number">10.1.</span> <span class="nav-text">使用 mysqldump 进行备份</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL-%E6%A0%BC%E5%BC%8F-%E5%B8%B8%E7%94%A8"><span class="nav-number">10.1.1.</span> <span class="nav-text">SQL 格式-常用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%9A%94%E6%96%87%E6%9C%AC%E6%A0%BC%E5%BC%8F-%E4%BA%86%E8%A7%A3"><span class="nav-number">10.1.2.</span> <span class="nav-text">分隔文本格式-了解</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BC%98%E5%8C%96"><span class="nav-number">11.</span> <span class="nav-text">优化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%A6%82%E8%BF%B0"><span class="nav-number">11.1.</span> <span class="nav-text">优化概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-SQL-%E8%AF%AD%E5%8F%A5"><span class="nav-number">11.2.</span> <span class="nav-text">优化 SQL 语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E5%92%8C%E7%B4%A2%E5%BC%95"><span class="nav-number">11.3.</span> <span class="nav-text">优化和索引</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%93%E6%9E%84"><span class="nav-number">11.4.</span> <span class="nav-text">优化数据库结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3%E6%89%A7%E8%A1%8C%E8%AE%A1%E5%88%92"><span class="nav-number">11.5.</span> <span class="nav-text">了解执行计划</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96-MySQL-%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">11.6.</span> <span class="nav-text">优化 MySQL 服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E4%BC%98%E6%80%BB%E7%BB%93"><span class="nav-number">11.7.</span> <span class="nav-text">调优总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E8%BD%AE%E8%BD%AC"><span class="nav-number">11.7.1.</span> <span class="nav-text">慢查询日志文件轮转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%BE%E5%88%B0%E6%85%A2SQL%E4%B9%8B%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97"><span class="nav-number">11.7.2.</span> <span class="nav-text">找到慢SQL之慢查询日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%BE%E5%88%B0%E6%85%A2SQL%E4%B9%8B%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90"><span class="nav-number">11.7.3.</span> <span class="nav-text">找到慢SQL之性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SQL%E7%9A%84%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4-%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4"><span class="nav-number">11.7.4.</span> <span class="nav-text">SQL的执行时间&amp;等待时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B9%E6%8D%AE-Status-Var-%E8%B0%83%E4%BC%98"><span class="nav-number">11.7.5.</span> <span class="nav-text">根据 Status Var 调优</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">11.7.6.</span> <span class="nav-text">分页查询性能优化</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">12.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL"><span class="nav-number">12.1.</span> <span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PostgreSQL"><span class="nav-number">12.2.</span> <span class="nav-text">PostgreSQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Oracle"><span class="nav-number">12.3.</span> <span class="nav-text">Oracle</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%80%BC"><span class="nav-number">12.3.1.</span> <span class="nav-text">数值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E7%B1%BB%E5%9E%8B"><span class="nav-number">12.3.2.</span> <span class="nav-text">日期和时间类型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B"><span class="nav-number">12.3.3.</span> <span class="nav-text">字符串类型</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%92%8C%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="nav-number">13.</span> <span class="nav-text">函数和运算符</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-1"><span class="nav-number">13.1.</span> <span class="nav-text">MySQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PostgreSQL-1"><span class="nav-number">13.2.</span> <span class="nav-text">PostgreSQL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Oracle-1"><span class="nav-number">13.3.</span> <span class="nav-text">Oracle</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SQL-%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.</span> <span class="nav-text">SQL 语句</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#DDL%EF%BC%88%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%EF%BC%89"><span class="nav-number">14.1.</span> <span class="nav-text">DDL（数据定义语言）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DML%EF%BC%88%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80%EF%BC%89"><span class="nav-number">14.2.</span> <span class="nav-text">DML（数据操纵语言）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1%E5%92%8C%E9%94%81%E5%AE%9A%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.3.</span> <span class="nav-text">事务和锁定语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E5%88%B6%E8%AF%AD%E5%8F%A5%EF%BC%88%E6%8E%A7%E5%88%B6%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%EF%BC%89"><span class="nav-number">14.4.</span> <span class="nav-text">复制语句（控制主从复制）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%84%E7%BC%96%E8%AF%91%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.5.</span> <span class="nav-text">预编译语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E8%AF%AD%E5%8F%A5%E8%AF%AD%E6%B3%95"><span class="nav-number">14.6.</span> <span class="nav-text">复合语句语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%AE%A1%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.</span> <span class="nav-text">数据库管理语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%A6%E6%88%B7%E7%AE%A1%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.1.</span> <span class="nav-text">账户管理语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B5%84%E6%BA%90%E7%BB%84%E7%AE%A1%E7%90%86%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.2.</span> <span class="nav-text">资源组管理语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E7%BB%B4%E6%8A%A4%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.3.</span> <span class="nav-text">表维护语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E4%BB%B6%E3%80%81%E6%8F%92%E4%BB%B6%E5%92%8C%E5%8F%AF%E5%8A%A0%E8%BD%BD%E5%87%BD%E6%95%B0%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.4.</span> <span class="nav-text">组件、插件和可加载函数语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CLONE-%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.5.</span> <span class="nav-text">CLONE 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SET-%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.6.</span> <span class="nav-text">SET 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SHOW-%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.7.</span> <span class="nav-text">SHOW 语句</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E8%A1%8C%E6%94%BF%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.7.8.</span> <span class="nav-text">其他行政语句</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%94%A8%E8%AF%AD%E5%8F%A5"><span class="nav-number">14.8.</span> <span class="nav-text">实用语句</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E3%80%81%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E3%80%81Unicode"><span class="nav-number">15.</span> <span class="nav-text">字符集、排序规则、Unicode</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E6%A6%82%E8%BF%B0"><span class="nav-number">15.1.</span> <span class="nav-text">字符集和排序规则概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MySQL-%E4%B8%AD%E7%9A%84%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99"><span class="nav-number">15.2.</span> <span class="nav-text">MySQL 中的字符集和排序规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%87%E5%AE%9A%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99"><span class="nav-number">15.3.</span> <span class="nav-text">指定字符集和排序规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99%E5%91%BD%E5%90%8D%E7%BA%A6%E5%AE%9A"><span class="nav-number">15.3.1.</span> <span class="nav-text">排序规则命名约定</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%8E%92%E5%BA%8F%E8%A7%84%E5%88%99"><span class="nav-number">15.4.</span> <span class="nav-text">连接字符集和排序规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unicode-%E6%94%AF%E6%8C%81"><span class="nav-number">15.5.</span> <span class="nav-text">Unicode 支持</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#InnoDB%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">16.</span> <span class="nav-text">InnoDB存储引擎</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MVCC%EF%BC%88%E5%A4%9A%E7%89%88%E6%9C%AC%E5%B9%B6%E5%8F%91%E6%8E%A7%E5%88%B6%EF%BC%89"><span class="nav-number">16.1.</span> <span class="nav-text">MVCC（多版本并发控制）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB-%E6%9E%B6%E6%9E%84"><span class="nav-number">16.2.</span> <span class="nav-text">InnoDB 架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB-%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84"><span class="nav-number">16.3.</span> <span class="nav-text">InnoDB 内存结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB-%E7%A3%81%E7%9B%98%E7%BB%93%E6%9E%84"><span class="nav-number">16.4.</span> <span class="nav-text">InnoDB 磁盘结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#InnoDB-%E9%99%90%E5%88%B6"><span class="nav-number">16.5.</span> <span class="nav-text">InnoDB 限制</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9B%BF%E4%BB%A3%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E"><span class="nav-number">17.</span> <span class="nav-text">替代存储引擎</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#information-schema"><span class="nav-number">18.</span> <span class="nav-text">information_schema</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#performance-schema"><span class="nav-number">19.</span> <span class="nav-text">performance_schema</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#sys-Schema"><span class="nav-number">20.</span> <span class="nav-text">sys Schema</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#mysql-System-Schema%EF%BC%88%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%89"><span class="nav-number">21.</span> <span class="nav-text">mysql System Schema（系统数据库）</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhaolq"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">zhaolq</p>
  <div class="site-description" itemprop="description">有用、有趣、有情义！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">554</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">38</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hellozhaolq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hellozhaolq" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hello.zhaolq@qq.com" title="E-Mail → mailto:hello.zhaolq@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.zhaolq.com/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhaolq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="洋蔥">
      <meta itemprop="description" content="有用、有趣、有情义！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="MySQL_00精华 | 洋蔥">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MySQL_00精华
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-01-01 08:00:00" itemprop="dateCreated datePublished" datetime="2022-01-01T08:00:00+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Database/" itemprop="url" rel="index"><span itemprop="name">Database</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p> <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/SQL">SQL标准 - 维基百科</a> ，以SQL为基础的其他延伸语言： <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Transact-SQL">Transact-SQL - 维基百科</a> 、 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/PL-SQL">PL-SQL(Oracle) - 维基百科</a> </p>
<h1 id="数据库官方文档"><a href="#数据库官方文档" class="headerlink" title="数据库官方文档"></a>数据库官方文档</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/">https://dev.mysql.com/doc/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/">https://www.postgresql.org/docs/</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/">https://docs.oracle.com/en/database/</a></p>
<p>Oracle 数据库文档 比较零散，这里列出重要的几个：</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlqr/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlqr/index.html</a>	SQL 语言快速参考，<strong>SQL 语言参考</strong> 的简洁版</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlrf/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlrf/index.html</a>	SQL 语言参考</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/tgsql/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/tgsql/index.html</a>	SQL调优指南</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/index.html</a>	数据库概念</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/lnpls/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/lnpls/index.html</a>	数据库 PL&#x2F;SQL 语言参考</p>
<h1 id="jdbc-url属性配置"><a href="#jdbc-url属性配置" class="headerlink" title="jdbc-url属性配置"></a>jdbc-url属性配置</h1><p>Oracle 21</p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/21/jjdbc/index.html">https://docs.oracle.com/en/database/oracle/oracle-database/21/jjdbc/index.html</a></p>
<p>MySQL 8.4</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/index-connectors.html">https://dev.mysql.com/doc/index-connectors.html</a></p>
<p>Java连接器配置属性：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/connector-j/en/connector-j-reference-configuration-properties.html">https://dev.mysql.com/doc/connector-j/en/connector-j-reference-configuration-properties.html</a></p>
<p>示例（旧）：serverTimezone&#x3D;SERVER&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&amp;useSSL&#x3D;false</p>
<p>PostgreSQL 16</p>
<p><a target="_blank" rel="noopener" href="https://jdbc.postgresql.org/documentation/use/">https://jdbc.postgresql.org/documentation/use/</a></p>
<p>jdbc:postgresql:&#x2F;&#x2F;192.168.0.7:5432&#x2F;dbname?ssl&#x3D;false</p>
<span id="more"></span>

<h1 id="常用语句"><a href="#常用语句" class="headerlink" title="常用语句"></a>常用语句</h1><h2 id="用户"><a href="#用户" class="headerlink" title="用户"></a>用户</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看所有的数据库</span></span><br><span class="line"><span class="keyword">show</span> databases;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建数据库</span></span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> basedb;</span><br><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> archedb;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database basedb;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database archedb;</span><br><span class="line"><span class="comment">-- 创建用户</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">user</span> if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="string">&#x27;base&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">with</span> caching_sha2_password <span class="keyword">by</span> <span class="string">&#x27;123456789&#x27;</span>,</span><br><span class="line">			              <span class="string">&#x27;arche&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">with</span> caching_sha2_password <span class="keyword">by</span> <span class="string">&#x27;123456789&#x27;</span>;</span><br><span class="line"><span class="comment">-- 修改用户密码</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;base&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">with</span> caching_sha2_password <span class="keyword">by</span> <span class="string">&#x27;123456789&#x27;</span> password expire never;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">&#x27;arche&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">with</span> caching_sha2_password <span class="keyword">by</span> <span class="string">&#x27;123456789&#x27;</span> password expire never;</span><br><span class="line"><span class="comment">-- 创建角色</span></span><br><span class="line"><span class="keyword">create</span> role if <span class="keyword">not</span> <span class="keyword">exists</span> <span class="string">&#x27;baserole&#x27;</span>@<span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;archerole&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 授予权限</span></span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> basedb.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;baserole&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> archedb.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;archerole&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- grant select on *.* to &#x27;baserole&#x27;@&#x27;%&#x27;;</span></span><br><span class="line"><span class="comment">-- grant select on *.* to &#x27;archerole&#x27;@&#x27;%&#x27;;</span></span><br><span class="line"><span class="comment">-- 将角色权限授予给用户</span></span><br><span class="line"><span class="keyword">grant</span> <span class="string">&#x27;baserole&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;base&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">grant</span> <span class="string">&#x27;archerole&#x27;</span> <span class="keyword">to</span> <span class="string">&#x27;arche&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- set default role 语句：定义了当用户连接到服务器并进行身份验证时，或在会话中执行 SET ROLE DEFAULT 语句时，哪些角色将被激活。</span></span><br><span class="line"><span class="keyword">set</span> <span class="keyword">default</span> role <span class="keyword">all</span> <span class="keyword">to</span> <span class="string">&#x27;base&#x27;</span>@<span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;arche&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 将任何库下任何表的主从复制权限授予给角色</span></span><br><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;baserole&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 刷新权限表</span></span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用basedb数据库</span></span><br><span class="line">use basedb; </span><br><span class="line"><span class="keyword">select</span> host, <span class="keyword">user</span>, plugin <span class="keyword">from</span> mysql.user;</span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;baserole&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> grants <span class="keyword">for</span> <span class="string">&#x27;base&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">from</span> basedb;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除角色</span></span><br><span class="line"><span class="keyword">drop</span> role if <span class="keyword">exists</span> <span class="string">&#x27;baserole&#x27;</span>, <span class="string">&#x27;archerole&#x27;</span>;</span><br><span class="line"><span class="comment">-- 删除用户</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> if <span class="keyword">exists</span> <span class="string">&#x27;base&#x27;</span>@<span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;arche&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 删除数据库</span></span><br><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> basedb;</span><br><span class="line"><span class="keyword">drop</span> database if <span class="keyword">exists</span> archedb;</span><br></pre></td></tr></table></figure>

<h2 id="表和索引"><a href="#表和索引" class="headerlink" title="表和索引"></a>表和索引</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看某个库的所有表</span></span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">from</span> basedb;</span><br><span class="line"><span class="keyword">show</span> tables;</span><br><span class="line"><span class="keyword">show</span> tables <span class="keyword">like</span> <span class="string">&#x27;%base_%&#x27;</span>;</span><br><span class="line"><span class="keyword">show</span> indexes <span class="keyword">from</span> 表名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看表的创建信息</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> 表名称;</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create table</span> 表名称\G;</span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line"><span class="keyword">desc</span> 表名称;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 普通索引：CREATE        INDEX index_name ON table_name (column1 [ASC|DESC], column2 [ASC|DESC], ...);</span></span><br><span class="line"><span class="comment">-- 唯一索引：CREATE UNIQUE INDEX index_name ON table_name (column1 [ASC|DESC], column2 [ASC|DESC], ...);</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX create_time <span class="keyword">ON</span> t_base_table_template (`create_time`);</span><br><span class="line"><span class="keyword">DROP</span> INDEX create_time <span class="keyword">ON</span> t_base_table_template;</span><br></pre></td></tr></table></figure>

<h2 id="会话的连接ID与线程ID"><a href="#会话的连接ID与线程ID" class="headerlink" title="会话的连接ID与线程ID"></a>会话的连接ID与线程ID</h2><p><code>CONNECTION_ID()</code> 返回当前会话的连接 ID（与 <code>SHOW PROCESSLIST</code> 中 <code>Id</code> 一致）。</p>
<p><code>performance_schema.threads</code> 表映射连接 ID 与 MySQL 内部线程 ID（<code>THREAD_ID</code>）的对应关系。</p>
<p>线程类型：</p>
<ul>
<li>foreground 前台线程，由客户端连接触发，用于处理SQL请求。</li>
<li>background 后台线程，由系统内部维护，负责如日志刷新、清理、复制、检查点等操作。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看当前会话的 连接ID、线程ID、线程名称</span></span><br><span class="line"><span class="keyword">SELECT</span> PROCESSLIST_ID, THREAD_ID, NAME, TYPE <span class="keyword">FROM</span> performance_schema.threads <span class="keyword">WHERE</span> PROCESSLIST_ID <span class="operator">=</span> CONNECTION_ID();</span><br><span class="line"><span class="comment">-- 当前活跃线程数：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> performance_schema.threads;</span><br><span class="line"><span class="comment">-- 仅客户端连接线程：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> performance_schema.threads <span class="keyword">WHERE</span> TYPE <span class="operator">=</span> <span class="string">&#x27;FOREGROUND&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="常用视图"><a href="#常用视图" class="headerlink" title="常用视图"></a>常用视图</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 系统变量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.global_variables;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.session_variables;</span><br><span class="line"><span class="comment">-- 状态变量</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.global_status;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.session_status;</span><br><span class="line"><span class="comment">-- 查询表数据占用空间</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    table_name <span class="keyword">AS</span> <span class="string">&#x27;表名&#x27;</span>,</span><br><span class="line">    ROUND(data_length <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="string">&#x27;数据大小(MB)&#x27;</span>,</span><br><span class="line">    ROUND(index_length <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="string">&#x27;索引大小(MB)&#x27;</span>,</span><br><span class="line">    ROUND((data_length <span class="operator">+</span> index_length) <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span>, <span class="number">2</span>) <span class="keyword">AS</span> <span class="string">&#x27;总大小(MB)&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">    information_schema.tables</span><br><span class="line"><span class="keyword">WHERE</span> table_schema <span class="operator">=</span> <span class="string">&#x27;archedb&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="常用变量"><a href="#常用变量" class="headerlink" title="常用变量"></a>常用变量</h1><h2 id="系统变量和状态变量"><a href="#系统变量和状态变量" class="headerlink" title="系统变量和状态变量"></a>系统变量和状态变量</h2><p><font color="red">SET 语法用于变量赋值</font>，官网：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-variable.html">https://dev.mysql.com/doc/refman/8.4/en/set-variable.html</a></p>
<table>
<thead>
<tr>
<th>特性</th>
<th>System Variables（系统变量）</th>
<th>Status Variables（状态变量）</th>
</tr>
</thead>
<tbody><tr>
<td><strong>作用</strong></td>
<td>控制 MySQL 的行为或配置项（如缓存大小，最大连接数）</td>
<td>显示 MySQL 当前的运行状态、统计信息、性能指标。<br><strong>状态变量可用于系统调优。</strong></td>
</tr>
<tr>
<td><strong>是否可修改</strong></td>
<td>✅ 可配置，<code>SET</code> 语句或配置文件</td>
<td>❌ 只读，无法配置</td>
</tr>
<tr>
<td><strong>重启后</strong></td>
<td>恢复配置文件值或默认值</td>
<td>被清零或重置</td>
</tr>
<tr>
<td><strong>生效范围</strong></td>
<td>Global（全局）、Session（会话）、Both（两者兼有）</td>
<td>Global（全局）、Session（会话）、Both（两者兼有）</td>
</tr>
<tr>
<td><strong>示例变量</strong></td>
<td><code>max_connections</code>, <code>join_buffer_size</code></td>
<td><code>Threads_connected</code>, <code>Questions</code>, <code>Uptime</code></td>
</tr>
</tbody></table>
<p><font color="black" size="4"><strong>系统变量</strong></font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span> <span class="operator">|</span> SESSION] VARIABLES [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span> <span class="operator">|</span> <span class="keyword">WHERE</span> expr] <span class="comment">-- 默认session级别</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.global_variables; <span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.session_variables; <span class="comment">-- 推荐</span></span><br><span class="line"><span class="comment">-- 模糊查询</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span>  VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%buffer_size%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES <span class="keyword">LIKE</span> <span class="string">&#x27;%buffer_size%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span>         VARIABLES <span class="keyword">where</span> variable_name <span class="keyword">LIKE</span> <span class="string">&#x27;%buffer_size%&#x27;</span>;</span><br><span class="line"><span class="comment">-- 具体查询</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@GLOBAL</span>.join_buffer_size, @<span class="variable">@SESSION</span>.join_buffer_size;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 变量赋值</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> sort_buffer_size <span class="operator">=</span> <span class="number">256</span><span class="operator">*</span><span class="number">1024</span>, SESSION sort_buffer_size <span class="operator">=</span> <span class="number">2</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@GLOBAL</span>.sort_buffer_size <span class="operator">=</span> <span class="number">256</span><span class="operator">*</span><span class="number">1024</span>, @<span class="variable">@SESSION</span>.sort_buffer_size <span class="operator">=</span> <span class="number">2</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@GLOBAL</span>.sort_buffer_size <span class="operator">=</span> <span class="number">256</span><span class="operator">*</span><span class="number">1024</span>, @<span class="variable">@sort_buffer_size</span> <span class="operator">=</span> <span class="number">2</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>; <span class="comment">-- session级别为2MB</span></span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@GLOBAL</span>.sort_buffer_size <span class="operator">=</span> <span class="number">256</span><span class="operator">*</span><span class="number">1024</span>, sort_buffer_size <span class="operator">=</span> <span class="number">2</span><span class="operator">*</span><span class="number">1024</span><span class="operator">*</span><span class="number">1024</span>; <span class="comment">-- session级别为2MB</span></span><br></pre></td></tr></table></figure>

<p><font color="black" size="4"><strong>状态变量</strong></font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> [<span class="keyword">GLOBAL</span> <span class="operator">|</span> SESSION] STATUS [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span> <span class="operator">|</span> <span class="keyword">WHERE</span> expr] <span class="comment">-- 默认session级别</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.global_status; <span class="comment">-- 推荐</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.session_status; <span class="comment">-- 推荐</span></span><br><span class="line"><span class="comment">-- 模糊查询</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span>  STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%questions%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span> SESSION STATUS <span class="keyword">LIKE</span> <span class="string">&#x27;%questions%&#x27;</span>;</span><br><span class="line"><span class="keyword">SHOW</span>         STATUS <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;%questions%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="运行时长"><a href="#运行时长" class="headerlink" title="运行时长"></a>运行时长</h2><p><font color="red">将服务器的所有状态变量清零（重置为初始值）：<code>FLUSH STATUS;</code> 。</font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;%uptime%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name             <span class="operator">|</span> <span class="keyword">Value</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+---------+</span></span><br><span class="line"><span class="operator">|</span> Uptime                    <span class="operator">|</span> <span class="number">5838907</span> <span class="operator">|</span> <span class="comment">-- Global。服务器已运行秒数。</span></span><br><span class="line"><span class="operator">|</span> Uptime_since_flush_status <span class="operator">|</span> <span class="number">5838907</span> <span class="operator">|</span> <span class="comment">-- Global。自上次执行 FLUSH STATUS 语句以来经过的秒数。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------+---------+</span></span><br></pre></td></tr></table></figure>

<h2 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 连接管理</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;%connection%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                     <span class="operator">|</span> <span class="keyword">Value</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> character_set_connection          <span class="operator">|</span> utf8            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> collation_connection              <span class="operator">|</span> utf8_general_ci <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> gaia_super_priv_extra_connections <span class="operator">|</span> <span class="number">50</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> max_connections                   <span class="operator">|</span> <span class="number">4000</span>            <span class="operator">|</span> <span class="comment">-- Global。默认151。最大连接数。</span></span><br><span class="line"><span class="operator">|</span> max_user_connections              <span class="operator">|</span> <span class="number">0</span>               <span class="operator">|</span> <span class="comment">-- Both。允许任何给定 MySQL 用户账户的最大同时连接数。值为 0（默认值）表示“无限制”。该变量具有全局值，可在服务器启动时或运行时设置。它还具有只读会话值，用于指示当前会话关联账户的有效同时连接限制。会话值的初始化方式见官网说明。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+-----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 连接统计</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;%connection%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                     <span class="operator">|</span> <span class="keyword">Value</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+---------------------+</span></span><br><span class="line"><span class="operator">|</span> Connection_errors_accept          <span class="operator">|</span> <span class="number">0</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Connection_errors_internal        <span class="operator">|</span> <span class="number">0</span>                   <span class="operator">|</span> <span class="comment">-- Global。由于服务器内部错误导致的连接拒绝次数，例如无法启动新线程或内存不足的情况。</span></span><br><span class="line"><span class="operator">|</span> Connection_errors_max_connections <span class="operator">|</span> <span class="number">0</span>                   <span class="operator">|</span> <span class="comment">-- Global。由于服务器 max_connections 限制已达到，导致的连接拒绝次数。</span></span><br><span class="line"><span class="operator">|</span> Connection_errors_peer_address    <span class="operator">|</span> <span class="number">0</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Connection_errors_select          <span class="operator">|</span> <span class="number">0</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Connection_errors_tcpwrap         <span class="operator">|</span> <span class="number">0</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Connections                       <span class="operator">|</span> <span class="number">48940663</span>            <span class="operator">|</span> <span class="comment">-- Global。尝试连接 MySQL 服务器的次数（成功或失败）。</span></span><br><span class="line"><span class="operator">|</span> Max_used_connections              <span class="operator">|</span> <span class="number">602</span>                 <span class="operator">|</span> <span class="comment">-- Global。同时使用的最大连接数。</span></span><br><span class="line"><span class="operator">|</span> Max_used_connections_time         <span class="operator">|</span> <span class="number">2025</span><span class="number">-07</span><span class="number">-03</span> <span class="number">20</span>:<span class="number">34</span>:<span class="number">37</span> <span class="operator">|</span> <span class="comment">-- Max_used_connections 达到当前值的时间。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------------------+---------------------+</span></span><br></pre></td></tr></table></figure>

<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 与线程相关的系统变量</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;thread%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+---------------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                 <span class="operator">|</span> <span class="keyword">Value</span>                     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+---------------------------+</span></span><br><span class="line"><span class="operator">|</span> thread_cache_size             <span class="operator">|</span> <span class="number">1024</span>                      <span class="operator">|</span> <span class="comment">-- Global。默认值-1。服务器应缓存多少个线程以供重复使用。当客户端断开连接时，如果缓存中的线程数量少于 thread_cache_size，则该客户端的线程会被放入缓存。请求线程时，系统会优先从缓存中重复使用线程，只有当缓存为空时才会创建新线程。如果您的服务器有大量新连接，可以增加此变量值以提升性能。通常，如果线程实现良好，这不会带来明显的性能提升。然而，如果服务器每秒处理数百个连接，通常应将 thread_cache_size 设置得足够高，以便大多数新连接使用缓存线程。通过比较 Connections 和 Threads_created 状态变量的差异，可以评估线程缓存的效率。</span></span><br><span class="line"><span class="operator">|</span> thread_handling               <span class="operator">|</span> <span class="keyword">one</span><span class="operator">-</span>thread<span class="operator">-</span><span class="keyword">per</span><span class="operator">-</span>connection <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_high_prio_mode    <span class="operator">|</span> transactions              <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_high_prio_tickets <span class="operator">|</span> <span class="number">4294967295</span>                <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_idle_timeout      <span class="operator">|</span> <span class="number">60</span>                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_max_threads       <span class="operator">|</span> <span class="number">100000</span>                    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_oversubscribe     <span class="operator">|</span> <span class="number">20</span>                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_size              <span class="operator">|</span> <span class="number">2</span>                         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_pool_stall_limit       <span class="operator">|</span> <span class="number">10</span>                        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> thread_stack                  <span class="operator">|</span> <span class="number">196608</span>                    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------+---------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 与线程相关的状态变量</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;thread%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Threads_cached       <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span> <span class="comment">-- Global。</span></span><br><span class="line"><span class="operator">|</span> Threads_connected    <span class="operator">|</span> <span class="number">22</span>       <span class="operator">|</span> <span class="comment">-- Global。当前打开的连接数。</span></span><br><span class="line"><span class="operator">|</span> Threads_created      <span class="operator">|</span> <span class="number">429082</span>   <span class="operator">|</span> <span class="comment">-- Global。表示创建过的线程数。该值不断增大是因为 thread_cache_size 使用默认值 -1。</span></span><br><span class="line"><span class="operator">|</span> Threads_running      <span class="operator">|</span> <span class="number">1</span>        <span class="operator">|</span> <span class="comment">-- Global。未处于睡眠状态的线程数量。一般低于 connected 数值。准确来说，代表当前并发</span></span><br></pre></td></tr></table></figure>

<h2 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 与超时相关的系统变量</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;%execution%&#x27;</span> <span class="keyword">or</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;long_query_time&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;connect_timeout&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;wait_timeout&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;interactive_timeout&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> connect_timeout     <span class="operator">|</span> <span class="number">5</span>        <span class="operator">|</span> <span class="comment">-- Global。默认10秒。MySQL 服务器在收到连接请求后，等待响应“Bad handshake”错误的秒数（大白话：在指定秒数内没完成握手，连接会被拒绝）。</span></span><br><span class="line"><span class="operator">|</span> wait_timeout        <span class="operator">|</span> <span class="number">3600</span>     <span class="operator">|</span> <span class="comment">-- Both。默认28800秒。服务器在关闭 非交互式连接（后端程序发起的连接，如JDBC）前，等待该连接有活动操作的秒数。</span></span><br><span class="line"><span class="operator">|</span> interactive_timeout <span class="operator">|</span> <span class="number">3600</span>     <span class="operator">|</span> <span class="comment">-- Both。默认28800秒。服务器在关闭 　交互式连接（mysql命令、客户端工具）前，等待该连接有活动操作的秒数。</span></span><br><span class="line"><span class="operator">|</span> max_execution_time  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span> <span class="comment">-- Both。SELECT 语句的执行超时时间（会中断超时 SQL，返回错误），单位为毫秒。默认值0，表示不启用超时。对于存储程序中的 SELECT 语句，max_execution_time 将被忽略。</span></span><br><span class="line"><span class="operator">|</span> long_query_time     <span class="operator">|</span> <span class="number">1.000000</span> <span class="operator">|</span> <span class="comment">-- Both。如果查询耗时超过指定秒数，服务器会将 Slow_queries 状态变量加一。如果启用了慢查询日志，该查询会被记录到慢查询日志文件中。默认值10秒，最小0秒。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+----------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 与超时相关的状态变量</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;%execution%&#x27;</span> <span class="keyword">or</span> variable_name <span class="keyword">in</span>(</span><br><span class="line">    <span class="string">&#x27;Slow_queries&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                    <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Max_execution_time_exceeded      <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Max_execution_time_set           <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Max_execution_time_set_failed    <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Secondary_engine_execution_count <span class="operator">|</span> <span class="number">0</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Slow_queries                     <span class="operator">|</span> <span class="number">298</span>   <span class="operator">|</span> <span class="comment">-- Both。耗时超过 long_query_time 秒的查询数。无论是否启用慢查询日志，此计数器都会递增。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------+-------+</span></span><br></pre></td></tr></table></figure>

<h2 id="数据包"><a href="#数据包" class="headerlink" title="数据包"></a>数据包</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 与数据包相关的系统变量</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;max_allowed_packet&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> max_allowed_packet  <span class="operator">|</span> <span class="number">536870912</span> <span class="operator">|</span> <span class="comment">-- Both。默认67108864(64MB)。控制单个数据包（单条SQL语句）的最大大小，影响 大字段存储、多行批量插入、存储过程和二进制日志。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------+</span></span><br></pre></td></tr></table></figure>

<h2 id="语句数量"><a href="#语句数量" class="headerlink" title="语句数量"></a>语句数量</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查询相关的状态变量</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;Com_select&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Com_insert&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Com_update&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Com_delete&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Queries&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Questions&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Com_delete    <span class="operator">|</span> <span class="number">26145937</span>   <span class="operator">|</span> <span class="comment">-- Com_xxx 语句计数变量表示每个 xxx 语句被执行的次数。每种类型的语句都有一个状态变量。</span></span><br><span class="line"><span class="operator">|</span> Com_insert    <span class="operator">|</span> <span class="number">26150143</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Com_select    <span class="operator">|</span> <span class="number">805128892</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Com_update    <span class="operator">|</span> <span class="number">11688853</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Queries       <span class="operator">|</span> <span class="number">4051726800</span> <span class="operator">|</span> <span class="comment">-- Both。服务器执行的语句数量。此变量包含存储程序中执行的语句，与Questions变量不同。它不计入COM_PING或COM_STATISTICS命令。</span></span><br><span class="line"><span class="operator">|</span> Questions     <span class="operator">|</span> <span class="number">2751086323</span> <span class="operator">|</span> <span class="comment">-- Both。服务器执行的语句数量。此变量仅统计客户端发送至服务器的语句，不包括存储程序内部执行的语句，与 Queries 变量不同。该变量不统计 COM_PING、COM_STATISTICS、COM_STMT_PREPARE、COM_STMT_CLOSE 或 COM_STMT_RESET 命令。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+------------+</span></span><br></pre></td></tr></table></figure>

<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 日志管理</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;log_bin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;binlog_format&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;general_log&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;slow_query_log&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name  <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br><span class="line"><span class="operator">|</span> binlog_format  <span class="operator">|</span> <span class="type">ROW</span>   <span class="operator">|</span> <span class="comment">-- Both。默认ROW。</span></span><br><span class="line"><span class="operator">|</span> general_log    <span class="operator">|</span> <span class="keyword">ON</span>    <span class="operator">|</span> <span class="comment">-- Global。默认OFF。</span></span><br><span class="line"><span class="operator">|</span> log_bin        <span class="operator">|</span> OFF   <span class="operator">|</span> <span class="comment">-- Global。默认ON。</span></span><br><span class="line"><span class="operator">|</span> slow_query_log <span class="operator">|</span> <span class="keyword">ON</span>    <span class="operator">|</span> <span class="comment">-- Global。默认OFF。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+-------+</span></span><br></pre></td></tr></table></figure>

<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 事务控制</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;autocommit&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;innodb_flush_log_at_trx_commit&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;transaction_isolation&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                  <span class="operator">|</span> <span class="keyword">Value</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> autocommit                     <span class="operator">|</span> <span class="keyword">ON</span>              <span class="operator">|</span> <span class="comment">-- Both。默认ON。自动提交模式。禁用当前会话自动提交 SET autocommit=0;</span></span><br><span class="line"><span class="operator">|</span> innodb_flush_log_at_trx_commit <span class="operator">|</span> <span class="number">1</span>               <span class="operator">|</span> <span class="comment">-- Global。默认1。</span></span><br><span class="line"><span class="operator">|</span> transaction_isolation          <span class="operator">|</span> REPEATABLE<span class="operator">-</span>READ <span class="operator">|</span> <span class="comment">-- Both。默认REPEATABLE-READ。设置默认事务隔离级别。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------+-----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 事务统计</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;Handler_commit&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Handler_rollback&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name    <span class="operator">|</span> <span class="keyword">Value</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------+</span></span><br><span class="line"><span class="operator">|</span> Handler_commit   <span class="operator">|</span> <span class="number">1214936199</span> <span class="operator">|</span> <span class="comment">-- Both。事务提交次数。</span></span><br><span class="line"><span class="operator">|</span> Handler_rollback <span class="operator">|</span> <span class="number">9078630</span>    <span class="operator">|</span> <span class="comment">-- Both。事务回滚次数。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+------------+</span></span><br></pre></td></tr></table></figure>

<h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 字符集设置</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;character_set_server&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;collation_server&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name        <span class="operator">|</span> <span class="keyword">Value</span>              <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------------------+</span></span><br><span class="line"><span class="operator">|</span> character_set_server <span class="operator">|</span> utf8mb4            <span class="operator">|</span> <span class="comment">-- Both。默认utf8mb4。服务器默认字符集。</span></span><br><span class="line"><span class="operator">|</span> collation_server     <span class="operator">|</span> utf8mb4_0900_ai_ci <span class="operator">|</span> <span class="comment">-- Both。默认utf8mb4_0900_ai_ci。服务器默认排序规则。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------+--------------------+</span></span><br></pre></td></tr></table></figure>

<h2 id="锁与等待"><a href="#锁与等待" class="headerlink" title="锁与等待"></a>锁与等待</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 锁与等待</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;Innodb_row_lock_waits&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Innodb_row_lock_time&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name         <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_time  <span class="operator">|</span> <span class="number">131943249</span> <span class="operator">|</span> <span class="comment">-- Global。获取 InnoDB 表的行锁所花费的总时间（以毫秒为单位）。</span></span><br><span class="line"><span class="operator">|</span> Innodb_row_lock_waits <span class="operator">|</span> <span class="number">2489499</span>   <span class="operator">|</span> <span class="comment">-- Global。InnoDB 表上的操作必须等待行锁的次数。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------------+-----------+</span></span><br></pre></td></tr></table></figure>

<h2 id="网络流量"><a href="#网络流量" class="headerlink" title="网络流量"></a>网络流量</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 网络流量统计</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;Bytes_received&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Bytes_sent&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name  <span class="operator">|</span> <span class="keyword">Value</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> Bytes_received <span class="operator">|</span> <span class="number">1878077493070</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bytes_sent     <span class="operator">|</span> <span class="number">2773050821181</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------+---------------+</span></span><br></pre></td></tr></table></figure>

<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><p>缓冲池：Buffer Pool，缓存表和索引数据的内存区域。</p>
<p>缓冲区：缓冲池划分的区域。</p>
<p>缓存池命中率：指的是 Buffer Pool 的命中率。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 缓存控制</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%buffer%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                       <span class="operator">|</span> <span class="keyword">Value</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------------+----------------+</span></span><br><span class="line"><span class="operator">|</span> bulk_insert_buffer_size             <span class="operator">|</span> <span class="number">67108864</span>       <span class="operator">|</span> <span class="comment">-- 默认8388608(8MB)。用于 MyISAM 存储引擎，它控制 MyISAM 在执行批量插入时的缓冲区大小，可以提高批量插入的性能。</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_chunk_size       <span class="operator">|</span> <span class="number">134217728</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_dump_at_shutdown <span class="operator">|</span> <span class="keyword">ON</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_dump_now         <span class="operator">|</span> OFF            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_dump_pct         <span class="operator">|</span> <span class="number">25</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_filename         <span class="operator">|</span> ib_buffer_pool <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_in_core_file     <span class="operator">|</span> OFF            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_instances        <span class="operator">|</span> <span class="number">8</span>              <span class="operator">|</span> <span class="comment">-- 非默认，默认为自动调整</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_load_abort       <span class="operator">|</span> OFF            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_load_at_startup  <span class="operator">|</span> <span class="keyword">ON</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_load_now         <span class="operator">|</span> OFF            <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_buffer_pool_size             <span class="operator">|</span> <span class="number">8589934592</span>     <span class="operator">|</span> <span class="comment">-- Global。默认134217728(128MB)</span></span><br><span class="line"><span class="operator">|</span> innodb_change_buffer_max_size       <span class="operator">|</span> <span class="number">25</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_change_buffering             <span class="operator">|</span> <span class="keyword">none</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_ddl_buffer_size              <span class="operator">|</span> <span class="number">1048576</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_log_buffer_size              <span class="operator">|</span> <span class="number">67108864</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> innodb_sort_buffer_size             <span class="operator">|</span> <span class="number">1048576</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> join_buffer_size                    <span class="operator">|</span> <span class="number">8388608</span>        <span class="operator">|</span> <span class="comment">-- Both。默认262144(256KB)</span></span><br><span class="line"><span class="operator">|</span> key_buffer_size                     <span class="operator">|</span> <span class="number">8388608</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> myisam_sort_buffer_size             <span class="operator">|</span> <span class="number">67108864</span>       <span class="operator">|</span> <span class="comment">-- 非默认</span></span><br><span class="line"><span class="operator">|</span> net_buffer_length                   <span class="operator">|</span> <span class="number">16384</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> preload_buffer_size                 <span class="operator">|</span> <span class="number">32768</span>          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> read_buffer_size                    <span class="operator">|</span> <span class="number">2097152</span>        <span class="operator">|</span> <span class="comment">-- 默认131072(128KB)</span></span><br><span class="line"><span class="operator">|</span> read_rnd_buffer_size                <span class="operator">|</span> <span class="number">8388608</span>        <span class="operator">|</span> <span class="comment">-- 非默认</span></span><br><span class="line"><span class="operator">|</span> select_into_buffer_size             <span class="operator">|</span> <span class="number">131072</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> set_operations_buffer_size          <span class="operator">|</span> <span class="number">262144</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> sort_buffer_size                    <span class="operator">|</span> <span class="number">2097152</span>        <span class="operator">|</span> <span class="comment">-- Both。默认262144(256KB)</span></span><br><span class="line"><span class="operator">|</span> sql_buffer_result                   <span class="operator">|</span> OFF            <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------------------+----------------+</span></span><br></pre></td></tr></table></figure>

<h3 id="缓存池命中率"><a href="#缓存池命中率" class="headerlink" title="缓存池命中率"></a>缓存池命中率</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">like</span> <span class="string">&#x27;Innodb_buffer_pool_read%&#x27;</span> <span class="keyword">or</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;Innodb_data_reads&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Innodb_data_writes&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name                         <span class="operator">|</span> <span class="keyword">Value</span>         <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------+---------------+</span></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_ahead_rnd     <span class="operator">|</span> <span class="number">0</span>             <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_ahead         <span class="operator">|</span> <span class="number">50067388</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_ahead_evicted <span class="operator">|</span> <span class="number">4011140</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_read_requests      <span class="operator">|</span> <span class="number">5507255725593</span> <span class="operator">|</span> <span class="comment">-- Global。逻辑读，尝试从 Buffer Pool 中读取数据页的总次数。</span></span><br><span class="line"><span class="operator">|</span> Innodb_buffer_pool_reads              <span class="operator">|</span> <span class="number">1297867754</span>    <span class="operator">|</span> <span class="comment">-- Global。物理读，不能从 Buffer Pool 找到页，只能从磁盘读取数据页的次数。</span></span><br><span class="line"><span class="operator">|</span> Innodb_data_reads                     <span class="operator">|</span> <span class="number">80001</span>         <span class="operator">|</span> <span class="comment">-- Global。物理读磁盘的次数。Buffer Pool 未命中，需从磁盘把数据页读进buffer。一次IO可能读取多个页。</span></span><br><span class="line"><span class="operator">|</span> Innodb_data_writes                    <span class="operator">|</span> <span class="number">47413</span>         <span class="operator">|</span> <span class="comment">-- Global。物理写磁盘的次数。包括redo log、buffer的刷盘，每次刷盘就+1。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------------------------+---------------+</span></span><br></pre></td></tr></table></figure>

<p><font color="blue"><strong>缓存池命中率</strong></font> &#x3D; <code>从缓存中命中的读次数 / 总读次数</code>，即  <code>1 - Innodb_buffer_pool_reads / Innodb_buffer_pool_read_requests</code>。</p>
<p>理想值：命中率应在 <strong>99.9%+</strong>。 如果命中率低，说明 <code>innodb_buffer_pool_size</code> 太小，需要增大。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  round((<span class="number">1</span> <span class="operator">-</span> (p2.variable_value <span class="operator">/</span> p1.variable_value)) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">as</span> innodb_buffer_pool_hit_rate </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  performance_schema.global_status p1, performance_schema.global_status p2 </span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  p1.variable_name <span class="operator">=</span> <span class="string">&#x27;innodb_buffer_pool_read_requests&#x27;</span> <span class="keyword">and</span> p2.variable_name <span class="operator">=</span> <span class="string">&#x27;innodb_buffer_pool_reads&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="临时文件合并"><a href="#临时文件合并" class="headerlink" title="临时文件合并"></a>临时文件合并</h3><p>如果一个查询需要排序（比如 <code>ORDER BY</code>），内存（sort buffer）<strong>放不下</strong>所有要排序的数据，那就会把数据<strong>分批写到磁盘临时文件</strong>，<strong>最后再做多路合并（merge passes）</strong>，拼成有序数据。每完成一次这样的“磁盘归并”，<code>Sort_merge_passes</code> <strong>就+1</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">where</span> variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;Sort_merge_passes&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name     <span class="operator">|</span> <span class="keyword">Value</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+-------+</span></span><br><span class="line"><span class="operator">|</span> Sort_merge_passes <span class="operator">|</span> <span class="number">60162</span> <span class="operator">|</span> <span class="comment">-- Both。执行排序（sort）时，临时文件合并的次数。如果此值较大，则应考虑增加 sort_buffer_size 系统变量的值。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="重点变量详细解释"><a href="#重点变量详细解释" class="headerlink" title="重点变量详细解释"></a>重点变量详细解释</h3><ul>
<li><p><strong><code>innodb_buffer_pool_size</code></strong>：以字节为单位。默认134217728(128MB)，最小5242880(5MB)。</p>
</li>
<li><p><code>innodb_buffer_pool_instances</code>：InnoDB缓冲池划分的区域数。对于缓冲池大小在几GB范围内的系统，将缓冲池划分为单独的实例可以提高并发性，因为不同线程读取和写入缓存页面时会减少争用。使用哈希函数将存储在缓冲池中或从缓冲池读取的每个页面随机分配给其中一个缓冲池实例。每个缓冲池管理自己的空闲列表、刷新列表、LRU 以及连接到缓冲池的所有其他数据结构，并受自己的缓冲池互斥锁保护。\n 总缓冲池大小在所有缓冲池之间分配。为了获得最佳效率，请指定 innodb_buffer_pool_instances 和 innodb_buffer_pool_size 的组合，以便每个缓冲池实例至少为 1GB。</p>
</li>
<li><p><code>innodb_buffer_pool_dump_pct</code>：指定每个缓冲池要读出并转储的最近使用的页面的百分比。范围是 1 到 100。默认值为 25。例如，如果有 4 个缓冲池，每个缓冲池有 100 个页面，并且 innodb_buffer_pool_dump_pct 设置为 25，则会转储每个缓冲池中最近使用的 25 个页面。人话：MySQL正常关闭时把buffer中页信息保存到磁盘，启动后再从磁盘加载到buffer，实现服务器快速预热。</p>
</li>
<li><p><strong><code>join_buffer_size</code></strong>：**为两个表之间的<font color="red">每个连接</font>分配n个连接缓冲区。对于未使用索引的多个表之间的复杂连接，可能需要多个连接缓冲区。**用于<font color="red">普通索引扫描</font>、<font color="red">范围索引扫描</font>和<font color="red">全表扫描（无索引）</font>的连接所使用的缓冲区的大小。如果设置得过大，可能会浪费内存资源，尤其是当有很多并发连接时。</p>
<p><code>join_buffer_size</code> <font color="blue">只存储驱动表的部分数据（受buffer大小限制），Join 结果会输出到客户端或写入目标表，若是中间结果则使用<strong>临时表</strong>（内存临时表或磁盘临时表）。</font></p>
<p> <font color="red">当执行计划显示 <code>Using join buffer</code> ，小表驱动大表且小表 join 字段无法一次装入buffer，<code>SHOW STATUS LIKE &#39;Select_full_join&#39;;</code> 计数高，请考虑 优化索引和增加该变量值。</font></p>
<p>举例：</p>
<p>1、嵌套循环连接</p>
<p><strong>Nested Loop Join</strong>：遍历<strong>驱动表(外层表)</strong>，每次拿一行，逐行扫描**被驱动表(内层表)**做匹配，<strong>无需额外的缓冲区</strong>。当内层表很大时，即便 on 条件列有索引，效率也不够高。</p>
<p><strong>Block Nested Loop Join （BNLJ）</strong>：是Nested Loop Join的<strong>优化版</strong>，<strong>引入了缓存（buffer）批量读</strong>。外层表一次不是拿一行，而是<strong>拿一块（block）多行到内存（buffer）</strong>，然后扫描内层表时，与外层表的一个 block 数据进行比较，减少磁盘IO或扫描次数，提高join查询效率。<font color="red">MySQL实际执行是<strong>Block版</strong>！</font></p>
<p>执行计划显示：<code>Using Join buffer (Block Nested Loop)</code>。</p>
<p>2、哈希连接（Hash join）MySQL 8.0</p>
<p>本质上<strong>是 Block Nested Loop Join（BNLJ）的一种特殊优化版</strong>！以驱动表(外层表)的 join 字段为 key 建成一个<strong>哈希表（Hash Table）</strong>， join buffer 用作缓存这个哈希表数据，和 BNLJ 相同（先装入buffer、扫描内层表）。</p>
<p>把<strong>小表</strong>建成一个<strong>哈希表（Hash Table）<strong>用于驱动表(外层表)，Key 是 join 字段，一次拿一块（block）多行到内存（buffer），然后扫描</strong>大表</strong>，每一行根据 join key 去哈希表查找匹配。</p>
<p>执行计划显示：<code>Using join buffer (hash join)</code>。</p>
<p>3、合并连接（merge join &#x2F; Sort Merge Join）</p>
<p><strong>MySQL 8.0之后，开始正式引入对Sort-Merge Join的一些优化策略（主要是Hash Join更主流）。</strong></p>
<p>一般情况下，两表都有序（走索引或排序后），场景：大表 JOIN 大表。</p>
</li>
<li><p><strong><code>sort_buffer_size</code></strong>：**必须执行sort的<font color="red">每个连接</font>都会分配一个该大小的缓冲区。**不特定于任何存储引擎，并且以通用方式应用以进行优化。值必须足够大，以便在排序缓冲区中容纳十五个元组。增加 max_sort_length 的值可能需要增加 sort_buffer_size 的值。如果您在 SHOW GLOBAL STATUS 输出中看到每秒有许多 Sort_merge_passes，则可以考虑增加 sort_buffer_size 值以加快无法通过查询优化或改进索引来改进的 ORDER BY 或 GROUP BY 操作。默认262144(256KB)，最小32768(32KB)。</p>
<p>1、<strong>有索引的 sort 操作</strong>：如果在排序时能利用合适的索引，MySQL 会直接利用索引进行排序，而无需使用 <code>sort_buffer_size</code>。</p>
<p>2、<strong>无索引的 sort 操作</strong>：只要不能使用索引完成排序（ORDER BY &#x2F; GROUP BY），就需要借助 <code>sort_buffer_size</code> 完成，<font color="red">执行计划会显示 <code>Using filesort</code> 。当排序数据超出 <code>sort_buffer_size</code>，就会利用<strong>外部磁盘排序</strong>。若同时 <code>SHOW STATUS LIKE &#39;Sort_merge_passes&#39;;</code> 计数高，请考虑 优化索引和增加该变量值。</font></p>
</li>
</ul>
<h2 id="临时表"><a href="#临时表" class="headerlink" title="临时表"></a>临时表</h2><p>临时表是数据库中用于存储临时数据的表，<strong>主要用于</strong> group by、子查询、复杂查询 的<font color="red"><strong>中间结果存储</strong></font>。<strong>也可手动创建。</strong></p>
<p>仅对创建它的会话可见，其他会话无法访问，<font color="red">会话结束或连接关闭时自动删除</font>。</p>
<p>主要作用：</p>
<ul>
<li>存储复杂查询的中间结果，能够提高性能或简化查询逻辑。</li>
<li>减少对主表的操作负载。</li>
<li>数据清洗和转换。</li>
</ul>
<p>使用场景：</p>
<ul>
<li>数据转换和清洗。</li>
<li>临时存储计算结果。</li>
<li>提高复杂查询的性能。</li>
<li>分批处理大量数据。</li>
<li>简化复杂的多步骤查询。</li>
</ul>
<p>创建：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> temp_table (</span><br><span class="line">    id <span class="type">INT</span>,</span><br><span class="line">    name <span class="type">VARCHAR</span>(<span class="number">50</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> temp_data <span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> raw_data <span class="keyword">WHERE</span> status <span class="operator">=</span> <span class="string">&#x27;pending&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> TEMPORARY <span class="keyword">TABLE</span> temp_table;</span><br></pre></td></tr></table></figure>

<p>设置：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 临时表控制</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;%table_size%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name       <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------+ -- 默认16777216(16MB)。</span></span><br><span class="line"><span class="operator">|</span> max_heap_table_size <span class="operator">|</span> <span class="number">536870912</span> <span class="operator">|</span> <span class="comment">-- Both。每个连接 查询过程中由优化器创建的内存临时表(MEMORY引擎) 和 手动创建的MEMORY引擎表 的最大大小。</span></span><br><span class="line"><span class="operator">|</span> tmp_table_size      <span class="operator">|</span> <span class="number">536870912</span> <span class="operator">|</span> <span class="comment">-- Both。每个连接 查询过程中由优化器创建的内存临时表(MEMORY引擎) 的最大大小。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------------+-----------+ -- 内部临时表的最大上限是这两个参数中较小的那个。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>[!NOTE]</p>
<p><strong>内存临时表（MEMORY）</strong>：当临时表较小且符合 <code>tmp_table_size</code> 和 <code>max_heap_table_size</code> 限制时，MySQL 会使用 <strong>MEMORY</strong> 引擎来存储临时表。</p>
<p><strong>磁盘临时表（InnoDB）</strong>：如果临时表的大小超过内存限制，MySQL会将临时表从内存转移到磁盘，并使用磁盘上的存储引擎保存（8.0.16起仅支持<strong>InnoDB</strong>）。</p>
<p><font color="blue"><strong>建议：</strong><code>tmp_table_size</code> 应该等于 <code>max_heap_table_size</code>。</font></p>
</blockquote>
<p>了解 MySQL 在执行查询时创建临时表的情况：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 临时表统计</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">global</span> status <span class="keyword">like</span> <span class="string">&#x27;%tmp%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name           <span class="operator">|</span> <span class="keyword">Value</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+-----------+</span></span><br><span class="line"><span class="operator">|</span> Created_tmp_tables      <span class="operator">|</span> <span class="number">932876216</span> <span class="operator">|</span> <span class="comment">-- Both。所有创建的临时表的计数，不论临时表是存储在内存还是磁盘上。</span></span><br><span class="line"><span class="operator">|</span> Created_tmp_disk_tables <span class="operator">|</span> <span class="number">36731</span>     <span class="operator">|</span> <span class="comment">-- Both。在磁盘上创建的临时表的计数。</span></span><br><span class="line"><span class="operator">|</span> Created_tmp_files       <span class="operator">|</span> <span class="number">201307</span>    <span class="operator">|</span> <span class="comment">-- Global。在磁盘上创建的临时文件的计数。</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------------+-----------+</span></span><br></pre></td></tr></table></figure>

<p><font color="blue"><strong>磁盘临时表</strong> 和 <strong>临时文件</strong> ：</font></p>
<p><strong>临时文件</strong> 是 MySQL 用于存储 <strong>磁盘临时表</strong> 的物理文件。当 MySQL 需要将临时表存储在磁盘上时，它会创建这些临时文件以保存表的数据。临时文件通常存储在系统的临时目录中（<strong>由 tmpdir 参数指定</strong>）。</p>
<p>当 MySQL 创建磁盘临时表时，通常会为每个磁盘临时表生成一个或多个临时文件。这些文件用于存储临时表中的数据。通常一个磁盘临时表会有多个文件，特别是在临时表非常大时。例如，执行一个复杂查询时，MySQL 创建了一个磁盘临时表来存储中间结果数据，这个临时表会分配若干个临时文件，以便在磁盘上存储数据。<strong>查询结束后，这些临时文件和临时表会被删除</strong>。</p>
<h3 id="临时表落盘率"><a href="#临时表落盘率" class="headerlink" title="临时表落盘率"></a>临时表落盘率</h3><p><font color="blue"><strong>临时表落盘率</strong></font> &#x3D; <code>Created_tmp_disk_tables / Created_tmp_tables</code>。</p>
<ul>
<li>如果 临时表落盘率 较高（理想值：&lt; 10%），可以增大临时表，让更多的临时表保存在内存中，减少磁盘操作，前提是内存扛得住。</li>
<li>如果 <code>Created_tmp_tables</code> 值过高，检查查询中是否有不必要的临时表生成，尝试优化查询以减少临时表的使用，当查询无法优化时再增大临时表。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line"> round((disk.created_tmp_disk_tables <span class="operator">/</span> total.created_tmp_tables) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span>) <span class="keyword">as</span> tmp_disk_table_rate </span><br><span class="line"><span class="keyword">from</span></span><br><span class="line"> (<span class="keyword">select</span> variable_value <span class="keyword">as</span> created_tmp_disk_tables <span class="keyword">from</span> performance_schema.global_status <span class="keyword">where</span> variable_name <span class="operator">=</span> <span class="string">&#x27;created_tmp_disk_tables&#x27;</span>) disk,</span><br><span class="line"> (<span class="keyword">select</span> variable_value <span class="keyword">as</span> created_tmp_tables <span class="keyword">from</span> performance_schema.global_status <span class="keyword">where</span> variable_name <span class="operator">=</span> <span class="string">&#x27;created_tmp_tables&#x27;</span>) total;</span><br></pre></td></tr></table></figure>

<h1 id="MySQL-版本：创新和-LTS"><a href="#MySQL-版本：创新和-LTS" class="headerlink" title="MySQL 版本：创新和 LTS"></a>MySQL 版本：创新和 LTS</h1><p>MySQL 的发布模型分为两个主要版本：长期支持（LTS）和创新版本。所有 LTS 和创新版本均包含漏洞修复和安全更新，并被视为生产级质量。</p>
<h1 id="MySQL-程序"><a href="#MySQL-程序" class="headerlink" title="MySQL 程序"></a>MySQL 程序</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/programs.html">https://dev.mysql.com/doc/refman/8.4/en/programs.html</a></p>
<h2 id="MySQL-程序概述"><a href="#MySQL-程序概述" class="headerlink" title="MySQL 程序概述"></a>MySQL 程序概述</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/programs-overview.html">https://dev.mysql.com/doc/refman/8.4/en/programs-overview.html</a></p>
<h2 id="使用-MySQL-程序"><a href="#使用-MySQL-程序" class="headerlink" title="使用 MySQL 程序"></a>使用 MySQL 程序</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/programs-using.html">https://dev.mysql.com/doc/refman/8.4/en/programs-using.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/program-options.html">https://dev.mysql.com/doc/refman/8.4/en/program-options.html</a>	指定程序选项（指定选项文件、处理顺序等）。</p>
<h2 id="服务器和服务器启动程序"><a href="#服务器和服务器启动程序" class="headerlink" title="服务器和服务器启动程序"></a>服务器和服务器启动程序</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/programs-server.html">https://dev.mysql.com/doc/refman/8.4/en/programs-server.html</a></p>
<h3 id="mysqld"><a href="#mysqld" class="headerlink" title="mysqld"></a>mysqld</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqld.html">https://dev.mysql.com/doc/refman/8.4/en/mysqld.html</a></p>
<p><code>mysqld</code>（MySQL 服务器）命令会读取选项文件中 <strong>[mysqld]</strong> 选项组。</p>
<p><code>mysqld</code> —— MySQL 服务器主程序</p>
<ul>
<li><p><strong>全称</strong>：MySQL Daemon</p>
</li>
<li><p><strong>作用</strong>：这是 MySQL 数据库服务本身，负责启动数据库、监听端口、处理连接和 SQL。</p>
</li>
<li><p><strong>使用场景</strong>：</p>
<ul>
<li>启动数据库服务（最底层命令）</li>
<li>通常由 systemd 或 <code>mysqld_safe</code> 调用</li>
</ul>
</li>
<li><p><strong>常见用法</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --defaults-file=/etc/my.cnf --user=mysql</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="mysqld-safe"><a href="#mysqld-safe" class="headerlink" title="mysqld_safe"></a>mysqld_safe</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqld-safe.html">https://dev.mysql.com/doc/refman/8.4/en/mysqld-safe.html</a></p>
<p><code>mysqld_safe</code> 是 MySQL 服务启动脚本，内部调用 mysqld，所以会读取选项文件中 <strong>[mysqld]、[server] 和 [mysqld_safe]</strong> 选项组。</p>
<ul>
<li><p><strong>作用</strong>：启动 <code>mysqld</code>，并提供：</p>
<ul>
<li>日志写入功能</li>
<li>崩溃时自动重启（更稳定）</li>
<li>设置 <code>ulimit</code>、环境变量等预处理操作</li>
</ul>
</li>
<li><p><strong>使用场景</strong>：</p>
<ul>
<li>手动或早期系统中用于更安全地启动 MySQL</li>
<li><font color="red">现代系统中已逐步被 <code>systemd</code> 替代</font></li>
</ul>
</li>
<li><p><strong>常见用法</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld_safe --defaults-file=/opt/local/mysql/my.cnf --defaults-group-suffix=@3306 --user=mysql &amp;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="mysql-server"><a href="#mysql-server" class="headerlink" title="mysql.server"></a>mysql.server</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysql-server.html">https://dev.mysql.com/doc/refman/8.4/en/mysql-server.html</a></p>
<p><code>/data/local/mysql/support-files/mysql.server</code> 脚本通过 <code>mysqld_safe</code> 启动 MySQL 服务器，它读取选项文件中的 <strong>[mysql.server] 和 [mysqld]</strong> 选项组。为了向后兼容，它也会读取 <strong>[mysql_server]</strong> 部分，但为了保持最新，您应该将此类部分重命名为 [mysql.server]。</p>
<h3 id="mysqld-multi"><a href="#mysqld-multi" class="headerlink" title="mysqld_multi"></a>mysqld_multi</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqld-multi.html">https://dev.mysql.com/doc/refman/8.4/en/mysqld-multi.html</a></p>
<p><code>mysqld_multi</code> 命令会在 my.cnf 文件（或由 –defaults-file 选项指定的文件）中搜索名为 <strong>[mysqldN]</strong> 的选项组。N（选项组编号 或 GNR）用于区分不同的选项组，并作为 <code>mysqld_multi</code> 命令的参数，用于指定要启动、停止或获取状态报告的服务器。<strong>这些组中列出的选项与用于启动 mysqld 的 [mysqld] 组中使用的选项相同。有关在多服务器环境中哪些选项必须在每个服务器上唯一的更多信息，请参阅第 7.8 节 “<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/multiple-servers.html">在同一台机器上运行多个 MySQL 实例</a>”。</strong></p>
<p>另外，<code>/data/local/mysql/support-files/mysqld_multi.server</code> 脚本也使用此命令。<strong><code>mysqld_multi</code> 命令会在选项文件中搜索 [mysqld_multi] 和 [mysqldN] 选项组。[mysqld_multi] 组可用于设置 mysqld_multi 命令本身的相关选项。[mysqldN] 组可用于设置传递给特定 mysqld 实例的选项。</strong></p>
<p><font color="red"><code>--mysqld</code> ：mysqld_multi 独有选项，指定实际启动每个 MySQL 实例时所调用的程序。如果使用 <code>mysqld_safe</code> 启动服务器，就可以在 [mysqldN] 选项组中包含 mysqld 选项。</font></p>
<p><code>mysqld_multi</code> —— 多实例管理工具</p>
<ul>
<li><p><strong>作用</strong>：用于管理（启动、停止、查看状态）<strong>多个 MySQL 实例</strong>。</p>
</li>
<li><p><strong>原理</strong>：从 <code>[mysqldN]</code> 组读取配置，分别启动多个 <code>mysqld</code>。</p>
</li>
<li><p><strong>使用场景</strong>：</p>
<ul>
<li>在同一台机器上运行多个端口（如 3306、3307、3308）</li>
<li>适用于测试、隔离环境、主从部署</li>
</ul>
</li>
<li><p><strong>配置示例</strong>（写在 my.cnf 中）：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[mysqld_multi]</span><br><span class="line">mysqld=/usr/bin/mysqld_safe</span><br><span class="line">mysqladmin=/usr/bin/mysqladmin</span><br><span class="line">log=/opt/mysql/multi.log</span><br><span class="line"></span><br><span class="line">[mysqld3306]</span><br><span class="line">port=3306</span><br><span class="line">datadir=/opt/mysql/3306/data</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">[mysqld3307]</span><br><span class="line">port=3307</span><br><span class="line">datadir=/opt/mysql/3307/data</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>常用命令</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqld_multi start 3306,3307</span><br><span class="line">mysqld_multi stop 3306</span><br><span class="line">mysqld_multi report</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="客户端程序"><a href="#客户端程序" class="headerlink" title="客户端程序"></a>客户端程序</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/programs-client.html">https://dev.mysql.com/doc/refman/8.4/en/programs-client.html</a></p>
<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysql.html">https://dev.mysql.com/doc/refman/8.4/en/mysql.html</a></p>
<p><code>mysql</code> —— 主命令行客户端</p>
<ul>
<li><strong>作用</strong>：连接 MySQL 执行 SQL 命令。</li>
<li><strong>最常用的工具</strong>，你可以用它执行所有 DDL&#x2F;DML&#x2F;查询等操作。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --defaults-file=/data/local/mysql/my.cnf -h 127.0.0.1 -P 3306 -u root -p123456789 basedb --ssl-mode=disable</span><br></pre></td></tr></table></figure>

<p><font color="red">以 –ssl 开头的选项用于指定是否使用加密连接到服务器，并指示 SSL 密钥和证书的位置。</font></p>
<h3 id="mysqladmin"><a href="#mysqladmin" class="headerlink" title="mysqladmin"></a>mysqladmin</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqladmin.html">https://dev.mysql.com/doc/refman/8.4/en/mysqladmin.html</a></p>
<p><code>mysqladmin</code> —— 数据库管理工具</p>
<ul>
<li><strong>作用</strong>：控制&#x2F;监控 MySQL 服务。</li>
<li><strong>适合 DBA 做服务级操作</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqladmin -h 127.0.0.1 -P 3306 -u root -p123456789 shutdown           # 安全关闭服务</span><br><span class="line">mysqladmin -h 127.0.0.1 -P 3306 -u root -p123456789 status             # 显示连接数、查询等状态</span><br><span class="line">mysqladmin -h 127.0.0.1 -P 3306 -u root -p123456789 flush-privileges   # 刷新权限表</span><br></pre></td></tr></table></figure>

<h3 id="mysqldump"><a href="#mysqldump" class="headerlink" title="mysqldump"></a>mysqldump</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html">https://dev.mysql.com/doc/refman/8.4/en/mysqldump.html</a>	mysqldump 选项可以在 <strong>命令行中</strong> 或 <strong>选项文件的 [mysqldump] 和 [client] 组中</strong> 指定。</p>
<p><code>mysqldump</code> —— 逻辑备份工具</p>
<ul>
<li><strong>作用</strong>：导出数据库、表结构、数据。</li>
<li><strong>输出为 SQL 文件</strong>，可用来恢复、迁移或版本控制。</li>
</ul>
<h3 id="mysqlimport"><a href="#mysqlimport" class="headerlink" title="mysqlimport"></a>mysqlimport</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqlimport.html">https://dev.mysql.com/doc/refman/8.4/en/mysqlimport.html</a></p>
<p> <code>mysqlimport</code> —— 快速数据导入工具</p>
<ul>
<li><strong>作用</strong>：将 CSV&#x2F;TSV 文件导入 MySQL（基于 <code>LOAD DATA INFILE</code>）。</li>
<li><strong>比逐行插入 SQL 更快</strong></li>
</ul>
<h3 id="mysqlshow"><a href="#mysqlshow" class="headerlink" title="mysqlshow"></a>mysqlshow</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqlshow.html">https://dev.mysql.com/doc/refman/8.4/en/mysqlshow.html</a></p>
<p><code>mysqlshow</code> —— 快速查看元数据工具</p>
<ul>
<li><strong>作用</strong>：查看数据库、表、字段结构。</li>
<li><strong>不进入 MySQL 客户端即可查看结构</strong></li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqlshow -h 127.0.0.1 -P 3306 -u root -p123456789                      # 显示所有数据库</span><br><span class="line">mysqlshow -h 127.0.0.1 -P 3306 -u root -p123456789 basedb               # 显示数据库中的表</span><br><span class="line">mysqlshow -h 127.0.0.1 -P 3306 -u root -p123456789 basedb t_base_user   # 显示表结构（字段）</span><br></pre></td></tr></table></figure>

<h1 id="MySQL-服务器管理"><a href="#MySQL-服务器管理" class="headerlink" title="MySQL 服务器管理"></a>MySQL 服务器管理</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/server-administration.html">https://dev.mysql.com/doc/refman/8.4/en/server-administration.html</a></p>
<h2 id="MySQL服务器"><a href="#MySQL服务器" class="headerlink" title="MySQL服务器"></a>MySQL服务器</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqld-server.html">https://dev.mysql.com/doc/refman/8.4/en/mysqld-server.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/server-configuration-validation.html">https://dev.mysql.com/doc/refman/8.4/en/server-configuration-validation.html</a>	服务器配置验证</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/server-option-variable-reference.html">https://dev.mysql.com/doc/refman/8.4/en/server-option-variable-reference.html</a>	<font color="red">mysqld 中适用的所有命令行选项、系统变量和状态变量。</font></p>
<table>
<thead>
<tr>
<th>列名</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><strong>Cmd-Line</strong></td>
<td>✅ 是否可以通过命令行（如 <code>mysqld --port=3307</code>）设置该选项。即是否是服务器启动参数。</td>
</tr>
<tr>
<td><strong>Option File</strong></td>
<td>✅ 是否可以在配置文件（如 <code>my.cnf</code> 或 <code>my.ini</code>）中设置该参数。</td>
</tr>
<tr>
<td><strong>System Var</strong></td>
<td>✅ 是否为系统变量，可通过 <code>SET</code> 或 <code>SHOW VARIABLES</code> 查看或设置，如 <code>SET GLOBAL max_connections = 200;</code>。</td>
</tr>
<tr>
<td><strong>Status Var</strong></td>
<td>✅ 是否为状态变量，可通过 <code>SHOW STATUS</code> 查看运行时统计信息，比如连接数、IO 等。</td>
</tr>
<tr>
<td><strong>Var Scope</strong></td>
<td>标明变量作用域是 <code>Global</code>（全局）、<code>Session</code>（会话）或两者都支持（<code>Both</code>）。</td>
</tr>
<tr>
<td><strong>Dynamic</strong></td>
<td>✅ 是否支持 <strong>动态修改</strong>。比如如果是动态的，就可以在不重启服务器的情况下用 <code>SET GLOBAL</code> 修改；如果是 No，则必须重启 MySQL 服务才能生效。</td>
</tr>
</tbody></table>
<h2 id="MySQL服务器插件"><a href="#MySQL服务器插件" class="headerlink" title="MySQL服务器插件"></a>MySQL服务器插件</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/server-plugins.html">https://dev.mysql.com/doc/refman/8.4/en/server-plugins.html</a></p>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><h2 id="访问控制和账户管理"><a href="#访问控制和账户管理" class="headerlink" title="访问控制和账户管理"></a>访问控制和账户管理</h2><h3 id="MySQL-提供的权限"><a href="#MySQL-提供的权限" class="headerlink" title="MySQL 提供的权限"></a>MySQL 提供的权限</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html">https://dev.mysql.com/doc/refman/8.4/en/privileges-provided.html</a></p>
<h3 id="设置账户资源限制"><a href="#设置账户资源限制" class="headerlink" title="设置账户资源限制"></a>设置账户资源限制</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/user-resources.html">https://dev.mysql.com/doc/refman/8.4/en/user-resources.html</a></p>
<p>用户级别的限制：最大用户连接数、最大每小时查询数、最大每小时更新数、最大每小时连接数</p>
<h2 id="使用加密连接"><a href="#使用加密连接" class="headerlink" title="使用加密连接"></a>使用加密连接</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/encrypted-connections.html">https://dev.mysql.com/doc/refman/8.4/en/encrypted-connections.html</a></p>
<h3 id="配置-MySQL-使用加密连接"><a href="#配置-MySQL-使用加密连接" class="headerlink" title="配置 MySQL 使用加密连接"></a>配置 MySQL 使用加密连接</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/using-encrypted-connections.html">https://dev.mysql.com/doc/refman/8.4/en/using-encrypted-connections.html</a></p>
<p>有多个配置参数可用于指定是否使用加密连接，以及指定相应的证书和密钥文件。本节提供关于配置服务器和客户端以支持加密连接的通用指南：</p>
<ul>
<li><p>服务器端加密连接的启动配置</p>
</li>
<li><p>服务器端加密连接的运行时配置和监控</p>
</li>
<li><p>客户端加密连接配置           <code>mysql --ssl-mode=disable</code> </p>
</li>
<li><p>配置证书验证强制执行</p>
</li>
<li><p>配置加密连接为强制要求</p>
</li>
</ul>
<h3 id="加密连接-TLS-协议和密码"><a href="#加密连接-TLS-协议和密码" class="headerlink" title="加密连接 TLS 协议和密码"></a>加密连接 TLS 协议和密码</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/encrypted-connection-protocols-ciphers.html">https://dev.mysql.com/doc/refman/8.4/en/encrypted-connection-protocols-ciphers.html</a></p>
<h1 id="备份和恢复"><a href="#备份和恢复" class="headerlink" title="备份和恢复"></a>备份和恢复</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/backup-and-recovery.html">https://dev.mysql.com/doc/refman/8.4/en/backup-and-recovery.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/backup-types.html">https://dev.mysql.com/doc/refman/8.4/en/backup-types.html</a>	备份和恢复类型</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/backup-methods.html">https://dev.mysql.com/doc/refman/8.4/en/backup-methods.html</a>	数据库备份方法</p>
<h2 id="使用-mysqldump-进行备份"><a href="#使用-mysqldump-进行备份" class="headerlink" title="使用 mysqldump 进行备份"></a>使用 mysqldump 进行备份</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/using-mysqldump.html">https://dev.mysql.com/doc/refman/8.4/en/using-mysqldump.html</a></p>
<h3 id="SQL-格式-常用"><a href="#SQL-格式-常用" class="headerlink" title="SQL 格式-常用"></a>SQL 格式-常用</h3><p><font color="black" size="4"><em><strong>使用 mysqldump 转储 SQL 格式的数据：</strong></em></font></p>
<p>打印从选项文件中获取的所有选项：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump --defaults-file=/data/local/mysql/my.cnf  --<span class="built_in">print</span>-defaults</span><br></pre></td></tr></table></figure>

<p>场景：将数据库从一个服务器复制到另一个服务器。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 使用 --all-databases 或 --databases 选项时，mysqldump 会在每个数据库的导出输出之前写入 CREATE DATABASE 和 USE 语句。这确保了当导出文件被重新加载时，如果数据库不存在，它会创建该数据库并将其设为默认数据库，从而将数据库内容加载到与原始数据库相同的数据库中。若需强制在重建数据库前先删除每个数据库，请同时使用 --add-drop-database 选项。此时，mysqldump 会在每个 CREATE DATABASE 语句前写入 DROP DATABASE 语句。</span><br><span class="line">mysqldump -S /tmp/mysql_3306.sock -u root -p123456789 --all-databases &gt; dump.sql</span><br><span class="line">mysqldump -S /tmp/mysql_3306.sock -u root -p123456789 --databases basedb archedb &gt; dump.sql</span><br></pre></td></tr></table></figure>

<p>场景：制作数据库副本。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 在单数据库情况下，可以省略 --databases 选项，如果不使用 --databases 选项，导出文件中将不包含任何 CREATE DATABASE 或 USE 语句。这有以下几点影响：</span><br><span class="line"># <span class="number">1</span>、当你重新加载导出文件时，必须指定一个默认数据库名称，以便服务器知道要重新加载哪个数据库。</span><br><span class="line"># <span class="number">2</span>、在重新加载时，您可以指定与原始名称不同的数据库名称，从而将数据重新加载到不同的数据库中。</span><br><span class="line"># <span class="number">3</span>、如果要重新加载的数据库不存在，您必须先创建它。</span><br><span class="line"># <span class="number">4</span>、由于输出中不包含 CREATE DATABASE 语句，因此 --add-drop-database 选项无效。如果您使用该选项，它将不会生成 DROP DATABASE 语句。</span><br><span class="line">mysqldump -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 basedb &gt; basedb.sql</span><br><span class="line">mysqldump -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 basedb t_base_country t_base_nation &gt; basedb.sql # 指定导出表</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 常用选项：</span><br><span class="line"># --quick				此选项适用于导出大型表。它强制 mysqldump 每次从服务器获取表中的一行数据，而不是先将整个行集从服务器获取并缓存在内存中，然后再写出。</span><br><span class="line"># --single-transaction	此选项将事务隔离级别设置为可重复读（REPEATABLE READ），并在导出数据前向服务器发送<span class="built_in">START</span> TRANSACTION SQL语句。该选项仅适用于事务性表（如InnoDB），因为它能在不阻塞任何应用程序的情况下，导出在<span class="built_in">START</span> TRANSACTION语句执行时数据库的一致状态。要导出大型表，请将 --single-transaction 选项与 --quick 选项结合使用。</span><br><span class="line"># --skip-lock-tables	避免表锁，因为 --single-transaction 比 --lock-tables 更优。实测，加了也没效果，也许是某些选项强制锁表。</span><br><span class="line"># --hex-blob			使用十六进制表示法导出二进制列。受影响的数据类型包括 BINARY、VARBINARY、BLOB 类型、BIT、所有空间数据类型 等等。</span><br><span class="line"># --create-options      在 CREATE TABLE 语句中包含所有 MySQL 特定的表选项（ENGINE=、AUTO_INCREMENT=、COLLATE=）。似乎没有相反的选项！！！</span><br><span class="line"># --routines --triggers --events   导出存储过程和函数，导出触发器，导出事件调度器</span><br><span class="line"># --insert-ignore		使用INSERT IGNORE语句而非INSERT语句。</span><br><span class="line"># --extended-insert		扩展插入语句（一次插多行），可提高插入效率。使用包含多个VALUES列表的多行语法编写INSERT语句。这将生成较小的导出文件，并在重新加载文件时加快插入速度。</span><br><span class="line"># --<span class="built_in">replace</span>             使用<span class="built_in">REPLACE</span>语句而非INSERT语句。</span><br><span class="line"># --add-drop-table      在每个CREATE TABLE语句之前编写一个DROP TABLE语句。</span><br><span class="line"># --order-by-primary    按表的主键排序导出每张表的行，如果存在第一个唯一索引，则按该索引排序。这在将MyISAM表导出以加载到InnoDB表时非常有用，但会使导出操作耗时显著增加。</span><br><span class="line">mysqldump -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 \</span><br><span class="line">  --quick \</span><br><span class="line">  --single-transaction \</span><br><span class="line">  --hex-blob \</span><br><span class="line">  --create-options \</span><br><span class="line">  --routines --triggers --events \</span><br><span class="line">  --insert-ignore \</span><br><span class="line">  --extended-insert \</span><br><span class="line">  --add-drop-table \</span><br><span class="line">  --order-by-primary \</span><br><span class="line">  basedb &gt; basedb.sql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># --no-data 			选项指示 mysqldump 不要导出表数据，导出文件仅包含创建表的语句。</span><br><span class="line"># --no-create-info 		选项指示 mysqldump 从输出中抑制 CREATE 语句，导出文件仅包含表数据。</span><br><span class="line"># 例如，要分别导出 basedb 库的定义和数据，请使用以下命令：</span><br><span class="line">mysqldump -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 --no-data --routines --triggers basedb &gt; basedb-defs.sql</span><br><span class="line">mysqldump -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 --no-create-info basedb &gt; basedb-data.sql</span><br></pre></td></tr></table></figure>

<p><font color="black" size="4"><em><strong>重新加载 SQL 格式的备份：</strong></em></font></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 使用 --all-databases 或 --databases 选项生成的备份文件包含 CREATE DATABASE 和 USE 语句，无需指定默认数据库来加载数据。否则必须指定数据库：</span><br><span class="line">$&gt; mysql -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 basedb &lt; basedb.sql</span><br><span class="line"># 或者，在 MySQL 中使用 source 命令：</span><br><span class="line">mysql&gt; source /data/local/filebrowser/admin/backup/basedb.sql</span><br></pre></td></tr></table></figure>

<h3 id="分隔文本格式-了解"><a href="#分隔文本格式-了解" class="headerlink" title="分隔文本格式-了解"></a>分隔文本格式-了解</h3><p><font color="black" size="4"><em><strong>使用 mysqldump 转储分隔文本格式的数据：</strong></em></font></p>
<p>如果你使用 –tab&#x3D;dir_name 选项调用 mysqldump，它会将 dir_name 作为<strong>输出目录</strong>（<font color="red"><strong>依赖 <code>secure_file_priv</code> 的设置，指定的目录必须是 <code>secure_file_priv</code> 允许写入的路径</strong></font>），并在此目录中单独导出每个表，每个表使用两个文件。表名是这些文件的基础名称。对于名为 t1 的表，文件名为 t1.sql 和 t1.txt。 .sql 文件包含该表的 CREATE TABLE 语句。 .txt 文件包含表数据，每行对应表中的一行数据。</p>
<blockquote>
<p><strong>服务器将导出表的 CREATE 定义发送给 mysqldump，后者将其写入 .sql 文件。因此，这些文件的所有者是执行 mysqldump 的用户。</strong></p>
<p>包含表格数据的.txt文件由服务器生成，因此这些文件归属于运行服务器的系统账户。服务器使用 <strong>SELECT … INTO OUTFILE</strong> 语句来写入这些文件，因此您必须具备FILE权限才能执行此操作，<strong>如果指定的.txt文件已存在，则会发生错误</strong>。</p>
</blockquote>
<p>对于 –tab&#x3D;dir_name，服务器默认将表数据写入 .txt 文件，每行一行，列值之间用制表符分隔，列值周围没有引号，换行符作为行终止符。（<strong>这些默认设置与 SELECT … INTO OUTFILE 相同。</strong>）</p>
<p>要使数据文件能够使用不同的格式进行写入，mysqldump 支持以下选项：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">--fields-terminated-by=str				# 用于分隔列值的字符串（默认：制表符）。</span><br><span class="line">--fields-enclosed-by=char				# 用于包围列值的字符（默认：无字符）。</span><br><span class="line">--fields-optionally-enclosed-by=char	# 用于包围非数字列值的字符（默认：无字符）。</span><br><span class="line">--fields-escaped-by=char				# 用于转义特殊字符的字符（默认：不转义）。</span><br><span class="line">--lines-terminated-by=str				# 行结束字符串（默认：换行符）。</span><br></pre></td></tr></table></figure>

<p>根据您为这些选项中的任何一个指定的值，可能需要在命令行中对值进行适当的引号或转义处理，以适应您的命令解释器。或者，您可以使用十六进制表示法指定值。假设您希望 mysqldump 在双引号内引用列值。为此，请将双引号指定为 –fields-enclosed-by 选项的值。但此字符通常对命令解释器具有特殊含义，因此必须特殊处理。例如，在 Unix 系统中，您可以通过以下方式引用双引号：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">--fields-enclosed-by=&#x27;&quot;&#x27;</span><br><span class="line"># 在任何平台上都使用十六进制格式指定该值。ASCII 码共定义了 <span class="number">128</span> 个字符，双引号对应的的 ASCII 值是 <span class="number">34</span>，十进制转成十六进制就是 <span class="number">22</span></span><br><span class="line">--fields-enclosed-by=<span class="number">0</span>x22</span><br></pre></td></tr></table></figure>

<p>通常会同时使用多个数据格式化选项。例如，以逗号分隔值格式导出表格、每行以换行符（\n 或 \r\n）结尾，请使用以下命令（将其输入到一行中）：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 \</span><br><span class="line">  --tab=/data/local/mysql/<span class="number">3306</span>/mysql-files \</span><br><span class="line">  --fields-terminated-by=&#x27;,&#x27; \</span><br><span class="line">  --lines-terminated-by=&#x27;\n&#x27; \</span><br><span class="line">  basedb t_base_country t_base_nation</span><br><span class="line"></span><br><span class="line"># 只导出包含表格数据的.txt文件</span><br><span class="line">mysql&gt; SELECT * INTO OUTFILE &#x27;/data/local/mysql/<span class="number">3306</span>/mysql-files/t_base_country.txt&#x27;</span><br><span class="line">          fields terminated by &#x27;,&#x27;</span><br><span class="line">          lines terminated by &#x27;\n&#x27;</span><br><span class="line">          FROM t_base_country;</span><br></pre></td></tr></table></figure>

<p><font color="red"><strong>如果您使用任何数据格式化选项导出表数据，则在后续重新加载数据文件时，必须指定相同的格式，以确保文件内容能被正确解析。</strong></font></p>
<p><font color="blue"><strong>建议仅将 –tab 选项用于导出本地服务器。若与远程服务器配合使用，–tab 目录必须在本地和远程主机上均存在，且 .txt 文件由服务器写入远程目录（服务器主机上），而 .sql 文件则由 mysqldump 写入本地目录（客户端主机上）。</strong></font></p>
<p><font color="black" size="4"><em><strong>重新加载分隔文本格式的备份：</strong></em></font></p>
<p>使用 mysqldump –tab 命令生成的备份中，每个表在输出目录中由一个 .sql 文件和一个 .txt 文件表示。其中，.sql 文件包含该表的 CREATE TABLE 语句，而 .txt 文件包含该表的数据。</p>
<p>首先切换到输出目录，然后使用 mysql 处理 .sql 文件以创建一个空表：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/local/mysql/<span class="number">3306</span>/mysql-files</span><br><span class="line">mysql -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 basedb &lt; t_base_country.sql</span><br></pre></td></tr></table></figure>

<p>再使用 mysqlimport 处理 .txt 文件以将数据加载到表中，<font color="red"><strong>要求导入文件名必须与表名一致（如 <code>t_base_country.csv</code> ➜ <code>t_base_country</code> 表）</strong></font>。<font color="blue"><strong>使用 mysqlimport 加载数据文件的替代方法是通过 mysql 客户端使用 LOAD DATA 语句：</strong></font></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 basedb t_base_country.txt</span><br><span class="line"># 替代方法</span><br><span class="line">mysql&gt; load data infile &#x27;t_base_country.txt&#x27; into table basedb.t_base_country;</span><br></pre></td></tr></table></figure>

<p><font color="red">如果您在最初导出表时使用了任何数据格式化选项，则在使用 mysqlimport 或 LOAD DATA 导入数据时，必须使用相同的选项，以确保正确解析数据文件的内容：</font></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysqlimport -h <span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span> -P <span class="number">3306</span> -u root -p123456789 \</span><br><span class="line">  --fields-terminated-by=&#x27;,&#x27; \</span><br><span class="line">  --lines-terminated-by=&#x27;\n&#x27; \</span><br><span class="line">  basedb t_base_country.txt t_base_nation.txt</span><br><span class="line"># 替代方法</span><br><span class="line">mysql&gt; load data infile &#x27;/data/local/mysql/<span class="number">3306</span>/mysql-files/t_base_country.txt&#x27; into table basedb.t_base_country</span><br><span class="line">       fields terminated by &#x27;,&#x27;</span><br><span class="line">       lines terminated by &#x27;\n&#x27;;</span><br></pre></td></tr></table></figure>

<h1 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h1><h2 id="优化概述"><a href="#优化概述" class="headerlink" title="优化概述"></a>优化概述</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimize-overview.html">https://dev.mysql.com/doc/refman/8.4/en/optimize-overview.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimize-overview.html#optimize-database-level">数据库级别优化</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimize-overview.html#optimize-hardware-level">硬件层面的优化</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimize-overview.html#optimize-portability-performance">平衡便携性和性能</a></li>
</ul>
<h2 id="优化-SQL-语句"><a href="#优化-SQL-语句" class="headerlink" title="优化 SQL 语句"></a>优化 SQL 语句</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/statement-optimization.html">https://dev.mysql.com/doc/refman/8.4/en/statement-optimization.html</a></p>
<h2 id="优化和索引"><a href="#优化和索引" class="headerlink" title="优化和索引"></a>优化和索引</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimization-indexes.html">https://dev.mysql.com/doc/refman/8.4/en/optimization-indexes.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/indexes.html">https://www.postgresql.org/docs/current/indexes.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/indexes-and-index-organized-tables.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/indexes-and-index-organized-tables.html</a></p>
<p>要提升SELECT操作的性能，最佳方法是在查询中涉及的列上创建索引。索引条目类似于指向表行的指针，使查询能够快速确定哪些行符合WHERE子句中的条件，并检索这些行的其他列值。MySQL的所有数据类型均可创建索引。</p>
<p>尽管可能有诱惑力为查询中使用的每个可能列创建索引，但不必要的索引会浪费空间并浪费 MySQL 确定使用哪个索引的时间。索引还会增加插入、更新和删除的成本，因为每个索引都必须更新。您必须找到合适的平衡点，以使用最优的索引集实现快速查询。</p>
<p><font coor size="5"><strong>索引失效场景</strong></font></p>
<p>联合索引的使用不满足最左前缀原则</p>
<p>索引列使用了 函数 或 参与运算：<code>where id / 10 &gt; 8</code> </p>
<p>4、like 的占位符位于条件的首部</p>
<p>5、索引列发生隐式转换（若索引字段为int，参数为varchar，mysql会将参数转化为int类型，依旧会走索引）</p>
<p>6、or两边出现非索引列</p>
<p>7、or两边出现 “&gt;” 和 “&lt;” 范围查询，即便是索引列也不会走</p>
<p>8、两个索引列做比较</p>
<p>使用 “&lt;&gt;” 或 “!&#x3D;” 作为条件查询时，需要慎重，普通索引会查询结果集占比，较大时索引会失效。</p>
<p>is not null；如果加上 limit n，当 n 很小时索引有效。</p>
<p>not in：主键索引有效；普通索引失效；普通索引 + limit n，当 n 很小时索引有效。</p>
<p>12、not exists：索引失效。</p>
<p>13、当进行范围查询（&gt;、&lt; 、&gt;&#x3D;、&lt;&#x3D;、in等条件）时，根据查询结果占全表数据比例的不同，优化器有可能会放弃索引，进行全表扫描。举例，当Mysql发现通过索引扫描的行记录数超过全表的10%-30%时，优化器可能会放弃走索引，自动变成全表扫描。</p>
<h2 id="优化数据库结构"><a href="#优化数据库结构" class="headerlink" title="优化数据库结构"></a>优化数据库结构</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimizing-database-structure.html">https://dev.mysql.com/doc/refman/8.4/en/optimizing-database-structure.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/column-count-limit.html">https://dev.mysql.com/doc/refman/8.0/en/column-count-limit.html</a>	表列数和行大小的限制</p>
<h2 id="了解执行计划"><a href="#了解执行计划" class="headerlink" title="了解执行计划"></a>了解执行计划</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/execution-plan-information.html">https://dev.mysql.com/doc/refman/8.4/en/execution-plan-information.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/indexes-examine.html">https://www.postgresql.org/docs/current/indexes-examine.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/tgsql/preface.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/tgsql/preface.html</a></p>
<p>使用 <code>EXPLAIN</code> 来分析查询语句的执行计划，<strong>了解 MySQL 优化器如何实际执行 SQL</strong>，从而优化性能。EXPLAIN 输出的关键内容包括：</p>
<p>执行计划：分析查询语句explain或describe(表的读取顺序、读取数据的访问类型、哪些索引可以使用、哪些索引被实际使用、表之间的引用、使用索引长度、每张表有多少行被优化器查询)。</p>
<ul>
<li><p>id：id值越大，优先级越高，越先执行；id相同是一组，从上往下顺序执行；id号每个号码，表示一趟独立的查询, 一个sql的查询趟数越少越好；</p>
</li>
<li><p>type：表的访问类型，从好到坏：<code>system、const、eq_ref、ref、fulltext、ref_or_null、index_merge、unique_subquery、index_subquery、range、index、ALL</code><br><code>system</code>：当表中<code>只有一条记录</code>并且该表使用的存储引擎的统计数据是精确的，比如MyISAM、Memory。<br><code>const</code>：根据主键或者唯一二级索引列与常数进行等值匹配时出现，比如对单表使用where等值匹配查询就是<code>const</code>。<br><code>eq_ref</code>：对被驱动表的访问方法。在连接查询时，当被驱动表通过主键或者唯一二级索引列等值匹配的方式进行访问情况下会出现。<br><code>ref</code>：当通过普通的二级索引列与常量进行等值匹配时，对表的访问类型就可能是<code>ref</code>。<br><code>ref_or_null</code>：当对普通二级索引进行等值匹配查询，该索引列的值也可以是<code>NULL</code>值时，对表的访问类型就可能是<code>ref_or_null</code>。<br><code>index_merge</code>：索引合并，利用多个索引，<code>key</code> 和 <code>key_len</code> 是多个值。一般情况下对于某个表的查询只能使用到一个索引，当使用 <code>or</code>、<code>union</code>、<code>union all</code> 时会出现？<br><code>unique_subquery</code>：子查询包含<code>IN</code>，若查询优化器决定将<code>IN</code>子查询转换为<code>EXISTS</code>子查询，而且子查询可以使用到主键进行等值匹配时出现。<br><code>index_subquery</code>：子查询使用普通索引<br><code>range</code>：范围索引，使用 <code>in</code>、<code>between</code>、<code>&gt;</code>、<code>&lt;</code> 时会出现。<br><code>index</code>：当使用索引覆盖，但需要扫描全部的索引记录时出现。覆盖索引：非聚簇复合索引包括查询里的SELECT、JOIN和WHERE子句用到的所有列（ <code>索引列+主键</code> 包含 <code>SELECT 到 FROM之间查询的列</code> ），无需回表。联合索引不能直接进行<code>ref</code>和<code>range</code>访问，只能扫描整个索引的记录。<br><code>all</code>：全表扫描。</p>
</li>
<li><p>possible_keys和key：<code>可能用到的索引</code> 和 <code>实际使用的索引</code>。一个字段可能存在多个索引（单列索引、联合索引）。</p>
</li>
<li><p>key_len：实际使用到的索引长度，帮助检查 <code>是否充分的利用了索引</code>，<code>值越大越好</code>，主要对 <code>联合索引</code> 有参考意义。</p>
</li>
<li><p>ref：当前索引被哪个列(前一张表的关联字段)或常量(where&#x3D;’a’)使用。</p>
</li>
<li><p>rows：预估的需要读取或扫描的行数，即使用索引过滤后剩下的行数。值越大性能越差。</p>
</li>
<li><p>filtered：<code>最终行数</code> 占 <code>通过指定索引过滤剩下的行数（即 rows）</code> 的百分比。</p>
</li>
<li><p>Extra：包含不适合在其他列中显示但十分重要的额外信息，帮助更准确的理解MySQL到底将如何执行给定的查询语句，额外信息有好几十个，官网 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/explain-output.html#explain-extra-information">EXPLAIN Extra Information</a> 。举例：</p>
<p><code>No tables used</code>：没有<code>FROM</code>子句时。<br><code>Impossible WHERE</code>：<code>where</code>子句永远为 <code>FALSE</code> 时，即查询结果为0行。<br><code>Using where</code>：使用了 <code>where</code> 过滤。<br><code>Using index</code>：仅使用索引树中的信息即可从表中检索列信息（覆盖索引），而无需执行额外的查找来读取实际行（无需回表）。<br><code>Using index condition</code>：where中虽然出现了索引列，却不能使用索引。比如 <code>WHERE key1 &gt; &#39;z&#39; AND key1 LIKE &#39;%a&#39;;</code>，最后一个条件未使用索引。<br><code>Using join buffer (Block Nested Loop)</code>：官方：将早期连接的表分部分读入连接缓冲区，然后使用缓冲区中的行与当前表执行连接。也就是说，EXPLAIN 输出中上一行表中的键被缓冲，并且从出现 Using join buffer 的行所表示的表中分批获取匹配的行。尚硅谷：在连接查询执行过程中，当被驱动表不能有效的利用索引加快访问速度，MySQL一般会为其分配一块名叫<code>join buffer</code>的内存块来加快查询速度，也就是我们所讲的<code>基于块的嵌套循环算法</code>。<br><code>Using sort_union(...), Using union(...), Using intersect(...)</code>：访问类型为 <code>index_merge</code> 时会出现。<br><code>Using temporary</code>：查询过程中需要创建临时表来保存中间结果。比如包含 distinct、group by、order by、union 等子句的查询过程中，如果不能有效利用索引完成查询，很可能会建立临时表。最好使用索引替换掉临时表。<br><code>Using filesort</code>：排序时没走索引，利用 sort_buffer 或 外部磁盘 排序。若使用 <code>文件排序</code> 检索的行非常多，必须优化为 <code>索引排序</code> 检索。</p>
</li>
</ul>
<h2 id="优化-MySQL-服务器"><a href="#优化-MySQL-服务器" class="headerlink" title="优化 MySQL 服务器"></a>优化 MySQL 服务器</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimizing-server.html">https://dev.mysql.com/doc/refman/8.4/en/optimizing-server.html</a></p>
<h2 id="调优总结"><a href="#调优总结" class="headerlink" title="调优总结"></a>调优总结</h2><p><img src="/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/image-20250723171109172.png" alt="image-20250723171109172"></p>
<p>先查看慢查询日志或通过 <code>performance_schema</code> 找到慢的 SQL。接着用 <code>EXPLAIN</code> 看执行计划，关注是否用了索引、是否 filesort 或临时表。检查 SQL 是否有函数包列、隐式转换、返回行数是否过多。根据具体问题会考虑加索引、改写 SQL 或做数据结构优化等。</p>
<ol>
<li><strong>先看总耗时（events_statements）</strong></li>
<li><strong>再拆分阶段（events_stages）</strong></li>
<li><strong>看是否有等待（events_waits）</strong></li>
<li><strong>配合 <code>EXPLAIN ANALYZE</code> 看是否计划走错方向</strong></li>
<li><strong>排除客户端网络问题</strong></li>
</ol>
<h3 id="慢查询日志文件轮转"><a href="#慢查询日志文件轮转" class="headerlink" title="慢查询日志文件轮转"></a>慢查询日志文件轮转</h3><p>默认 Linux 系统中，logrotate 是每天跑一次：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 列出 /etc 目录中与 cron 相关的配置目录或文件</span><br><span class="line">ll /etc | grep cron</span><br><span class="line"># 查看 logrotate 默认每天执行了什么</span><br><span class="line">cat /etc/cron.daily/logrotate</span><br><span class="line"># logrotate 默认配置文件：</span><br><span class="line">cat /etc/logrotate.conf</span><br></pre></td></tr></table></figure>

<p>创建配置文件 <code> truncate -s 0 /etc/logrotate.d/mysql-slow-3306 &amp;&amp; vim /etc/logrotate.d/mysql-slow-3306</code>：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">/data/local/mysql/<span class="number">3306</span>/data/localhost-slow.log &#123;</span><br><span class="line">#轮转设置</span><br><span class="line">    # 最多保留多少个“历史轮转日志文件”</span><br><span class="line">    rotate <span class="number">10</span></span><br><span class="line">    # 日志文件被移动到指定目录进行轮换。该目录必须与被轮换的日志文件位于同一物理设备上，除非使用了<span class="built_in">copy</span>、copytruncate或renamecopy选项。除非指定了绝对路径名，否则该目录默认相对于存储日志文件的目录。当使用此选项时，所有旧版本的日志文件都会被移动到指定目录。此选项可被noolddir选项覆盖。</span><br><span class="line">    olddir ./</span><br><span class="line"></span><br><span class="line">#轮转频率控制</span><br><span class="line">    # 日志文件每小时轮换一次。请注意，hourly、daily、weekly、monthly 都不是定时器，它们只是条件标签。真正决定“什么时候轮转日志”的，是系统定期运行 logrotate 的方式（如 cron 或 systemd.timer）。</span><br><span class="line">    #daily</span><br><span class="line">    # 只有超过指定大小的日志才会轮转，不看时间。与 hourly、daily、weekly、monthly 等时间选项互斥，如果你同时写了 daily 和 size，则最后写的生效。使用场景：只想根据大小轮转，忽略时间。</span><br><span class="line">    size <span class="number">100</span>M</span><br><span class="line"></span><br><span class="line">#文件筛选规则</span><br><span class="line">    # 如果日志文件缺失，则继续处理下一个文件，且不显示错误信息。</span><br><span class="line">    missingok</span><br><span class="line">    # 如果日志为空，则不轮转日志（此设置将覆盖 ifempty 选项）。</span><br><span class="line">    notifempty</span><br><span class="line">    # 删除旋转后超过多少天的日志文件。仅在日志文件需要旋转时才会检查日志文件的年龄。如果已配置maillast和mail，则文件将被发送到配置的地址。</span><br><span class="line">    maxage <span class="number">30</span></span><br><span class="line">    # 如果日志文件超过 maxsize，就轮转，不等待 daily/weekly 等时间条件到达。使用 maxsize 时，logrotate 会综合考虑文件大小和轮转时间，谁先满足就触发y一次轮转。与时间（daily/weekly）兼容。maxsize 和 size 选择一个即可，若想忽略时间，请使用 size。</span><br><span class="line">    #maxsize <span class="number">100</span>M</span><br><span class="line"></span><br><span class="line">#Files and Folders</span><br><span class="line">    # 轮转完成后、postrotate 脚本执行前，立刻创建一个新的空日志文件，文件名和被轮转的原日志文件相同。可以用 nocreate 来关闭 create 的效果，即轮转后不新建日志文件。</span><br><span class="line">    #create <span class="number">640</span> mysql mysql</span><br><span class="line">    # 不重命名、不移动原始日志文件，而是先复制一份，然后把原日志文件就地清空（置零）。从复制到清空之间，日志文件仍在增长，所以这个瞬间写入的数据可能丢失。用了 copytruncate，日志文件不会被新建，所以 create 选项设置的权限、属主都无效。olddir 可以放在另一个挂载点（设备），copytruncate 支持这种行为。扩展：有些程序无法接收重新打开日志文件的信号，比如 MySQL、Nginx 如果没有专门信号或命令，就会继续写老文件。这时，如果你重命名了旧日志，它仍然写的是“被你重命名但文件句柄未关闭”的文件。</span><br><span class="line">    copytruncate</span><br><span class="line"></span><br><span class="line">#Compression</span><br><span class="line">    # 不压缩旧日志</span><br><span class="line">    nocompress</span><br><span class="line"></span><br><span class="line">#Filenames</span><br><span class="line">    <span class="built_in">start</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">#Mail</span><br><span class="line">    # 当日志被轮换删除时，它将被发送到指定地址。如果某个日志不应生成邮件，可以使用 nomail 指令。注意：需要安装并配置邮件服务（MTA），步骤如下：</span><br><span class="line">    # <span class="number">1</span>、安装 postfix：yum install postfix</span><br><span class="line">    # <span class="number">2</span>、配置 Postfix 使用外部 SMTP 服务器：vim /etc/postfix/main.cf</span><br><span class="line">    mail v_zhaolanqi@baidu.com</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>强行轮转一次，可用于测试配置是否有效L：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logrotate -f /etc/logrotate.d/mysql-slow-<span class="number">3306</span></span><br></pre></td></tr></table></figure>

<p><font color="red">每小时执行一次</font>，<code>vim /etc/cron.hourly/logrotate-hourly</code> ：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># -f 表示强制轮转</span><br><span class="line">#/usr/sbin/logrotate -f /etc/logrotate.d/mysql-slow-<span class="number">3306</span></span><br><span class="line">/usr/sbin/logrotate /etc/logrotate.d/mysql-slow-<span class="number">3306</span></span><br></pre></td></tr></table></figure>

<p>赋予可执行权限：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/cron.hourly/logrotate-hourly</span><br></pre></td></tr></table></figure>

<h3 id="找到慢SQL之慢查询日志"><a href="#找到慢SQL之慢查询日志" class="headerlink" title="找到慢SQL之慢查询日志"></a>找到慢SQL之慢查询日志</h3><p>临时开启慢查询 <code>SET GLOBAL slow_query_log=on;</code> 。慢查询日志分析工具 <code>mysqldumpslow</code> （只能在 MySQL 服务器本地运行）用于从 <strong>慢查询日志文件（slow query log）中提取和汇总慢 SQL 语句</strong>。<code>mysqldumpslow</code> 官网手册：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/mysqldumpslow.html">https://dev.mysql.com/doc/refman/8.4/en/mysqldumpslow.html</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 平均查询时间最多的前10条SQL，且不进行参数抽象化（保留具体数值）。&gt;&gt;&gt;&gt;&gt;&gt; t表示查询时间，at表示平均查询时间。</span></span><br><span class="line">mysqldumpslow -s at -t 10 -a /data/local/mysql/3306/data/localhost-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 平均锁等待时间最多的前10条SQL。&gt;&gt;&gt;&gt;&gt;&gt; l表示锁等待时间，al表示平均锁等待时间。</span></span><br><span class="line">mysqldumpslow -s al -t 10 -a /data/local/mysql/3306/data/localhost-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 平均返回行数最多的 SQL。&gt;&gt;&gt;&gt;&gt;&gt; r表示返回行数，ar表示平均返回行数。</span></span><br><span class="line">mysqldumpslow -s ar -t 10 -a /data/local/mysql/3306/data/localhost-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 执行次数最多的前10条SQL。</span></span><br><span class="line">mysqldumpslow -s c -t 10 -a /data/local/mysql/3306/data/localhost-slow.log</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 平均查询时间最多、含有<span class="string">&quot;left join&quot;</span> 的前10条SQL，且不进行参数抽象化（保留具体数值）。</span></span><br><span class="line">mysqldumpslow -s at -g &quot;left join&quot; -t 10 -a /data/local/mysql/3306/data/localhost-slow.log</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">结合 | 和 more 使用，防止爆屏情况出现</span></span><br><span class="line">mysqldumpslow -s at -g &quot;left join&quot; -t 10 -a /data/local/mysql/3306/data/localhost-slow.log | more</span><br></pre></td></tr></table></figure>

<p>输出说明（样例）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Count: 18  Time=23.07s (415s)  Lock=0.00s (0s)  Rows=3596.0 (64728)</span><br><span class="line">SELECT * FROM users WHERE age = N AND status = N;</span><br></pre></td></tr></table></figure>

<p>含义：</p>
<ul>
<li><code>Count: 18</code>：执行了 18 次</li>
<li><code>Time=23.07s (415s)</code>：平均每次执行耗时 23.07 秒（18 次总共耗时 415 秒）。<br><font color="red">注意：Query_time 包含的过程：解析 SQL（parse） + 优化查询（优化器阶段） + 查询执行（包括读取磁盘&#x2F;内存） + 等待锁（InnoDB 可能等待行锁） + 返回结果给客户端（包括网络传输时间）。</font> </li>
<li><code>Lock=0.00s (0s)</code>：平均锁等待时间为 0 秒，说明没有锁竞争（总锁等待时间 0 秒）</li>
<li><code>Rows=3596.0 (64728)</code>：平均每次返回 3596 行（总共返回 64728 行）</li>
</ul>
<p><font color="red">线上建议关闭慢查询日志。</font> 为了避免日志过大，请实现 “慢查询日志文件轮转”。手动清理步骤：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1. 查看当前慢查询日志相关的选项配置，包括 开启状态、慢查询日志文件名称</span></span><br><span class="line">mysql -u root -p123456789 -S /tmp/mysql_3306.sock -e &quot;SHOW GLOBAL VARIABLES LIKE &#x27;%slow_query_log%&#x27;;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 临时关闭慢查询日志</span></span><br><span class="line">mysql -u root -p123456789 -S /tmp/mysql_3306.sock -e &quot;SET GLOBAL slow_query_log = &#x27;OFF&#x27;;&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4. 移动旧日志文件为备份</span></span><br><span class="line">mv /data/local/mysql/3306/data/localhost-slow.log /data/local/mysql/3306/data/localhost-slow.log.20250725</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5. 重新开启慢查询日志（会重新创建文件）</span></span><br><span class="line">mysql -u root -p123456789 -S /tmp/mysql_3306.sock -e &quot;SET GLOBAL slow_query_log = &#x27;ON&#x27;;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="找到慢SQL之性能分析"><a href="#找到慢SQL之性能分析" class="headerlink" title="找到慢SQL之性能分析"></a>找到慢SQL之性能分析</h3><p>官网：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/performance-schema-query-profiling.html">https://dev.mysql.com/doc/refman/8.0/en/performance-schema-query-profiling.html</a></p>
<p>以下示例演示了如何使用 performance_schema 的 statement events 和 stage events 来检索与 show profiles 和 show profile 语句提供的性能分析信息相当的数据。</p>
<p>setup_actors 表可用于按主机、用户或账户限制历史事件的收集，从而减少运行时开销并降低历史表中收集的数据量。示例的第一步演示了如何将历史事件的收集范围限制为特定用户。</p>
<p>性能模式以皮秒（1 秒 &#x3D; 1,000,000,000,000 皮秒（ps））为单位显示事件计时器信息，以将计时数据标准化为标准单位。在下面的示例中，TIMER_WAIT 值除以 1000000000000，以秒为单位显示数据。值还被截断为小数点后 6 位，以与 SHOW PROFILES 和 SHOW PROFILE 语句显示的数据格式一致。</p>
<p>1、将历史事件的收集范围限制为执行查询的用户。</p>
<p><font color="red">默认情况下</font>，setup_actors 配置允许对所有前台线程（由客户端连接触发的线程）进行监控和历史事件收集：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.setup_actors;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> HOST <span class="operator">|</span> <span class="keyword">USER</span> <span class="operator">|</span> ROLE <span class="operator">|</span> ENABLED <span class="operator">|</span> HISTORY <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="operator">%</span>    <span class="operator">|</span> <span class="operator">%</span>    <span class="operator">|</span> <span class="operator">%</span>    <span class="operator">|</span> YES     <span class="operator">|</span> YES     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+------+------+---------+---------+</span></span><br></pre></td></tr></table></figure>

<p>将 <code>setup_actors</code> 表中的默认行，更新为<strong>禁用</strong>所有前台线程的历史事件收集和监控，并插入一行以启用对运行该查询的用户的监控和历史事件收集：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_actors <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;NO&#x27;</span>, HISTORY <span class="operator">=</span> <span class="string">&#x27;NO&#x27;</span> <span class="keyword">WHERE</span> HOST <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">AND</span> <span class="keyword">USER</span> <span class="operator">=</span> <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line"><span class="keyword">INSERT INTO</span> performance_schema.setup_actors (HOST,<span class="keyword">USER</span>,ROLE,ENABLED,HISTORY) <span class="keyword">VALUES</span>(<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;%&#x27;</span>,<span class="string">&#x27;YES&#x27;</span>,<span class="string">&#x27;YES&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>此时 setup_actors 表数据如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> performance_schema.setup_actors;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----------+------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> HOST      <span class="operator">|</span> <span class="keyword">USER</span>      <span class="operator">|</span> ROLE <span class="operator">|</span> ENABLED <span class="operator">|</span> HISTORY <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----------+------+---------+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="operator">%</span>         <span class="operator">|</span> <span class="operator">%</span>         <span class="operator">|</span> <span class="operator">%</span>    <span class="operator">|</span> <span class="keyword">NO</span>      <span class="operator">|</span> <span class="keyword">NO</span>      <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="operator">%</span>         <span class="operator">|</span> root      <span class="operator">|</span> <span class="operator">%</span>    <span class="operator">|</span> YES     <span class="operator">|</span> YES     <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-----------+------+---------+---------+</span></span><br></pre></td></tr></table></figure>

<p>2、确保通过更新 <code>setup_instruments</code> 表来启用 statement 和 stage 监控。某些监控项可能已默认启用。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/performance-schema-setup-instruments-table.html">setup_instruments</a> 表列出了 可收集事件的仪器化对象的类别（要监控的事件，又叫监控点）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NAME    字段：事件名称（监控点）</span><br><span class="line">ENABLED 字段：是否启用这个监控点？默认部分开启</span><br><span class="line">TIMED   字段：是否记录时间？（比如开始/结束时间、耗时）</span><br></pre></td></tr></table></figure>

<p>每类监控点的作用详解</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>statement/sql/%</code></td>
<td>SQL语句级别监控（最重要）</td>
</tr>
<tr>
<td><code>stage/sql/%</code></td>
<td>阶段级别（用于分析SQL慢在哪一步：<strong>解析？优化？执行？</strong>）</td>
</tr>
<tr>
<td><code>wait/io/file/sql/%</code></td>
<td>文件IO，排查 SQL 慢是否因为磁盘</td>
</tr>
<tr>
<td><code>wait/synch/%/innodb/%</code></td>
<td>分析 InnoDB 内部是否锁冲突或资源等待（排查表级锁、行锁、buffer pool等）</td>
</tr>
<tr>
<td><code>wait/io/socket/sql/%</code></td>
<td>是否存在网络传输瓶颈，检查 SQL 是否卡在网络层（客户端慢、返回慢）</td>
</tr>
</tbody></table>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%statement/%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%stage/%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_instruments <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span>, TIMED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%wait/%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>3、确保已启用 <code>events_statements_*</code> 和 <code>events_stages_*</code> 消费者。部分消费者可能已默认启用。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/performance-schema-setup-consumers-table.html">setup_consumers</a> 表列出了可以存储事件信息且已启用的消费者类型（定义<strong>监控数据写到哪里</strong>，也就是说，数据收集后写入哪些表）。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_statements_%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_stages_%&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> performance_schema.setup_consumers <span class="keyword">SET</span> ENABLED <span class="operator">=</span> <span class="string">&#x27;YES&#x27;</span> <span class="keyword">WHERE</span> NAME <span class="keyword">LIKE</span> <span class="string">&#x27;%events_wait_%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>4、在您正在监控的用户账户下，运行您想要分析的语句。例如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, account, name <span class="keyword">FROM</span> basedb.t_base_user <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;曹操&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>5、通过查询 <code>events_statements_history_long</code> 表来确定语句的 EVENT_ID。此步骤与运行 SHOW PROFILES 命令以确定 Query_ID 的操作类似。以下查询生成的输出与 SHOW PROFILES 命令的结果相似：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/performance-schema-events-statements-history-long-table.html">events_statements_history_long</a> 表包含全局范围内所有线程中最近结束的 N 个语句事件。语句事件在结束之前不会被添加到该表中。当表已满时，添加新行时会丢弃最旧的一行，无论该行是由哪个线程生成的。</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/performance-schema-events-statements-history-table.html">events_statements_history</a> 表包含每个线程最近结束的 N 个语句事件。语句事件在结束前不会被添加到该表中。当表中某线程的行数达到最大值时，添加该线程的新行时会丢弃最旧的行。当线程结束时，其所有行都会被丢弃。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;perf%&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    THREAD_ID,</span><br><span class="line">    EVENT_ID,</span><br><span class="line">    EVENT_NAME, <span class="comment">-- 对应 setup_instruments 表的 NAME 字段</span></span><br><span class="line">    <span class="keyword">TRUNCATE</span>(TIMER_WAIT<span class="operator">/</span><span class="number">1000000000000</span>,<span class="number">6</span>) <span class="keyword">as</span> Duration, <span class="comment">-- 皮秒 转为 秒</span></span><br><span class="line">    SQL_TEXT</span><br><span class="line">  <span class="keyword">FROM</span> performance_schema.events_statements_history_long</span><br><span class="line"> <span class="keyword">WHERE</span> SQL_TEXT <span class="keyword">like</span> <span class="string">&#x27;%曹操%&#x27;</span> <span class="comment">-- 慢查询的SQL文本</span></span><br><span class="line">   <span class="keyword">and</span> SQL_TEXT <span class="keyword">not</span> <span class="keyword">like</span> <span class="string">&#x27;%performance_schema%&#x27;</span>; <span class="comment">-- 此条件是为了排除当前SQL语句</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> EVENT_ID <span class="operator">|</span> Duration <span class="operator">|</span> SQL_TEXT                                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------------------------------------------------+</span></span><br><span class="line"><span class="operator">|</span>       <span class="number">18</span> <span class="operator">|</span> <span class="number">0.028310</span> <span class="operator">|</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> basedb.t_base_user <span class="keyword">WHERE</span> name <span class="operator">=</span> <span class="string">&#x27;曹操&#x27;</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+----------+--------------------------------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>6、查询 events_stages_history_long 表以获取语句的 stage 事件。stage 通过事件嵌套与语句相关联。每个 stage 事件记录都包含一个 NESTING_EVENT_ID 列，该列存储父语句的 EVENT_ID。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    event_name <span class="keyword">AS</span> Stage,</span><br><span class="line">    <span class="keyword">TRUNCATE</span>(TIMER_WAIT<span class="operator">/</span><span class="number">1000000000000</span>,<span class="number">6</span>) <span class="keyword">AS</span> Duration <span class="comment">-- 皮秒 转为 秒</span></span><br><span class="line">  <span class="keyword">FROM</span> performance_schema.events_stages_history_long</span><br><span class="line"> <span class="keyword">WHERE</span> NESTING_EVENT_ID<span class="operator">=</span><span class="number">18</span> <span class="keyword">and</span> THREAD_ID <span class="operator">=</span> <span class="number">76</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> Stage                                  <span class="operator">|</span> Duration <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------+----------+</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>starting                     <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>checking permissions         <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>Opening tables               <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>init                         <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span><span class="keyword">System</span> lock                  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>optimizing                   <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>statistics                   <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>preparing                    <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>executing                    <span class="operator">|</span> <span class="number">0.0003</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span><span class="keyword">end</span>                          <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>query <span class="keyword">end</span>                    <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>closing tables               <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>freeing items                <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>logging slow query           <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>cleaning up                  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>starting                     <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>query <span class="keyword">end</span>                    <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>closing tables               <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>freeing items                <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>cleaning up                  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">0.0496</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">0.0525</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">0.1795</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">0.0486</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">0.052</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">0.0457</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>converting HEAP <span class="keyword">to</span> ondisk    <span class="operator">|</span> <span class="number">1.5681</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span><span class="keyword">end</span>                          <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>query <span class="keyword">end</span>                    <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>waiting <span class="keyword">for</span> handler <span class="keyword">commit</span>   <span class="operator">|</span> <span class="number">0.015</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>closing tables               <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>freeing items                <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>logging slow query           <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> stage<span class="operator">/</span><span class="keyword">sql</span><span class="operator">/</span>cleaning up                  <span class="operator">|</span> <span class="number">0</span>        <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------------------+----------+</span></span><br></pre></td></tr></table></figure>

<p>7、综合</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 一次性展示一条语句的所有阶段和等待事件</span></span><br><span class="line"><span class="keyword">select</span> </span><br><span class="line">  s.thread_id,</span><br><span class="line">  s.event_id <span class="keyword">as</span> statement_event_id,</span><br><span class="line">  s.event_name <span class="keyword">as</span> statement_event_name,</span><br><span class="line">  s.timer_wait <span class="keyword">as</span> statement_timer_wait,</span><br><span class="line">  <span class="comment">-- s.sql_text,</span></span><br><span class="line">  </span><br><span class="line">  st.thread_id,</span><br><span class="line">  st.event_id <span class="keyword">as</span> stage_event_id,</span><br><span class="line">  st.event_name <span class="keyword">as</span> stage_event_name,</span><br><span class="line">  st.timer_wait <span class="keyword">as</span> stage_timer_wait,</span><br><span class="line">  </span><br><span class="line">  w.thread_id,</span><br><span class="line">  w.event_id <span class="keyword">as</span> event_wait_id,</span><br><span class="line">  w.event_name <span class="keyword">as</span> event_wait_name,</span><br><span class="line">  w.timer_wait <span class="keyword">as</span> event_timer_wait,</span><br><span class="line">  w.object_type,</span><br><span class="line">  w.object_name</span><br><span class="line"><span class="keyword">from</span> performance_schema.events_statements_history_long s</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> performance_schema.events_stages_history_long st</span><br><span class="line">  <span class="keyword">on</span> s.thread_id <span class="operator">=</span> st.thread_id <span class="keyword">and</span> st.nesting_event_id <span class="operator">=</span> s.event_id</span><br><span class="line"><span class="keyword">left</span> <span class="keyword">join</span> performance_schema.events_waits_history_long w</span><br><span class="line">  <span class="keyword">on</span> st.thread_id <span class="operator">=</span> w.thread_id <span class="keyword">and</span> w.nesting_event_id <span class="operator">=</span> st.event_id</span><br><span class="line"><span class="keyword">where</span> s.event_id <span class="operator">=</span> <span class="number">85</span> <span class="keyword">and</span> s.thread_id <span class="operator">=</span> <span class="number">112</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> s.timer_start ,st.timer_start, w.timer_start;</span><br></pre></td></tr></table></figure>

<h3 id="SQL的执行时间-等待时间"><a href="#SQL的执行时间-等待时间" class="headerlink" title="SQL的执行时间&amp;等待时间"></a>SQL的执行时间&amp;等待时间</h3><p>SQL执行时间长：根据执行计划优化索引、减少表关联、优化表结构。</p>
<p>SQL等待时间长：调整MySQL系统配置，比如调整缓冲池大小。</p>
<h3 id="根据-Status-Var-调优"><a href="#根据-Status-Var-调优" class="headerlink" title="根据 Status Var 调优"></a>根据 Status Var 调优</h3><p>调优的基本逻辑是：✅ <strong>读状态变量 → 发现瓶颈 → 调整系统变量 → 观察变化</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 使用mysql命令连接DB</span></span><br><span class="line">mysql <span class="operator">-</span>h <span class="number">192.168</span><span class="number">.0</span><span class="number">.7</span> <span class="operator">-</span>P <span class="number">3306</span> <span class="operator">-</span>u base <span class="operator">-</span>p <span class="number">123456789</span>;</span><br><span class="line">use ideps;</span><br><span class="line">#或者</span><br><span class="line">mysql <span class="operator">-</span>h192<span class="number">.168</span><span class="number">.0</span><span class="number">.7</span> <span class="operator">-</span>P3306 <span class="operator">-</span>ubase <span class="operator">-</span>p123456789 basedb;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">FULL</span>] processlist; <span class="comment">-- 活动的线程和进程（与正在使用的MySQL账户相关的线程），若不加full则只列出前100条。</span></span><br><span class="line">KILL [CONNECTION <span class="operator">|</span> QUERY] processlist_id; <span class="comment">-- 终止线程，默认选项 CONNECTION</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看GLOBAL系统变量。</span></span><br><span class="line"><span class="keyword">select</span></span><br><span class="line">  variable_name,</span><br><span class="line">  variable_value <span class="operator">/</span> <span class="number">1024</span> <span class="operator">/</span> <span class="number">1024</span> <span class="keyword">as</span> variable_value <span class="comment">-- 单位：MB</span></span><br><span class="line"><span class="keyword">from</span></span><br><span class="line">  performance_schema.global_variables</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  variable_name <span class="keyword">in</span> (</span><br><span class="line">    <span class="string">&#x27;innodb_buffer_pool_size&#x27;</span>, <span class="comment">-- 关注 缓存池命中率</span></span><br><span class="line">    <span class="string">&#x27;max_heap_table_size&#x27;</span>,     <span class="comment">-- 关注 临时表落盘率</span></span><br><span class="line">    <span class="string">&#x27;tmp_table_size&#x27;</span>,          <span class="comment">-- 关注 临时表落盘率</span></span><br><span class="line">    <span class="string">&#x27;join_buffer_size&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;sort_buffer_size&#x27;</span>)        <span class="comment">-- 关注 Sort_merge_passes</span></span><br><span class="line"> <span class="keyword">order</span> <span class="keyword">by</span> variable_name;</span><br><span class="line"> </span><br><span class="line"># 调整系统变量。应该先调整SESSION系统变量（推荐使用 mysql 工具连接），再更新到<span class="keyword">GLOBAL</span>。</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span>   innodb_buffer_pool_size  <span class="operator">=</span> <span class="number">1</span> <span class="operator">*</span> <span class="number">1024</span> <span class="operator">*</span> <span class="number">1024</span> <span class="operator">*</span> <span class="number">1024</span>; <span class="comment">-- 1GB/GLOBAL</span></span><br><span class="line"><span class="comment">-- SET SESSION  join_buffer_size         = 8 * 1024 * 1024; -- 10MB/Both</span></span><br><span class="line"><span class="comment">-- SET SESSION  sort_buffer_size         = 2 * 1024 * 1024; -- 2MB/Both</span></span><br><span class="line"><span class="keyword">SET</span> SESSION  max_heap_table_size      <span class="operator">=</span> <span class="number">512</span> <span class="operator">*</span> <span class="number">1024</span> <span class="operator">*</span> <span class="number">1024</span>; <span class="comment">-- 512MB/Both</span></span><br><span class="line"><span class="keyword">SET</span> SESSION  tmp_table_size           <span class="operator">=</span> <span class="number">512</span> <span class="operator">*</span> <span class="number">1024</span> <span class="operator">*</span> <span class="number">1024</span>; <span class="comment">-- 512MB/Both</span></span><br></pre></td></tr></table></figure>

<h3 id="分页查询性能优化"><a href="#分页查询性能优化" class="headerlink" title="分页查询性能优化"></a>分页查询性能优化</h3><p>offset 越大越慢，即便使用了索引列。例如：<code>SELECT * FROM user_info ORDER BY id LIMIT 10 OFFSET 100000000;</code></p>
<p>如果 id 是主键或有索引，这条语句：</p>
<ul>
<li>✅会使用 id 的索引来排序；</li>
<li>✅从最小的 id 开始，一条一条扫描跳过10000000行；</li>
<li>❌前 100000 条记录仍然要读取索引（甚至回表）再丢弃掉，性能会很差。</li>
</ul>
<p>尽量减少二级索引间接扫描聚簇索引（或回表）并跳过相应行数的过程。推荐写法（基于索引位置）：</p>
<p>把 ‘limit n offset m’ 改写为 ‘WHERE id &gt; y LIMIT x’ 或者 ‘id BETWEEN n AND m’，也就是使用索引分页。</p>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/data-types.html">https://dev.mysql.com/doc/refman/8.4/en/data-types.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/data-type-defaults.html">https://dev.mysql.com/doc/refman/8.4/en/data-type-defaults.html</a>	数据类型默认值</p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/storage-requirements.html">https://dev.mysql.com/doc/refman/8.4/en/storage-requirements.html</a>	数据类型存储要求</p>
<h2 id="PostgreSQL"><a href="#PostgreSQL" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/datatype.html">https://www.postgresql.org/docs/current/datatype.html</a></p>
<h2 id="Oracle"><a href="#Oracle" class="headerlink" title="Oracle"></a>Oracle</h2><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlqr/Data-Types.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlqr/Data-Types.html</a></p>
<h3 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h3><p> <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/PL-SQL#%E6%95%B0%E5%80%BC%E7%B1%BB%E5%9E%8B">PL-SQL#数值类型 - 维基百科</a> </p>
<p><strong>number 类型</strong>： <code>number[([precision], [scale])]</code> </p>
<p>precision 表示十进制有效数字的个数，最多不能超过38个有效数字 number(38,0) （实际支持39-40位十进制数字）。</p>
<p>Scale的范围为[-84，127]。Scale为<strong>正数</strong>时，表示从<font color="blue">小数点</font>到<font color="blue">最不重要的</font>十进制有效数字的个数（<font color="red">小数点后多余舍弃</font>）；为<strong>负数</strong>时，其<strong>绝对值</strong>表示从<font color="blue">最不重要的</font>十进制有效数字到<font color="blue">小数点</font>的位数（<font color="red">小数点前四舍五入变为0</font>）。</p>
<p><strong>如果指定了精度</strong>，没有指定scale，scale默认为0。</p>
<p><strong>如果没有指定精度</strong>，precision与scale默认为最大的取值区间（维基百科是这样说的），实际测试如下（Oracle 11g）：</p>
<table>
<thead>
<tr>
<th align="left">插入数据</th>
<th align="left">查询结果</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0.123456789123456789123456789123456789</td>
<td align="left">0.123456789123457</td>
</tr>
<tr>
<td align="left">1.123456789123456789123456789123456789</td>
<td align="left">1.12345678912346</td>
</tr>
<tr>
<td align="left">12.123456789123456789123456789123456789</td>
<td align="left">12.1234567891235</td>
</tr>
<tr>
<td align="left">123456789123456789.123456789123456789123456789123456789</td>
<td align="left">123456789.123457</td>
</tr>
<tr>
<td align="left">123456789123456789.123456789123456789123456789123456789</td>
<td align="left">123456789123457000</td>
</tr>
</tbody></table>
<p><font color="blue">结论：从左到右，最多保留十进制有效数字15个。其余部分，小数点前四舍五入变为0，小数点后舍弃。</font> </p>
<p><strong>浮点类型</strong>：binary_float、binary_double </p>
<h3 id="日期和时间类型"><a href="#日期和时间类型" class="headerlink" title="日期和时间类型"></a>日期和时间类型</h3><p>秒、毫秒、微秒、纳秒</p>
<p><strong>date 类型</strong>：精度到秒，占用7个字节的存储空间。</p>
<p><strong>timestamp 类型</strong>：最高精度可以到ns(纳秒)，小数位数可以指定为0-9，默认为6位。如果精度为0，则用7字节存储，与date类型功能相同；如果精度大于0，则用11字节存储。</p>
<p><strong>timestamp with time zone 类型</strong>：timestamp 类型的变种，它包含了时区偏移量的值，保持 client 的 timezone。</p>
<p><strong>timestamp with local time zone 类型</strong>：把 client 的 timezone 转换成 DB 的 timezone 对应的时间。</p>
<p><font color="green">带时区的类型需要 Java 也是用带时区的？</font> </p>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><ul>
<li>固定长度类型：char&#x2F;nchar，自动补足空格，最多可以存储2000字节。</li>
<li>可变长度类型：varchar2&#x2F;nvarchar2，<font color="red">最大字节数都是4000</font>，自动删除首尾的空格.</li>
</ul>
<p>格式：char(size [byte| char]) 、varchar2(size [byte| char]) 、nvarchar2(size) </p>
<p>例：</p>
<p>char(8 byte) ：默认是byte</p>
<p>varchar2(4000) &#x2F; varchar2(4000 char) ：可以存入4000个字母，不能存入4000个汉字。如果数据库字符集是GBK，那么varchar2最多存放2000个汉字；如果字符集是UTF-8，那么最多存放1333个汉字了。<font color="blue">存放汉字建议使用nvarchar2</font>。</p>
<p>nvarchar2(2000) ：每个字符长度都是2个字节，所以size最大值为4000&#x2F;2&#x3D;2000，最多存放2000个汉字或字母，<font color="blue">不受数据库字符集的影响</font>。</p>
<h1 id="函数和运算符"><a href="#函数和运算符" class="headerlink" title="函数和运算符"></a>函数和运算符</h1><h2 id="MySQL-1"><a href="#MySQL-1" class="headerlink" title="MySQL"></a>MySQL</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/functions.html">https://dev.mysql.com/doc/refman/8.4/en/functions.html</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">  <span class="keyword">CONVERT</span> ( <span class="string">&#x27;-1&#x27;</span>, signed ), <span class="comment">-- 有符号</span></span><br><span class="line">  <span class="keyword">CONVERT</span> ( <span class="string">&#x27;-1&#x27;</span>, unsigned ), <span class="comment">-- 无符号</span></span><br><span class="line">  </span><br><span class="line">  IF ( dt.operator <span class="keyword">IS</span> <span class="keyword">NULL</span>, <span class="number">0</span>, <span class="number">1</span> ) <span class="keyword">AS</span> isExistData,</span><br><span class="line">  IFNULL ( <span class="built_in">SUM</span>( t.spart_cnt ), <span class="number">0</span> ) <span class="keyword">AS</span> quantity,</span><br><span class="line">  <span class="built_in">COALESCE</span> ( <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;巴顿&#x27;</span> ) <span class="keyword">AS</span> NAME, <span class="comment">-- COALESCE：返回参数中的第一个非null的值，它要求参数中至少有一个是非null的，如果参数都是null会报错。</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">CASE</span> <span class="string">&#x27;1&#x27;</span> </span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;1&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;正常&#x27;</span> </span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;2&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;受控&#x27;</span> </span><br><span class="line">      <span class="keyword">WHEN</span> <span class="string">&#x27;3&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27;禁止&#x27;</span></span><br><span class="line">    <span class="keyword">ELSE</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">AS</span> sale_state,</span><br><span class="line">  <span class="keyword">CASE</span> </span><br><span class="line">    <span class="keyword">WHEN</span> t.name <span class="keyword">is</span> <span class="keyword">null</span> <span class="keyword">THEN</span> <span class="string">&#x27;正常&#x27;</span> </span><br><span class="line">    <span class="keyword">ELSE</span> <span class="string">&#x27;异常&#x27;</span></span><br><span class="line">  <span class="keyword">END</span> <span class="keyword">AS</span> name_state,</span><br><span class="line">  </span><br><span class="line">  concat ( t.region_name_cn, <span class="string">&#x27;-&#x27;</span>, t.country_name_en, <span class="string">&#x27;-&#x27;</span>, t.customer_name_en ) <span class="keyword">AS</span> customer_name_en,</span><br><span class="line">  group_concat ( item.product_cn <span class="keyword">ORDER</span> <span class="keyword">BY</span> product_cn <span class="keyword">DESC</span> SEPARATOR <span class="string">&#x27;$&#x27;</span> ) <span class="keyword">AS</span> product_name </span><br><span class="line">  <span class="keyword">LEFT</span> ( opp.`<span class="keyword">month</span>`, <span class="number">4</span> ) <span class="keyword">AS</span> <span class="string">&#x27;year&#x27;</span>,</span><br><span class="line">  <span class="keyword">TRUNCATE</span>( ROUND ( T.sum_quantity :: <span class="type">NUMERIC</span> <span class="operator">/</span> t2.total_quantity :: <span class="type">NUMERIC</span>, <span class="number">4</span> ) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span> ) quantity_percent,</span><br><span class="line">  <span class="built_in">CAST</span> ( <span class="string">&#x27;2022-01-31 13:28:56&#x27;</span> <span class="keyword">AS</span> <span class="type">TIMESTAMP</span> ),</span><br><span class="line">  DATE_FORMAT ( <span class="string">&#x27;2022-01-06 13:56:35&#x27;</span>, <span class="string">&#x27;%Y-%m-%d %H:%i:%S&#x27;</span> ),</span><br><span class="line">  DATE_FORMAT ( now(), <span class="string">&#x27;%Y-%m-%d %H:%i:%S&#x27;</span> ),</span><br><span class="line">  CHARSET ( <span class="string">&#x27;ABC&#x27;</span> ),</span><br><span class="line">  CHARSET ( <span class="keyword">CONVERT</span>( <span class="string">&#x27;ABC&#x27;</span> <span class="keyword">USING</span> gbk ) )</span><br><span class="line"><span class="keyword">from</span> table_name</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">!</span><span class="comment">-- 历史6个月 --&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">!</span>[CDATA[</span><br><span class="line">      t.`<span class="keyword">month</span>` <span class="operator">&lt;=</span> DATE_FORMAT( CURDATE(), <span class="string">&#x27;%Y%m&#x27;</span> )</span><br><span class="line">  <span class="keyword">AND</span> t.`<span class="keyword">month</span>` <span class="operator">&gt;=</span> DATE_FORMAT(DATE_SUB( NOW(), <span class="type">INTERVAL</span> <span class="number">5</span> <span class="keyword">MONTH</span> ), <span class="string">&#x27;%Y%m&#x27;</span>)</span><br><span class="line">  ]]<span class="operator">&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">!</span><span class="comment">-- 未来6个月 --&gt;</span></span><br><span class="line">  <span class="operator">&lt;</span><span class="operator">!</span>[CDATA[</span><br><span class="line">      t.`<span class="keyword">MONTH</span>` <span class="operator">&gt;=</span> DATE_FORMAT( NOW(), <span class="string">&#x27;%Y%m&#x27;</span> )</span><br><span class="line">  <span class="keyword">AND</span> t.`<span class="keyword">MONTH</span>` <span class="operator">&lt;=</span> DATE_FORMAT( DATE_ADD( NOW(), <span class="type">INTERVAL</span> <span class="number">5</span> <span class="keyword">MONTH</span> ), <span class="string">&#x27;%Y%m&#x27;</span> )</span><br><span class="line">  ]]<span class="operator">&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">AND</span> <span class="type">binary</span> asd.name <span class="keyword">like</span> concat( <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;petty&#x27;</span>,<span class="string">&#x27;%&#x27;</span>) <span class="comment">-- binary区分大小写，mysql默认不区分大小写</span></span><br><span class="line">  </span><br></pre></td></tr></table></figure>

<h2 id="PostgreSQL-1"><a href="#PostgreSQL-1" class="headerlink" title="PostgreSQL"></a>PostgreSQL</h2><p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/functions.html">https://www.postgresql.org/docs/current/functions.html</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	<span class="comment">-- 数学函数</span></span><br><span class="line">    <span class="built_in">ABS</span> ( <span class="operator">-</span> <span class="number">17.4</span> ) <span class="keyword">AS</span> &quot;绝对值&quot;,<span class="comment">-- 17.4</span></span><br><span class="line">    sign( <span class="operator">-</span> <span class="number">8.5</span> ) <span class="keyword">AS</span> &quot;参数的符号(-1,0,+1)&quot;,<span class="comment">-- -1</span></span><br><span class="line">    <span class="built_in">SQRT</span> ( <span class="number">4.0</span> ) <span class="keyword">AS</span> &quot;	平方根&quot;,<span class="comment">-- 2</span></span><br><span class="line">    cbrt( <span class="number">27.0</span> ) <span class="keyword">AS</span> &quot;立方根&quot;,<span class="comment">-- 3</span></span><br><span class="line">    <span class="built_in">CEIL</span> ( <span class="operator">-</span> <span class="number">42.8</span> ) <span class="keyword">AS</span> &quot;向上取整&quot;,<span class="comment">-- -42</span></span><br><span class="line">    <span class="built_in">FLOOR</span> ( <span class="operator">-</span> <span class="number">42.8</span> ) <span class="keyword">AS</span> &quot;向下取整&quot;,<span class="comment">-- -43</span></span><br><span class="line">    <span class="built_in">MOD</span> ( <span class="number">9</span>, <span class="number">4</span> ) <span class="keyword">AS</span> &quot;取余&quot;,<span class="comment">-- 1</span></span><br><span class="line">    trunc( <span class="number">42.438</span> ) <span class="keyword">AS</span> &quot;截断小数位&quot;,<span class="comment">-- 42</span></span><br><span class="line">    trunc( <span class="number">42.438</span>, <span class="number">2</span> ) <span class="keyword">AS</span> &quot;截断小数，保留2位小数&quot;,<span class="comment">-- 42.43</span></span><br><span class="line">    round( <span class="number">42.4</span> ) <span class="keyword">AS</span> &quot;四舍五入&quot;,<span class="comment">-- 42</span></span><br><span class="line">    round( <span class="number">42.438</span>, <span class="number">2</span> ) <span class="keyword">AS</span> &quot;四舍五入，保留2位小数&quot;,<span class="comment">-- 42.44</span></span><br><span class="line">    TRUNC( ROUND( <span class="string">&#x27;10&#x27;</span> :: <span class="type">NUMERIC</span> <span class="operator">/</span> <span class="string">&#x27;100&#x27;</span> :: <span class="type">NUMERIC</span>, <span class="number">4</span> ) <span class="operator">*</span> <span class="number">100</span>, <span class="number">2</span> ) <span class="keyword">AS</span> <span class="keyword">percent</span>,<span class="comment">-- 10.00</span></span><br><span class="line">    <span class="built_in">POWER</span> ( <span class="number">2.0</span>, <span class="number">3.0</span> ) <span class="keyword">AS</span> &quot;2的3次幂&quot;,<span class="comment">-- 8.0</span></span><br><span class="line">    <span class="built_in">log</span>( <span class="number">2.0</span>, <span class="number">8.0</span> ) <span class="keyword">AS</span> &quot;以2为底8的对数&quot;,<span class="comment">-- 3.0</span></span><br><span class="line">    <span class="built_in">log</span>( <span class="number">100.0</span> ) <span class="keyword">AS</span> &quot;以10为底100的对数&quot;,<span class="comment">-- 2.0</span></span><br><span class="line">    <span class="built_in">EXP</span> ( <span class="number">1.0</span> ) <span class="keyword">AS</span> &quot;自然指数&quot;,<span class="comment">-- 2.7182818284590452</span></span><br><span class="line">    <span class="built_in">LN</span> ( <span class="number">2.7182818284590452</span> ) <span class="keyword">AS</span> &quot;自然对数&quot;,<span class="comment">-- 1.0</span></span><br><span class="line">    degrees( <span class="number">1</span> ) <span class="keyword">AS</span> &quot;弧度转角度&quot;,<span class="comment">-- 57.29577951308232</span></span><br><span class="line">    radians( <span class="number">57.29577951308232</span> ) <span class="keyword">AS</span> &quot;角度转弧度&quot;,<span class="comment">-- 1</span></span><br><span class="line">    pi( ) <span class="keyword">AS</span> &quot;π常量&quot;,<span class="comment">-- 3.141592653589793</span></span><br><span class="line">    random( ) <span class="keyword">AS</span> &quot;0.0到1.0之间的随机数值&quot;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 三角函数列表</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">-- 其他</span></span><br><span class="line">    asd.proj_cn_name ILIKE concat ( <span class="string">&#x27;%&#x27;</span>, #&#123;requestParam.likeCondition,jdbcType<span class="operator">=</span><span class="type">VARCHAR</span>&#125;, <span class="string">&#x27;%&#x27;</span> ),</span><br><span class="line">    to_number( <span class="keyword">RIGHT</span> ( tt.mon_asd, <span class="number">2</span> ), <span class="string">&#x27;99&#x27;</span> ) <span class="keyword">AS</span> name_cn,</span><br><span class="line">    <span class="built_in">CAST</span> ( offer.pc_id <span class="keyword">AS</span> <span class="type">VARCHAR</span> ( <span class="number">50</span> ) ) <span class="keyword">AS</span> pc_id,</span><br><span class="line">  <span class="keyword">from</span> table_name</span><br><span class="line">  <span class="keyword">where</span></span><br><span class="line">    <span class="operator">&lt;</span><span class="operator">!</span>[CDATA[</span><br><span class="line">        asd.mon_asd <span class="operator">&lt;=</span> to_char( <span class="built_in">CURRENT_TIMESTAMP</span>, <span class="string">&#x27;YYYYMM&#x27;</span> )</span><br><span class="line">    <span class="keyword">AND</span> asd.mon_asd <span class="operator">&gt;=</span> to_char( <span class="built_in">CURRENT_TIMESTAMP</span> <span class="operator">+</span> <span class="string">&#x27;-5 month&#x27;</span>, <span class="string">&#x27;YYYYMM&#x27;</span> )</span><br><span class="line">    ]]<span class="operator">&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">AND</span> asd.name ilike concat( <span class="string">&#x27;%&#x27;</span>, <span class="string">&#x27;petty&#x27;</span>,<span class="string">&#x27;%&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Oracle-1"><a href="#Oracle-1" class="headerlink" title="Oracle"></a>Oracle</h2><p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlqr/SQL-Functions.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/sqlqr/SQL-Functions.html</a></p>
<h1 id="SQL-语句"><a href="#SQL-语句" class="headerlink" title="SQL 语句"></a>SQL 语句</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-statements.html</a></p>
<h2 id="DDL（数据定义语言）"><a href="#DDL（数据定义语言）" class="headerlink" title="DDL（数据定义语言）"></a>DDL（数据定义语言）</h2><p><font color="red"><strong>alter、create、drop、rename、truncate 。</strong></font></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-data-definition-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-data-definition-statements.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/ddl.html">https://www.postgresql.org/docs/current/ddl.html</a></p>
<h2 id="DML（数据操纵语言）"><a href="#DML（数据操纵语言）" class="headerlink" title="DML（数据操纵语言）"></a>DML（数据操纵语言）</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-data-manipulation-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-data-manipulation-statements.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/dml.html">https://www.postgresql.org/docs/current/dml.html</a></p>
<h2 id="事务和锁定语句"><a href="#事务和锁定语句" class="headerlink" title="事务和锁定语句"></a>事务和锁定语句</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-transactional-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-transactional-statements.html</a></p>
<h2 id="复制语句（控制主从复制）"><a href="#复制语句（控制主从复制）" class="headerlink" title="复制语句（控制主从复制）"></a>复制语句（控制主从复制）</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-replication-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-replication-statements.html</a></p>
<p>可以通过 SQL 接口使用本节中描述的语句来控制复制。语句分为三类：一类用于控制主服务器，一类用于控制从服务器，另一类用于控制组复制。</p>
<h2 id="预编译语句"><a href="#预编译语句" class="headerlink" title="预编译语句"></a>预编译语句</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-prepared-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-prepared-statements.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/prepare.html">15.5.1 PREPARE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/execute.html">15.5.2 EXECUTE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/deallocate-prepare.html">15.5.3 DEALLOCATE PREPARE Statement</a></li>
</ul>
<p>MySQL 8.4 支持服务器端预编译语句。此支持利用了高效的客户端&#x2F;服务器二进制协议。使用带参数占位符的预编译语句具有以下优势：</p>
<ul>
<li><p>每次执行语句时减少解析开销。通常，数据库应用程序处理大量几乎相同的语句，仅在 WHERE 子句（用于查询和删除）、SET 子句（用于更新）以及 VALUES 子句（用于插入）等条款中对字面量或变量值进行修改。</p>
</li>
<li><p>防范 SQL 注入攻击。参数值可以包含未转义的 SQL 引号和分隔符字符。</p>
</li>
</ul>
<h2 id="复合语句语法"><a href="#复合语句语法" class="headerlink" title="复合语句语法"></a>复合语句语法</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-compound-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-compound-statements.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/begin-end.html">15.6.1 BEGIN…END 复合语句</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/statement-labels.html">15.6.2 语句标签</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/declare.html">15.6.3 DECLARE 语句</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/stored-program-variables.html">15.6.4 存储程序中的变量</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/flow-control-statements.html">15.6.5 流控制语句</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/cursors.html">15.6.6 游标</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/condition-handling.html">15.6.7 条件处理</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/condition-handling-restrictions.html">15.6.8 条件处理的限制</a></li>
</ul>
<p>本节描述了复合语句 BEGIN … END 的语法以及可在存储程序主体中使用的其他语句：存储过程和函数、触发器以及事件。这些对象通过存储在服务器上的 SQL 代码进行定义，以便后续调用（参见第 27 章，存储对象）。</p>
<p>复合语句是一个块，可以包含其他块；变量、条件处理程序和游标的声明；以及循环和条件测试等流程控制结构。</p>
<h2 id="数据库管理语句"><a href="#数据库管理语句" class="headerlink" title="数据库管理语句"></a>数据库管理语句</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sql-server-administration-statements.html">https://dev.mysql.com/doc/refman/8.4/en/sql-server-administration-statements.html</a></p>
<h3 id="账户管理语句"><a href="#账户管理语句" class="headerlink" title="账户管理语句"></a>账户管理语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/account-management-statements.html">https://dev.mysql.com/doc/refman/8.4/en/account-management-statements.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/alter-user.html">15.7.1.1 ALTER USER Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/create-role.html">15.7.1.2 CREATE ROLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/create-user.html">15.7.1.3 CREATE USER Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/drop-role.html">15.7.1.4 DROP ROLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/drop-user.html">15.7.1.5 DROP USER Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/grant.html">15.7.1.6 GRANT Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/rename-user.html">15.7.1.7 RENAME USER Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/revoke.html">15.7.1.8 REVOKE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-default-role.html">15.7.1.9 SET DEFAULT ROLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-password.html">15.7.1.10 SET PASSWORD Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-role.html">15.7.1.11 SET ROLE Statement</a></li>
</ul>
<h3 id="资源组管理语句"><a href="#资源组管理语句" class="headerlink" title="资源组管理语句"></a>资源组管理语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/resource-group-statements.html">https://dev.mysql.com/doc/refman/8.4/en/resource-group-statements.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/alter-resource-group.html">15.7.2.1 ALTER RESOURCE GROUP Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/create-resource-group.html">15.7.2.2 CREATE RESOURCE GROUP Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/drop-resource-group.html">15.7.2.3 DROP RESOURCE GROUP Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-resource-group.html">15.7.2.4 SET RESOURCE GROUP Statement</a></li>
</ul>
<h3 id="表维护语句"><a href="#表维护语句" class="headerlink" title="表维护语句"></a>表维护语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/table-maintenance-statements.html">https://dev.mysql.com/doc/refman/8.4/en/table-maintenance-statements.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/analyze-table.html">15.7.3.1 ANALYZE TABLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/check-table.html">15.7.3.2 CHECK TABLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/checksum-table.html">15.7.3.3 CHECKSUM TABLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimize-table.html">15.7.3.4 OPTIMIZE TABLE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/repair-table.html">15.7.3.5 REPAIR TABLE Statement</a></li>
</ul>
<h3 id="组件、插件和可加载函数语句"><a href="#组件、插件和可加载函数语句" class="headerlink" title="组件、插件和可加载函数语句"></a>组件、插件和可加载函数语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/component-statements.html">https://dev.mysql.com/doc/refman/8.4/en/component-statements.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/create-function-loadable.html">15.7.4.1 CREATE FUNCTION Statement for Loadable Functions</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/drop-function-loadable.html">15.7.4.2 DROP FUNCTION Statement for Loadable Functions</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/install-component.html">15.7.4.3 INSTALL COMPONENT Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/install-plugin.html">15.7.4.4 INSTALL PLUGIN Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/uninstall-component.html">15.7.4.5 UNINSTALL COMPONENT Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/uninstall-plugin.html">15.7.4.6 UNINSTALL PLUGIN Statement</a></li>
</ul>
<h3 id="CLONE-语句"><a href="#CLONE-语句" class="headerlink" title="CLONE 语句"></a>CLONE 语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/clone.html">https://dev.mysql.com/doc/refman/8.4/en/clone.html</a></p>
<h3 id="SET-语句"><a href="#SET-语句" class="headerlink" title="SET 语句"></a>SET 语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-statement.html">https://dev.mysql.com/doc/refman/8.4/en/set-statement.html</a></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-variable.html">15.7.6.1 变量赋值的 SET 语法</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-character-set.html">15.7.6.2 SET CHARACTER SET 语句</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/set-names.html">15.7.6.3 SET NAMES 语句</a></li>
</ul>
<h3 id="SHOW-语句"><a href="#SHOW-语句" class="headerlink" title="SHOW 语句"></a>SHOW 语句</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/show.html">https://dev.mysql.com/doc/refman/8.4/en/show.html</a></p>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/extended-show.html">https://dev.mysql.com/doc/refman/8.4/en/extended-show.html</a></p>
<h3 id="其他行政语句"><a href="#其他行政语句" class="headerlink" title="其他行政语句"></a>其他行政语句</h3><ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/binlog.html">15.7.8.1 BINLOG Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/cache-index.html">15.7.8.2 CACHE INDEX Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/flush.html">15.7.8.3 FLUSH Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/kill.html">15.7.8.4 KILL Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/load-index.html">15.7.8.5 LOAD INDEX INTO CACHE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/reset.html">15.7.8.6 RESET Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/reset-persist.html">15.7.8.7 RESET PERSIST Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/restart.html">15.7.8.8 RESTART Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/shutdown.html">15.7.8.9 SHUTDOWN Statement</a></li>
</ul>
<h2 id="实用语句"><a href="#实用语句" class="headerlink" title="实用语句"></a>实用语句</h2><ul>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/describe.html">15.8.1 DESCRIBE Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/explain.html">15.8.2 EXPLAIN Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/help.html">15.8.3 HELP Statement</a></li>
<li><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/use.html">15.8.4 USE Statement</a></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/getting-information.html">https://dev.mysql.com/doc/refman/8.4/en/getting-information.html</a>	获取数据库和表的相关信息</p>
<h1 id="字符集、排序规则、Unicode"><a href="#字符集、排序规则、Unicode" class="headerlink" title="字符集、排序规则、Unicode"></a>字符集、排序规则、Unicode</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/charset.html">https://dev.mysql.com/doc/refman/8.4/en/charset.html</a></p>
<h2 id="字符集和排序规则概述"><a href="#字符集和排序规则概述" class="headerlink" title="字符集和排序规则概述"></a>字符集和排序规则概述</h2><p>字符集是一组符号和编码。排序规则是一组用于比较字符集中的字符的规则。让我们通过一个虚构的字符集示例来明确这一区别。</p>
<p>假设我们有一个包含四个字母的字母表：A、B、a、b。我们为每个字母分配一个数字：A &#x3D; 0，B &#x3D; 1，a &#x3D; 2，b &#x3D; 3。字母A是一个符号，数字0是A的编码，而这四个字母及其编码的组合构成一个字符集。</p>
<p>假设我们想比较两个字符串值A和B。最简单的方法是查看它们的编码：A对应0，B对应1。由于0小于1，我们说A小于B。我们刚才所做的就是对字符集应用了排序规则。排序规则是一组规则（本例中仅有一条规则）：“比较编码”。”我们称这种最简单的排序规则为二进制排序规则。</p>
<p>但如果我们希望小写字母和大写字母视为等价呢？那么我们至少需要两条规则：(1) 将小写字母 a 和 b 视为与大写字母 A 和 B 等价；(2) 然后比较编码。我们称这种排序规则为不区分大小写的排序规则。它比二进制排序规则稍复杂一些。</p>
<p>在现实生活中，大多数字符集包含大量字符：不仅包括A和B，还包括整个字母表，有时甚至包含多个字母表或拥有数千个字符的东方书写系统，以及大量特殊符号和标点符号。同样在现实生活中，大多数排序规则包含大量规则，不仅涉及是否区分大小写，还涉及是否区分音标（音标是指附加在字符上的标记，例如德语中的Ö），以及多字符映射规则（例如德语两种排序规则中的一种规定Ö等于OE）。  </p>
<p>MySQL可以为您处理这些问题：  </p>
<ul>
<li><p>使用多种字符集存储字符串。</p>
</li>
<li><p>使用多种排序规则比较字符串。</p>
</li>
<li><p>在同一服务器、同一数据库甚至同一表中混合使用不同字符集或排序规则的字符串。</p>
</li>
<li><p>在任何级别启用字符集和排序规则的指定。</p>
</li>
</ul>
<p>要有效使用这些功能，您必须了解可用字符集和排序规则的类型、如何更改默认设置，以及它们如何影响字符串运算符和函数的行为。</p>
<h2 id="MySQL-中的字符集和排序规则"><a href="#MySQL-中的字符集和排序规则" class="headerlink" title="MySQL 中的字符集和排序规则"></a>MySQL 中的字符集和排序规则</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/charset-mysql.html">https://dev.mysql.com/doc/refman/8.4/en/charset-mysql.html</a></p>
<p>MySQL 服务器支持多种字符集，查看可用的字符集，可以使用 <code>INFORMATION_SCHEMA.CHARACTER_SETS</code> 表或 <code>SHOW CHARACTER SET</code> 语句。</p>
<p>默认情况下，<code>SHOW CHARACTER SET</code> 语句会显示所有可用的字符集。该语句可选地包含 LIKE 或 WHERE 子句，用于指定要匹配的字符集名称。以下示例展示了部分基于 Unicode 转换格式的 Unicode 字符集：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">CHARACTER SET</span> <span class="keyword">LIKE</span> <span class="string">&#x27;utf%&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------------+--------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> Charset <span class="operator">|</span> Description      <span class="operator">|</span> <span class="keyword">Default</span> <span class="keyword">collation</span>  <span class="operator">|</span> Maxlen <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------------+--------------------+--------+</span></span><br><span class="line"><span class="operator">|</span> utf16   <span class="operator">|</span> UTF<span class="number">-16</span> Unicode   <span class="operator">|</span> utf16_general_ci   <span class="operator">|</span>      <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf16le <span class="operator">|</span> UTF<span class="number">-16</span>LE Unicode <span class="operator">|</span> utf16le_general_ci <span class="operator">|</span>      <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf32   <span class="operator">|</span> UTF<span class="number">-32</span> Unicode   <span class="operator">|</span> utf32_general_ci   <span class="operator">|</span>      <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf8mb3 <span class="operator">|</span> UTF<span class="number">-8</span> Unicode    <span class="operator">|</span> utf8mb3_general_ci <span class="operator">|</span>      <span class="number">3</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf8mb4 <span class="operator">|</span> UTF<span class="number">-8</span> Unicode    <span class="operator">|</span> utf8mb4_0900_ai_ci <span class="operator">|</span>      <span class="number">4</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------+------------------+--------------------+--------+</span></span><br></pre></td></tr></table></figure>

<p>给定的字符集始终至少包含一个排序规则，而大多数字符集包含多个排序规则。要列出字符集的显示排序规则，可以使用 <code>INFORMATION_SCHEMA.COLLATIONS</code> 表或 <code>SHOW COLLATION</code> 语句。</p>
<p>默认情况下，<code>SHOW COLLATION</code> 语句会显示所有可用的排序规则。它支持可选的 LIKE 或 WHERE 子句，用于指定要显示的排序规则名称。例如，要查看默认字符集 utf8mb4 的排序规则，请使用以下语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SHOW</span> <span class="keyword">COLLATION</span> <span class="keyword">WHERE</span> Charset <span class="operator">=</span> <span class="string">&#x27;utf8mb4&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+---------+-----+---------+----------+---------+---------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="keyword">Collation</span>                  <span class="operator">|</span> Charset <span class="operator">|</span> Id  <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Compiled <span class="operator">|</span> Sortlen <span class="operator">|</span> Pad_attribute <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+---------+-----+---------+----------+---------+---------------+</span></span><br><span class="line"><span class="operator">|</span> utf8mb4_0900_ai_ci         <span class="operator">|</span> utf8mb4 <span class="operator">|</span> <span class="number">255</span> <span class="operator">|</span> Yes     <span class="operator">|</span> Yes      <span class="operator">|</span>       <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NO</span> PAD        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf8mb4_0900_as_ci         <span class="operator">|</span> utf8mb4 <span class="operator">|</span> <span class="number">305</span> <span class="operator">|</span>         <span class="operator">|</span> Yes      <span class="operator">|</span>       <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NO</span> PAD        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf8mb4_0900_as_cs         <span class="operator">|</span> utf8mb4 <span class="operator">|</span> <span class="number">278</span> <span class="operator">|</span>         <span class="operator">|</span> Yes      <span class="operator">|</span>       <span class="number">0</span> <span class="operator">|</span> <span class="keyword">NO</span> PAD        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> utf8mb4_0900_bin           <span class="operator">|</span> utf8mb4 <span class="operator">|</span> <span class="number">309</span> <span class="operator">|</span>         <span class="operator">|</span> Yes      <span class="operator">|</span>       <span class="number">1</span> <span class="operator">|</span> <span class="keyword">NO</span> PAD        <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ...                        <span class="operator">|</span>         <span class="operator">|</span>     <span class="operator">|</span>         <span class="operator">|</span>          <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ...                        <span class="operator">|</span>         <span class="operator">|</span>     <span class="operator">|</span>         <span class="operator">|</span>          <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> ...                        <span class="operator">|</span>         <span class="operator">|</span>     <span class="operator">|</span>         <span class="operator">|</span>          <span class="operator">|</span>         <span class="operator">|</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------------------------+---------+-----+---------+----------+---------+---------------+</span></span><br></pre></td></tr></table></figure>

<h2 id="指定字符集和排序规则"><a href="#指定字符集和排序规则" class="headerlink" title="指定字符集和排序规则"></a>指定字符集和排序规则</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/charset-syntax.html">https://dev.mysql.com/doc/refman/8.4/en/charset-syntax.html</a></p>
<p>字符集和排序规则的默认设置分为四个层次：服务器、数据库、表和列。以下各节的描述可能显得复杂，但在实际应用中发现，多层次默认设置会产生自然且直观的结果。</p>
<p>CHARACTER SET 用于指定字符集的子句中。CHARSET 可作为 CHARACTER SET 的同义词使用。</p>
<p>字符集问题不仅影响数据存储，还影响客户端程序与 MySQL 服务器之间的通信。如果您希望客户端程序使用与默认不同的字符集与服务器通信，则需要指定具体字符集。例如，要使用 latin1 Unicode 字符集，请在连接到服务器后执行以下语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> NAMES <span class="string">&#x27;latin1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="排序规则命名约定"><a href="#排序规则命名约定" class="headerlink" title="排序规则命名约定"></a>排序规则命名约定</h3><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/charset-collation-names.html">https://dev.mysql.com/doc/refman/8.4/en/charset-collation-names.html</a>	</p>
<p>排序后缀含义</p>
<table>
<thead>
<tr>
<th>后缀</th>
<th>全称</th>
<th>含义说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>_ai</strong></td>
<td>Accent-insensitive</td>
<td><strong>不区分重音符号（accent）</strong>。如 <code>café = cafe</code>。</td>
</tr>
<tr>
<td><strong>_as</strong></td>
<td>Accent-sensitive</td>
<td><strong>区分重音符号</strong>。如 <code>café ≠ cafe</code>。</td>
</tr>
<tr>
<td><strong>_ci</strong></td>
<td>Case-insensitive</td>
<td><strong>不区分大小写</strong>。如 <code>ABC = abc</code>。</td>
</tr>
<tr>
<td><strong>_cs</strong></td>
<td>Case-sensitive</td>
<td><strong>区分大小写</strong>。如 <code>ABC ≠ abc</code>。</td>
</tr>
<tr>
<td><strong>_ks</strong></td>
<td>Kana-sensitive</td>
<td><strong>区分日文片假名与平假名</strong>。如 <code>カ ≠ か</code>。</td>
</tr>
<tr>
<td><strong>_bin</strong></td>
<td>Binary</td>
<td>使用<strong>原始二进制编码</strong>进行比较，完全区分大小写、重音、编码等，是最精确但最严格的比较方式。</td>
</tr>
</tbody></table>
<p><font color="red">binary 会强制将字符串按字节级（binary）比较，从而实现大小写敏感的匹配，但会使索引失效：<code>select binary &#39;a&#39; = &#39;A&#39;</code>。</font></p>
<h2 id="连接字符集和排序规则"><a href="#连接字符集和排序规则" class="headerlink" title="连接字符集和排序规则"></a>连接字符集和排序规则</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/charset-connection.html">https://dev.mysql.com/doc/refman/8.4/en/charset-connection.html</a></p>
<p>“连接”是指客户端程序在连接到服务器时建立的连接，用于开始一个会话，在此会话中客户端与服务器进行交互。客户端通过会话连接发送SQL语句，例如查询语句。服务器通过连接将响应（如结果集或错误消息）发送回客户端。</p>
<p>当客户端连接到服务器时，它会指定希望用于与服务器通信的字符集。（实际上，客户端指定的是该字符集的默认排序规则，服务器可据此推断出字符集。） 服务器使用此信息将字符集系统变量（character_set_client、character_set_results、character_set_connection）设置为该字符集，并将排序规则系统变量（collation_connection）设置为该字符集的默认排序规则。实际上，服务器执行了相当于 <code>SET NAMES</code> 操作的操作。</p>
<p>用于连接字符集配置的SQL语句</p>
<p>连接建立后，客户端可以修改当前会话的字符集和排序规则系统变量。这些变量可以使用 SET 语句单独修改，用于连接字符集配置的SQL语句有两个，都可以批量修改与连接相关的字符集系统变量：</p>
<p>1、<code>SET NAMES &#39;charset_name&#39; [COLLATE &#39;collation_name&#39;]</code>，此语句等同于以下三个语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> character_set_client <span class="operator">=</span> charset_name;</span><br><span class="line"><span class="keyword">SET</span> character_set_results <span class="operator">=</span> charset_name;</span><br><span class="line"><span class="keyword">SET</span> character_set_connection <span class="operator">=</span> charset_name;</span><br></pre></td></tr></table></figure>

<p>2、<code>SET CHARACTER SET &#39;charset_name&#39;</code>，此语句等同于以下三个语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> character_set_client <span class="operator">=</span> charset_name;</span><br><span class="line"><span class="keyword">SET</span> character_set_results <span class="operator">=</span> charset_name;</span><br><span class="line"><span class="keyword">SET</span> collation_connection <span class="operator">=</span> @<span class="variable">@collation_database</span>;</span><br></pre></td></tr></table></figure>

<h2 id="Unicode-支持"><a href="#Unicode-支持" class="headerlink" title="Unicode 支持"></a>Unicode 支持</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/charset-unicode.html">https://dev.mysql.com/doc/refman/8.4/en/charset-unicode.html</a></p>
<p>utf8mb4：一种使用每个字符占用1至4个字节的UTF-8编码方案，用于表示Unicode字符集。</p>
<h1 id="InnoDB存储引擎"><a href="#InnoDB存储引擎" class="headerlink" title="InnoDB存储引擎"></a>InnoDB存储引擎</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html">https://dev.mysql.com/doc/refman/8.4/en/innodb-storage-engine.html</a></p>
<h2 id="MVCC（多版本并发控制）"><a href="#MVCC（多版本并发控制）" class="headerlink" title="MVCC（多版本并发控制）"></a>MVCC（多版本并发控制）</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/innodb-multi-versioning.html">https://dev.mysql.com/doc/refman/8.4/en/innodb-multi-versioning.html</a>	InnoDB 多版本控制</p>
<p><a target="_blank" rel="noopener" href="https://www.postgresql.org/docs/current/mvcc.html">https://www.postgresql.org/docs/current/mvcc.html</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/data-concurrency-and-consistency.html">https://docs.oracle.com/en/database/oracle/oracle-database/23/cncpt/data-concurrency-and-consistency.html</a></p>
<h2 id="InnoDB-架构"><a href="#InnoDB-架构" class="headerlink" title="InnoDB 架构"></a>InnoDB 架构</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/innodb-architecture.html">https://dev.mysql.com/doc/refman/8.4/en/innodb-architecture.html</a></p>
<p>InnoDB 架构图，展示内存中和磁盘上的结构。</p>
<p>内存中结构包括：</p>
<ul>
<li>缓冲池</li>
<li>更改缓冲区</li>
<li>自适应哈希索引</li>
<li>日志缓冲区</li>
</ul>
<p>磁盘上结构包括：</p>
<ul>
<li><p>表空间（系统表空间又称共享表空间、每个表一个文件表空间又称独立表空间、通用表空间、撤销表空间、临时表空间）。</p>
<blockquote>
<p>一张 InnoDB 表数据量很小，但表空间占用却很大的原因：</p>
<ul>
<li>数据曾经很多，后来删除了，但空间未回收。InnoDB 不会自动将 <code>.ibd</code> 文件缩小；删除数据只是<strong>标记为可复用空间</strong>，文件实际大小不变；所以：<strong>表小了，文件还很大</strong>。</li>
<li>频繁插入&#x2F;删除&#x2F;更新导致页碎片严重，空间利用率低。</li>
<li>存在大字段（如 TEXT&#x2F;BLOB）页外存储。大字段虽然记录数少，但每个字段会单独占页（或页链），导致表空间变大；</li>
</ul>
<p><font color="red">表空间优化 <code>OPTIMIZE TABLE your_table;</code> 。其他注意事项见：<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/optimize-table.html">https://dev.mysql.com/doc/refman/8.4/en/optimize-table.html</a></font></p>
</blockquote>
</li>
<li><p>双写缓冲区文件</p>
</li>
<li><p>重做日志(Redo)</p>
</li>
<li><p>撤销日志(Undo)</p>
</li>
</ul>
<p><img src="/article/2022/01/MySQL_00%E7%B2%BE%E5%8D%8E/innodb-architecture-8-0.png"></p>
<h2 id="InnoDB-内存结构"><a href="#InnoDB-内存结构" class="headerlink" title="InnoDB 内存结构"></a>InnoDB 内存结构</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/innodb-in-memory-structures.html">https://dev.mysql.com/doc/refman/8.4/en/innodb-in-memory-structures.html</a></p>
<h2 id="InnoDB-磁盘结构"><a href="#InnoDB-磁盘结构" class="headerlink" title="InnoDB 磁盘结构"></a>InnoDB 磁盘结构</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/innodb-on-disk-structures.html">https://dev.mysql.com/doc/refman/8.4/en/innodb-on-disk-structures.html</a></p>
<h2 id="InnoDB-限制"><a href="#InnoDB-限制" class="headerlink" title="InnoDB 限制"></a>InnoDB 限制</h2><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/innodb-limits.html">https://dev.mysql.com/doc/refman/8.0/en/innodb-limits.html</a></p>
<p>本节描述了InnoDB表、索引、表空间以及InnoDB存储引擎其他方面的限制。</p>
<ul>
<li><p>一个表最多可以包含 1017 个列。虚拟生成的列也包含在此限制内。</p>
</li>
<li><p>一个表最多可以包含 64 个二级索引。</p>
</li>
<li><p>对于使用 DYNAMIC 或 COMPRESSED 行格式的 InnoDB 表，<strong>索引键前缀</strong>长度限制为 3072 字节。<font color="red"><strong>3072 &#x2F; 4 &#x3D; 768 字符，所以联合索引的多个字段长度加起来不能超过 768。</strong></font></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `t` (</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  KEY `idx_name` (`name`(<span class="number">768</span>)) <span class="comment">-- 前缀索引，只索引前 768 个字符</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_0900_ai_ci;</span><br></pre></td></tr></table></figure>

<p>对于使用REDUNDANT或COMPACT行格式的InnoDB表，索引键前缀长度限制为 767 字节。例如，如果在UTF-8字符集下，对 TEXT 或 VARCHAR 列使用超过191个字符的列前缀索引，且每个字符最多占用4字节，则可能触发此限制。</p>
<p>尝试使用超过限制的索引键前缀长度将引发错误。</p>
<p><font color="blue">如果您在创建 MySQL 实例时通过指定 innodb_page_size 选项将 InnoDB 页面大小设置为 8KB 或 4KB，则索引键的最大长度将成比例降低，基于 16KB 页面大小时 3072 字节的限制。即，当页面大小为8KB时，索引键的最大长度为1536字节；当页面大小为4KB时，最大长度为768字节。</font></p>
<p>适用于索引键前缀的限制同样适用于<font color="red"><strong>全列索引键（索引整个字段的值，不限制前缀）</strong></font>。</p>
</li>
<li><p>多列索引的列数最多允许16列。超过限制将返回错误。</p>
</li>
<li><p><font color="blue">不包括任何存储在页面外的可变长度列，最大行大小略小于页面大小的一半，适用于4KB、8KB、16KB和32KB的页面大小。</font>例如，默认innodb_page_size为16KB时，最大行大小约为8000字节。然而，对于InnoDB页面大小为64KB的情况，最大行大小约为16000字节。LONGBLOB和LONGTEXT列的大小必须小于4GB，且包括BLOB和TEXT列在内的总行大小也必须小于4GB。</p>
<p>如果一行长度小于半页，则整个行都存储在页面内。如果超过半页，则选择可变长度列进行外部页面外存储，直到行长度小于半页，如第 17.11.2 节“文件空间管理”中所述。</p>
</li>
<li><p>尽管InnoDB内部支持大于65,535字节的行大小，但MySQL本身对所有列的总大小设定了65,535字节的行大小限制。请参阅第10.4.7节“<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/column-count-limit.html">表列数和行大小的限制</a>”。</p>
</li>
<li><p>最大表或表空间大小受服务器文件系统影响，该文件系统可能设置的最大文件大小小于InnoDB定义的内部64 TiB大小限制。例如，Linux上的ext4文件系统最大文件大小为16 TiB，因此最大表或表空间大小变为16 TiB而非64 TiB。另一个例子是FAT32文件系统，其最大文件大小为4 GB。</p>
<p>如果您需要更大的系统表空间，请使用多个较小的数据文件而非一个大型数据文件进行配置，或将表数据分布到按表分配的文件和通用表空间数据文件中。</p>
</li>
<li><p><font color="blue">InnoDB 日志文件的总最大大小为 512GB。</font></p>
</li>
<li><p>表空间的最小大小略大于10MB。表空间的最大大小（即 表的最大大小）取决于InnoDB的页面大小。</p>
<table>
<thead>
<tr>
<th align="left">InnoDB Page Size</th>
<th align="left">Maximum Tablespace Size</th>
</tr>
</thead>
<tbody><tr>
<td align="left">4KB</td>
<td align="left">16TB</td>
</tr>
<tr>
<td align="left">8KB</td>
<td align="left">32TB</td>
</tr>
<tr>
<td align="left">16KB</td>
<td align="left">64TB</td>
</tr>
<tr>
<td align="left">32KB</td>
<td align="left">128TB</td>
</tr>
<tr>
<td align="left">64KB</td>
<td align="left">256TB</td>
</tr>
</tbody></table>
</li>
<li><p>一个InnoDB实例最多支持2^32（4294967296）个表空间，其中一小部分表空间被保留用于回滚和临时表。</p>
<p><font color="blue">启用 <code>innodb_file_per_table=ON</code> 时，每张 <strong>InnoDB 表</strong> 会单独拥有一个表空间（对应 <code>.ibd</code> 文件），所以此时：<strong>表空间 ≈ 表的个数</strong> 。</font></p>
</li>
<li><p>共享表空间支持最多 2^32（4294967296）个表。</p>
</li>
<li><p>表空间文件的路径（包括文件名）在 Windows 系统中不能超过 MAX_PATH 限制。在 Windows 10 之前，MAX_PATH 限制为 260 个字符。自 Windows 10 版本 1607 起，MAX_PATH 限制已从常见的 Win32 文件和目录函数中移除，但您需要启用此新行为。</p>
</li>
</ul>
<h1 id="替代存储引擎"><a href="#替代存储引擎" class="headerlink" title="替代存储引擎"></a>替代存储引擎</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/storage-engines.html">https://dev.mysql.com/doc/refman/8.4/en/storage-engines.html</a></p>
<h1 id="information-schema"><a href="#information-schema" class="headerlink" title="information_schema"></a>information_schema</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/information-schema.html">https://dev.mysql.com/doc/refman/8.4/en/information-schema.html</a></p>
<p>INFORMATION_SCHEMA 提供对数据库元数据的访问，包括 MySQL 服务器相关信息，例如数据库或表的名称、列的数据类型或访问权限。此类信息有时也被称为数据字典或系统目录。</p>
<h1 id="performance-schema"><a href="#performance-schema" class="headerlink" title="performance_schema"></a>performance_schema</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/performance-schema.html">https://dev.mysql.com/doc/refman/8.4/en/performance-schema.html</a></p>
<h1 id="sys-Schema"><a href="#sys-Schema" class="headerlink" title="sys Schema"></a>sys Schema</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/sys-schema.html">https://dev.mysql.com/doc/refman/8.4/en/sys-schema.html</a></p>
<h1 id="mysql-System-Schema（系统数据库）"><a href="#mysql-System-Schema（系统数据库）" class="headerlink" title="mysql System Schema（系统数据库）"></a>mysql System Schema（系统数据库）</h1><p><a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.4/en/system-schema.html">https://dev.mysql.com/doc/refman/8.4/en/system-schema.html</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="zhaolq 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="zhaolq 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          <div class="post-tags">
              <a href="/tags/MySQL/" rel="tag"># MySQL</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/article/2021/08/%E6%97%A0%E7%BA%BF%E9%80%9A%E8%AE%AF%E7%9F%A5%E8%AF%86/" rel="prev" title="无线通讯知识">
                  <i class="fa fa-angle-left"></i> 无线通讯知识
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/article/2022/01/MySQL_01%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/" rel="next" title="MySQL_01安装与使用">
                  MySQL_01安装与使用 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">zhaolq</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
