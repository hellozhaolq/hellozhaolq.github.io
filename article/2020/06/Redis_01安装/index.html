<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"blog.zhaolq.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"androidstudio","dark":"androidstudio"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="百科：   Redis - 维基百科  推荐：   Redis 教程 - 菜鸟  请习惯查看官网">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis_01安装">
<meta property="og:url" content="https://blog.zhaolq.com/article/2020/06/Redis_01%E5%AE%89%E8%A3%85/index.html">
<meta property="og:site_name" content="洋蔥">
<meta property="og:description" content="百科：   Redis - 维基百科  推荐：   Redis 教程 - 菜鸟  请习惯查看官网">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-01T02:30:51.000Z">
<meta property="article:modified_time" content="2020-06-01T02:30:51.000Z">
<meta property="article:author" content="zhaolq">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://blog.zhaolq.com/article/2020/06/Redis_01%E5%AE%89%E8%A3%85/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://blog.zhaolq.com/article/2020/06/Redis_01%E5%AE%89%E8%A3%85/","path":"article/2020/06/Redis_01安装/","title":"Redis_01安装"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Redis_01安装 | 洋蔥</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">洋蔥</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">耳不闻人是非，目不视人之短，口不言人之过。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">1.</span> <span class="nav-text">常用命令</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="nav-number">2.</span> <span class="nav-text">可视化工具</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RedisInsight"><span class="nav-number">2.1.</span> <span class="nav-text">RedisInsight</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AnotherRedisDesktopManager"><span class="nav-number">2.2.</span> <span class="nav-text">AnotherRedisDesktopManager</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%98%E6%96%B9"><span class="nav-number">3.</span> <span class="nav-text">官方</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Docs"><span class="nav-number">3.1.</span> <span class="nav-text">Docs</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Linux%E4%B8%8B%E8%BD%BD%E4%B8%8E%E5%AE%89%E8%A3%85"><span class="nav-number">4.</span> <span class="nav-text">Linux下载与安装</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83"><span class="nav-number">4.1.</span> <span class="nav-text">环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A3%80%E6%9F%A5"><span class="nav-number">4.2.</span> <span class="nav-text">检查</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%89%80%E9%9C%80%E4%BE%9D%E8%B5%96%E9%A1%B9"><span class="nav-number">4.3.</span> <span class="nav-text">安装所需依赖项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BD%E5%B9%B6%E8%A7%A3%E5%8E%8B-Redis-%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">4.4.</span> <span class="nav-text">下载并解压 Redis 源代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA"><span class="nav-number">4.5.</span> <span class="nav-text">构建</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85"><span class="nav-number">4.6.</span> <span class="nav-text">安装</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8-ACL"><span class="nav-number">4.7.</span> <span class="nav-text">访问控制列表(ACL)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8D%95%E6%9C%BA%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.8.</span> <span class="nav-text">单机模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88master%E8%8A%82%E7%82%B9%EF%BC%89"><span class="nav-number">4.8.1.</span> <span class="nav-text">配置文件（master节点）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%E5%90%AF%E5%8A%A8"><span class="nav-number">4.8.2.</span> <span class="nav-text">单例启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E4%B8%8E%E8%AE%A4%E8%AF%81"><span class="nav-number">4.8.3.</span> <span class="nav-text">客户端连接与认证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF"><span class="nav-number">4.8.4.</span> <span class="nav-text">开机自启</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E4%BB%8E%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.9.</span> <span class="nav-text">主从模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%EF%BC%88slave%E8%8A%82%E7%82%B9%EF%BC%89"><span class="nav-number">4.9.1.</span> <span class="nav-text">配置文件（slave节点）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.10.</span> <span class="nav-text">哨兵模式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">4.10.1.</span> <span class="nav-text">配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%93%A8%E5%85%B5%E5%90%AF%E5%8A%A8"><span class="nav-number">4.10.2.</span> <span class="nav-text">哨兵启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B3%A8%E6%84%8F"><span class="nav-number">4.10.3.</span> <span class="nav-text">注意</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF-1"><span class="nav-number">4.10.4.</span> <span class="nav-text">开机自启</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F"><span class="nav-number">4.11.</span> <span class="nav-text">集群模式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis%E4%BA%94%E7%A7%8D%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">5.</span> <span class="nav-text">Redis五种数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#String%EF%BC%88%E5%AD%97%E7%AC%A6%E4%B8%B2%EF%BC%89"><span class="nav-number">5.1.</span> <span class="nav-text">String（字符串）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List%EF%BC%88%E5%88%97%E8%A1%A8%EF%BC%89"><span class="nav-number">5.2.</span> <span class="nav-text">List（列表）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set%EF%BC%88%E9%9B%86%E5%90%88%EF%BC%89"><span class="nav-number">5.3.</span> <span class="nav-text">Set（集合）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash%EF%BC%88%E5%93%88%E5%B8%8C%EF%BC%89"><span class="nav-number">5.4.</span> <span class="nav-text">Hash（哈希）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#zset-sorted-set%EF%BC%9A%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88"><span class="nav-number">5.5.</span> <span class="nav-text">zset(sorted set：有序集合)</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="zhaolq"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">zhaolq</p>
  <div class="site-description" itemprop="description">有用、有趣、有情义！</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">555</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/hellozhaolq" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hellozhaolq" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:hello.zhaolq@qq.com" title="E-Mail → mailto:hello.zhaolq@qq.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.zhaolq.com/article/2020/06/Redis_01%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="zhaolq">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="洋蔥">
      <meta itemprop="description" content="有用、有趣、有情义！">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Redis_01安装 | 洋蔥">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis_01安装
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-06-01 10:30:51" itemprop="dateCreated datePublished" datetime="2020-06-01T10:30:51+08:00">2020-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><font color="blue"><strong>百科：</strong></font> </p>
<p> <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Redis">Redis - 维基百科</a> </p>
<p><font color="blue"><strong>推荐：</strong></font> </p>
<p> <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/redis-tutorial.html">Redis 教程 - 菜鸟</a> </p>
<p><strong>请习惯查看官网</strong></p>
<span id="more"></span>

<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">连接并执行命令</span></span><br><span class="line">redis-cli -u redis://worker:123456789@localhost:6379/0 acl list</span><br><span class="line"></span><br><span class="line">acl list                           # 查看 ACL 列表。返回 Redis 服务器中所有已配置的用户账户及其权限规则的完整列表。</span><br><span class="line">client list                        # 查看客户端连接。返回当前连接到 Redis 服务器的所有客户端连接的详细信息，用于实时监控和排查问题。</span><br><span class="line"></span><br><span class="line">config get dbfilename              # 获取配置项</span><br><span class="line">config get maxmemory*              # 通配符获取配置项。</span><br><span class="line"></span><br><span class="line">info replication                   # 查看复制状态。返回关于当前 Redis 实例的主从角色、连接状态、同步偏移量等复制相关信息。</span><br><span class="line">info memory                        # 查看内存状态。</span><br><span class="line">info persistence                   # 查看持久化状态。</span><br><span class="line">info server                        # 查看服务器信息，包括版本、操作系统、架构、监听端口以及启动时间等。</span><br><span class="line"></span><br><span class="line">select 0                           # 切换数据库。将当前客户端操作的逻辑数据库切换到编号为 0 的数据库（默认有 16 个数据库，编号 0 到 15）。</span><br><span class="line">dbsize                             # 获取键数量。返回当前选定数据库中 Key 的总数量（不包括过期 Key）。</span><br><span class="line">flushdb                            # 清空当前数据库。危险操作！清除当前 (SELECT 选中) 数据库中的所有 Key。</span><br><span class="line">flushall                           # 清空所有数据库。极度危险操作！清除 Redis 实例中所有数据库的所有 Key。</span><br></pre></td></tr></table></figure>

<h1 id="可视化工具"><a href="#可视化工具" class="headerlink" title="可视化工具"></a>可视化工具</h1><h2 id="RedisInsight"><a href="#RedisInsight" class="headerlink" title="RedisInsight"></a>RedisInsight</h2><p><a target="_blank" rel="noopener" href="https://github.com/redis/RedisInsight">https://github.com/redis/RedisInsight</a> ，README 中有下载链接。</p>
<p>RedisInsight 是 Redis 官网可视化工具，前身为 Redis Desktop Manager。</p>
<h2 id="AnotherRedisDesktopManager"><a href="#AnotherRedisDesktopManager" class="headerlink" title="AnotherRedisDesktopManager"></a>AnotherRedisDesktopManager</h2><p><a target="_blank" rel="noopener" href="https://github.com/qishibo/AnotherRedisDesktopManager">https://github.com/qishibo/AnotherRedisDesktopManager</a> </p>
<h1 id="官方"><a href="#官方" class="headerlink" title="官方"></a>官方</h1><p> <a target="_blank" rel="noopener" href="https://redis.io/">https://redis.io/</a> </p>
<p> <a target="_blank" rel="noopener" href="https://github.com/redis/redis">https://github.com/redis/redis</a> </p>
<h2 id="Docs"><a href="#Docs" class="headerlink" title="Docs"></a>Docs</h2><p><a target="_blank" rel="noopener" href="https://redis.io/docs/latest/">https://redis.io/docs/latest/</a></p>
<p><font color="red">包括：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/get-started/">Get started</a>、<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/develop/tools/insight/#database-analysis">使用 Redis Insight 优化 Redis</a>、<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/develop/clients/">Redis 客户端 API 库</a>。</font> </p>
<p><font color="red">包括：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/operate/">Redis products</a>、<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/commands/">Commands</a>、<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/apis/">APIs</a>。</font> </p>
<h1 id="Linux下载与安装"><a href="#Linux下载与安装" class="headerlink" title="Linux下载与安装"></a>Linux下载与安装</h1><p>从源代码构建的官方文档：<a target="_blank" rel="noopener" href="https://redis.io/docs/latest/operate/oss_and_stack/install/build-stack/">https://redis.io/docs/latest/operate/oss_and_stack/install/build-stack/</a></p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>系统：Ubuntu 24.04</p>
<p>Redis版本：</p>
<h2 id="检查"><a href="#检查" class="headerlink" title="检查"></a>检查</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">find / | grep redis.conf</span><br><span class="line">find / | grep .*redis.*</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ubuntu</span></span><br><span class="line">ufw status</span><br><span class="line">ufw disable</span><br></pre></td></tr></table></figure>

<h2 id="安装所需依赖项"><a href="#安装所需依赖项" class="headerlink" title="安装所需依赖项"></a>安装所需依赖项</h2><p>见官方文档。</p>
<h2 id="下载并解压-Redis-源代码"><a href="#下载并解压-Redis-源代码" class="headerlink" title="下载并解压 Redis 源代码"></a>下载并解压 Redis 源代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/redis/redis/releases">https://github.com/redis/redis/releases</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/local/redis/log</span><br><span class="line">mkdir -p /data/local/redis/pid</span><br><span class="line">mkdir -p /data/local/redis/cluster</span><br><span class="line">cd /data/local</span><br><span class="line">tar -zxvf redis-8.4.0.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="构建"><a href="#构建" class="headerlink" title="构建"></a>构建</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cd /data/local/redis-8.4.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置相应的环境变量以启用 TLS、模块和其他构建选项，然后编译</span></span><br><span class="line">export BUILD_TLS=yes</span><br><span class="line">export BUILD_WITH_MODULES=yes</span><br><span class="line">export INSTALL_RUST_TOOLCHAIN=yes</span><br><span class="line">export DISABLE_WERRORS=yes</span><br><span class="line">make distclean</span><br><span class="line">make # 或 make -j &quot;$(nproc)&quot; all</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">验证是否已成功构建</span></span><br><span class="line">./src/redis-server --version</span><br><span class="line">./src/redis-cli --version</span><br></pre></td></tr></table></figure>

<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /data/local/redis-8.4.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装到指定目录</span></span><br><span class="line">make PREFIX=/data/local/redis install</span><br><span class="line">make uninstall</span><br></pre></td></tr></table></figure>

<p>参考 <strong><a target="_blank" rel="noopener" href="https://hellozhaolq.github.io/article/2019/07/ChildShell%E3%80%81SubShell%E3%80%81%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E6%8C%81%E4%B9%85%E5%8C%96">环境变量持久化</a></strong> 配置环境变量：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">grep -qxF &#x27;export PATH=/data/local/redis/bin:$PATH&#x27; /etc/profile || \</span><br><span class="line">echo &#x27;export PATH=/data/local/redis/bin:$PATH&#x27; &gt;&gt; /etc/profile</span><br><span class="line"></span><br><span class="line">source /etc/profile</span><br><span class="line">which redis-server</span><br></pre></td></tr></table></figure>

<h2 id="访问控制列表-ACL"><a href="#访问控制列表-ACL" class="headerlink" title="访问控制列表(ACL)"></a>访问控制列表(ACL)</h2><p><a target="_blank" rel="noopener" href="https://redis.io/docs/latest/operate/oss_and_stack/management/security/acl/">https://redis.io/docs/latest/operate/oss_and_stack/management/security/acl/</a></p>
<p>Redis ACL（Access Control List，访问控制列表）是一种安全机制，允许管理员对连接进行精细化限制，定义用户可以执行的命令和可以访问的键（Keys）。</p>
<ul>
<li><p><strong>ACL 文件</strong>：ACL 用户和权限的配置主要通过外部的 <strong>ACL 文件</strong>（如 <code>users.acl</code>）进行管理。</p>
</li>
<li><p><strong>ACL 用户</strong>：每个 ACL 条目都定义一个独立的用户账户及其操作权限。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /data/local/redis</span><br><span class="line"><span class="comment"># 创建 worker 用户</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;user worker on ~* &amp;* +@all &gt;123456789&quot;</span> &gt; /data/local/redis/users.acl</span><br><span class="line"><span class="comment"># 追加 default 用户。从 Redis 6.0 开始，requirepass 指令仅用于为 default 用户设置密码。使用 ACL 时该指令无效，会导致 default 用户无密码。</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;user default on ~* &amp;* +@all &gt;123456789&quot;</span> &gt;&gt; /data/local/redis/users.acl</span><br></pre></td></tr></table></figure>

<p>用户权限规则主要由三个关键部分构成：</p>
<ol>
<li><strong>权限开关 (Enablement)</strong><ul>
<li><strong>示例:</strong> <code>user &lt;username&gt; on/off</code></li>
<li><strong>作用:</strong> 明确该用户是否处于启用 (<code>on</code>) 或禁用 (<code>off</code>) 状态。</li>
</ul>
</li>
<li><strong>数据访问限制 (Key&#x2F;Channel Access)</strong><ul>
<li><strong>键模式 (<code>~</code>):</strong> 定义该用户可以访问和操作哪些键。<ul>
<li>例如：<code>~logs:*</code> 只允许访问以 <code>logs:</code> 开头的键。</li>
<li><code>~*</code> 允许访问所有键。</li>
</ul>
</li>
<li><strong>Pub&#x2F;Sub 频道 (<code>&amp;</code>):</strong> 定义该用户可以订阅和发布到哪些 Pub&#x2F;Sub 频道。<ul>
<li>例如：<code>&amp;updates</code> 只允许访问名为 <code>updates</code> 的频道。</li>
<li><code>&amp;*</code> 允许访问所有频道。</li>
</ul>
</li>
</ul>
</li>
<li><strong>命令执行限制 (Command Permissions)</strong><ul>
<li><strong>命令集 (<code>+@</code> &#x2F; <code>-@</code> &#x2F; <code>+</code> &#x2F; <code>-</code>):</strong> 明确该用户可以执行或禁止执行哪些命令或命令组。<ul>
<li><strong><code>+@all</code></strong>: 允许执行所有命令（最高权限）。</li>
<li><strong><code>+@read</code></strong>: 允许执行所有只读命令（如 <code>GET</code>, <code>HGETALL</code>）。</li>
<li><strong><code>-FLUSHDB</code></strong>: 显式禁止执行 <code>FLUSHDB</code> 命令。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2 id="单机模式"><a href="#单机模式" class="headerlink" title="单机模式"></a>单机模式</h2><h3 id="配置文件（master节点）"><a href="#配置文件（master节点）" class="headerlink" title="配置文件（master节点）"></a>配置文件（master节点）</h3><p><a target="_blank" rel="noopener" href="https://github.com/redis/redis/blob/unstable/redis.conf">https://github.com/redis/redis/blob/unstable/redis.conf</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从解压目录复制一份配置文件，用于自定义配置文件的 include 指令</span></span><br><span class="line">cp /data/local/redis-8.4.0/redis.conf /data/local/redis/redis.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">新建配置文件（master节点）</span></span><br><span class="line">vim /data/local/redis/redis_6379.conf</span><br></pre></td></tr></table></figure>

<p>自定义配置文件内容如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################## INCLUDES ###################################</span></span><br><span class="line"><span class="attr">include</span> <span class="string">/data/local/redis/redis.conf</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################## NETWORK #####################################</span></span><br><span class="line"><span class="attr">bind</span> <span class="string">* -::*</span></span><br><span class="line"><span class="comment"># 默认情况下启用保护模式。仅当您确定希望其他主机的客户端连接到 Redis（即使未配置身份验证）时，才应禁用它。即开启远程访问</span></span><br><span class="line"><span class="attr">protected-mode</span> <span class="string">no</span></span><br><span class="line"><span class="attr">port</span> <span class="string">6379</span></span><br><span class="line"><span class="comment"># 设置tcp的backlog，backlog其实是一个连接队列，backlog队列总和=未完成三次握手队列 + 已经完成三次握手队列。 在高并发环境下你需要一个高backlog值来避免慢客户端连接问题。</span></span><br><span class="line"><span class="comment"># 请注意，Linux内核默认会将这个值减小到/proc/sys/net/core/somaxconn的值（128），因此请确保同时提高</span></span><br><span class="line"><span class="comment"># /proc/sys/net/core/somaxconn 和 /proc/sys/net/ipv4/tcp_max_syn_backlog（128）两个值，以获得所需的效果</span></span><br><span class="line"><span class="attr">tcp-backlog</span> <span class="string">511</span></span><br><span class="line"><span class="comment"># 客户端空闲N秒后关闭连接（0表示禁用，即永不关闭）。</span></span><br><span class="line"><span class="attr">timeout</span> <span class="string">0</span></span><br><span class="line"><span class="comment"># 对访问客户端的一种心跳检测，每个n秒检测一次。单位为秒，如果设置为0，则不会进行Keepalive检测，建议设置成60</span></span><br><span class="line"><span class="attr">tcp-keepalive</span> <span class="string">300</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################# GENERAL #####################################</span></span><br><span class="line"><span class="comment"># 服务后台启动</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 进程号保存文件</span></span><br><span class="line"><span class="attr">pidfile</span> <span class="string">/data/local/redis/pid/redis_6379.pid</span></span><br><span class="line"><span class="comment"># 日志级别</span></span><br><span class="line"><span class="attr">loglevel</span> <span class="string">notice</span></span><br><span class="line"><span class="comment"># 指定日志文件名</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;/data/local/redis/log/redis_6379.log&quot;</span></span><br><span class="line"><span class="comment"># 设置数据库数量</span></span><br><span class="line"><span class="attr">databases</span> <span class="string">16</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################## SECURITY ###################################</span></span><br><span class="line"><span class="comment">#user worker on ~* &amp;* +@all &gt;123456789</span></span><br><span class="line"><span class="attr">aclfile</span> <span class="string">/data/local/redis/users.acl</span></span><br><span class="line"><span class="comment"># 从 Redis 6.0 开始，requirepass 指令仅用于为 default 用户设置密码。使用 ACL 时该指令无效，导致 default 用户无密码。</span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">123456789</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################### CLIENTS ####################################</span></span><br><span class="line"><span class="comment"># 设置同时连接的最大客户端数。</span></span><br><span class="line"><span class="attr">maxclients</span> <span class="string">10000</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">############################## MEMORY MANAGEMENT ################################</span></span><br><span class="line"><span class="comment"># 最大内存，104857600 Bytes = 100 MB</span></span><br><span class="line"><span class="attr">maxmemory</span> <span class="string">104857600</span></span><br><span class="line"><span class="comment"># 最大内存策略：当达到最大内存时，Redis 将如何选择删除哪些内容。noeviction -&gt; 不要驱逐任何东西，只是在写操作上返回错误。</span></span><br><span class="line"><span class="attr">maxmemory-policy</span> <span class="string">noeviction</span></span><br><span class="line"><span class="attr">maxmemory-samples</span> <span class="string">5</span></span><br><span class="line"><span class="comment"># 默认情况下，slave节点忽略其maxmemory设置（除非在故障转移后或手动将其提升为主节点），这意味着keys的驱逐将由master节点处理，当keys在master中驱逐时，将DEL命令发送到slave。</span></span><br><span class="line"><span class="attr">replica-ignore-maxmemory</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 删除过期Key（Expire）因子，用于设置每次删除过期Key的延时，取值为[1-10]，默认为1。数值越大删除过期Key越快，同时消耗的CPU资源也更多。这是内存、CPU 和延迟之间的权衡。</span></span><br><span class="line"><span class="attr">active-expire-effort</span> <span class="string">1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################ SNAPSHOTTING ################################</span></span><br><span class="line"><span class="comment"># RDB（Redis DataBase）默认开启</span></span><br><span class="line"><span class="comment">#** Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到 一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，</span></span><br><span class="line"><span class="comment">#** 主进程是不进行任何IO操作的，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。</span></span><br><span class="line"><span class="comment">#** RDB的缺点是最后一次持久化后的数据可能丢失。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 将数据库保存到磁盘。 save &lt;seconds&gt; &lt;changes&gt; [&lt;seconds&gt; &lt;changes&gt; ...]</span></span><br><span class="line"><span class="comment"># 如果经过给定的秒数并且超过了对数据库的给定写入操作数，Redis将会保存数据库。可以使用单个空字符串参数完全禁用快照，如 save &quot;&quot;</span></span><br><span class="line"><span class="comment"># 除非另有说明，默认情况下Redis将会保存DB：经过3600秒且至少有1次更改，经过300秒且至少有100次更改，经过60秒且至少有10000次更改.</span></span><br><span class="line"><span class="comment"># 可以使用单个空字符串参数完全禁用快照，示例：save &quot;&quot;</span></span><br><span class="line"><span class="attr">save</span> <span class="string">3600 1 300 100 60 10000</span></span><br><span class="line"><span class="comment"># 默认情况下，如果启用了 RDB 快照（至少一个保存点）并且最新的后台save失败，Redis 将停止接受写入操作。这将使用户（以一种硬性的方式）意识到数据没有正确地保存在磁盘上，</span></span><br><span class="line"><span class="comment"># 否则很可能没有人会注意到并且会发生一些灾难。</span></span><br><span class="line"><span class="comment"># 如果后台save过程再次开始工作，Redis将自动允许再次写入。</span></span><br><span class="line"><span class="comment"># 但是，如果您已经设置了对 Redis 服务器和持久性的正确监控，则可能需要禁用此功能，以便即使磁盘、权限等出现问题，Redis 也能继续照常工作。</span></span><br><span class="line"><span class="attr">stop-writes-on-bgsave-error</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 转储.rdb数据库时使用LZF算法压缩字符串对象？默认启用压缩，因为它几乎总是胜利。如果想在saving子进程中节省一些CPU，请将其设置为&#x27;no&#x27;，但如果有可压缩的值或键，数据集可能会更大。</span></span><br><span class="line"><span class="attr">rdbcompression</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 检查rdb文件完整性</span></span><br><span class="line"><span class="attr">rdbchecksum</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 转储数据库的文件名。</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump_6379.rdb</span></span><br><span class="line"><span class="comment"># 工作目录。DB 将写入此目录内，并使用上面使用“dbfilename”配置指令指定的文件名。AOF也将在此目录中创建。请注意，您必须在此处指定目录，而不是文件名。</span></span><br><span class="line"><span class="attr">dir</span> <span class="string">/data/local/redis/</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">############################## APPEND ONLY MODE ###############################</span></span><br><span class="line"><span class="comment"># AOF（Append Only File）默认不开启</span></span><br><span class="line"><span class="comment"># AOF和RDB同时开启，系统默认取AOF的数据（数据不会存在丢失）</span></span><br><span class="line"><span class="attr">appendonly</span> <span class="string">yes</span></span><br><span class="line"><span class="attr">appendfilename</span> <span class="string">&quot;appendonly_6379.aof&quot;</span></span><br><span class="line"><span class="attr">appenddirname</span> <span class="string">&quot;appendonlydir_6379&quot;</span></span><br><span class="line"><span class="comment"># 每秒同步，每秒记入日志一次，如果宕机，本秒的数据可能丢失。</span></span><br><span class="line"><span class="attr">appendfsync</span> <span class="string">everysec</span></span><br><span class="line"><span class="attr">no-appendfsync-on-rewrite</span> <span class="string">no</span></span><br><span class="line"><span class="comment"># Redis会记录上次重写时的AOF大小，当AOF日志大小增长指定percentage且文件大于min-size时，Redis 能够隐式调用 BGREWRITEAOF 自动重写日志文件。</span></span><br><span class="line"><span class="attr">auto-aof-rewrite-percentage</span> <span class="string">100</span></span><br><span class="line"><span class="attr">auto-aof-rewrite-min-size</span> <span class="string">64mb</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################# REPLICATION #################################</span></span><br><span class="line"><span class="comment"># 告诉当前的Redis实例，它应该作为一个从节点（Replica），去复制另一个Redis实例（主节点）的数据。不要指定自己，否则log会快速增长</span></span><br><span class="line"><span class="comment">#replicaof &lt;masterip&gt; &lt;masterport&gt;</span></span><br><span class="line"><span class="comment"># 节点间互相访问的密码</span></span><br><span class="line"><span class="attr">masterauth</span> <span class="string">123456789</span></span><br><span class="line"><span class="comment"># 节点间互相访问的用户。从Redis6开始支持，必须指定用户名，否则无法执行PSYNC命令</span></span><br><span class="line"><span class="attr">masteruser</span> <span class="string">worker</span></span><br><span class="line"><span class="comment"># 当master节点失联时，从库依然可以被客户端访问，但可能是过时的数据</span></span><br><span class="line"><span class="attr">replica-serve-stale-data</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 从库只读</span></span><br><span class="line"><span class="attr">replica-read-only</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 从库同步策略（磁盘或套接字）。主从复制过程中，新slave节点和slave节点重连后无法进行增量同步，需要进行一次全量同步，两种方式：Disk-backed（磁盘备份）、Diskless（无盘备份）。</span></span><br><span class="line"><span class="attr">repl-diskless-sync</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># 启用Diskless时，可以配置服务器等待的延迟，等待更多slave节点连接然后并行传输。这很重要，因为一旦传输开始，就不可能为新slave提供服务，这些新slave将排队等候下一次RDB传输，因此服务器会等待一段时间，以便让更多slave节点连接。</span></span><br><span class="line"><span class="attr">repl-diskless-sync-delay</span> <span class="string">5</span></span><br><span class="line"><span class="comment"># 当Diskless启用且有延迟时，如果slave节点数量达到最大值，则立即开始同步，无需达到最大延迟。默认值0表示未定义最大值，Redis将等待完整的延迟。</span></span><br><span class="line"><span class="attr">repl-diskless-sync-max-replicas</span> <span class="string">0</span></span><br><span class="line"><span class="comment"># 是否开启无盘加载，即从网络接收到 rdb 文件后，是否直接加载，而不是先全部写入磁盘文件，再加载。无盘加载因为不通过磁盘，所以速度快一点，但是因为不写入磁盘，所以在故障转移时可能会丢失数据。</span></span><br><span class="line"><span class="comment"># 副本可以直接从套接字加载它从复制链路读取的 RDB，或者将 RDB 存储到文件中，并在从主服务器完全接收到该文件后读取该文件。</span></span><br><span class="line"><span class="attr">repl-diskless-load</span> <span class="string">disabled</span></span><br><span class="line"><span class="comment"># master向salve发送PING的时间间隔</span></span><br><span class="line"><span class="attr">repl-ping-replica-period</span> <span class="string">10</span></span><br><span class="line"><span class="comment"># 复制超时时间。包括：</span></span><br><span class="line"><span class="comment"># 1、全量同步时，salve节点从发出请求到 RDB 文件接收完整的超时；</span></span><br><span class="line"><span class="comment"># 2、salve节点的视角，master节点的通信超时（比如从发给主的心跳）；</span></span><br><span class="line"><span class="comment"># 3、master节点的视角，salve节点的通信超时；</span></span><br><span class="line"><span class="comment"># 确保该值大于为 repl-ping-replica-period</span></span><br><span class="line"><span class="attr">repl-timeout</span> <span class="string">60</span></span><br><span class="line"><span class="attr">repl-disable-tcp-nodelay</span> <span class="string">no</span></span><br><span class="line"><span class="attr">replica-priority</span> <span class="string">100</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################ REDIS CLUSTER ###############################</span></span><br><span class="line"><span class="comment">#cluster-enabled yes</span></span><br><span class="line"><span class="attr">cluster-config-file</span> <span class="string">/data/local/redis/cluster/nodes-6379.conf</span></span><br><span class="line"><span class="attr">cluster-node-timeout</span> <span class="string">15000</span></span><br><span class="line"><span class="comment"># cluster-port 0</span></span><br><span class="line"><span class="comment"># cluster-replica-validity-factor 10</span></span><br><span class="line"><span class="comment"># cluster-migration-barrier 1</span></span><br><span class="line"><span class="comment"># cluster-allow-replica-migration yes</span></span><br><span class="line"><span class="comment"># 如果某一段插槽的主从都挂掉，而cluster-require-full-coverage 为yes，那么，整个集群都挂掉；</span></span><br><span class="line"><span class="comment"># 如果某一段插槽的主从都挂掉，而cluster-require-full-coverage 为no，那么，该插槽数据全都不能使用，也无法存储。</span></span><br><span class="line"><span class="attr">cluster-require-full-coverage</span> <span class="string">yes</span></span><br><span class="line"><span class="comment"># cluster-replica-no-failover no</span></span><br><span class="line"><span class="comment"># cluster-allow-reads-when-down no</span></span><br><span class="line"><span class="comment"># cluster-allow-pubsubshard-when-down yes</span></span><br><span class="line"><span class="comment"># cluster-link-sendbuf-limit 0</span></span><br><span class="line"><span class="comment"># cluster-announce-hostname &quot;&quot;</span></span><br><span class="line"><span class="comment"># cluster-announce-human-nodename &quot;&quot;</span></span><br><span class="line"><span class="comment"># cluster-preferred-endpoint-type ip</span></span><br></pre></td></tr></table></figure>

<h3 id="单例启动"><a href="#单例启动" class="headerlink" title="单例启动"></a>单例启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">服务器启动与状态检查</span></span><br><span class="line">redis-server /data/local/redis/redis_6379.conf</span><br><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>

<h3 id="客户端连接与认证"><a href="#客户端连接与认证" class="headerlink" title="客户端连接与认证"></a>客户端连接与认证</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端连接+认证</span></span><br><span class="line">redis-cli -u redis://worker:123456789@localhost:6379/0 # ACL URI 认证</span><br><span class="line">redis-cli -h localhost -p 6379 --user worker -a 123456789 -n 0 # ACL 参数认证</span><br><span class="line">redis-cli -h localhost -p 6379 -a 123456789 client list # 默认用户 default</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端连接</span></span><br><span class="line">redis-cli -h localhost -p 6379 -n 0 # 未认证连接。如果未设置 default 用户密码，则可直接连接。如果设置了密码，连接后必须在 CLI 内手动输入 auth &lt;username&gt; &lt;password&gt; 进行认证，否则无法执行redis命令。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">客户端认证</span></span><br><span class="line">auth 123456789</span><br></pre></td></tr></table></figure>

<h3 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h3><p><code>vim /etc/systemd/system/redis@.service</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">redis@.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Redis Server (%I)</span><br><span class="line">Documentation=https://zh.wikipedia.org/wiki/Systemd</span><br><span class="line">After=syslog.target network.target network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">PIDFile=/data/local/redis/pid/redis_%I.pid</span><br><span class="line">User=root</span><br><span class="line">Group=root</span><br><span class="line">ExecStart=/data/local/redis/bin/redis-server /data/local/redis/redis_%I.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">ExecReload=</span></span><br><span class="line">ExecStop=/data/local/redis/bin/redis-cli -h localhost -p %I --user worker -a 123456789 shutdown</span><br><span class="line">Restart=on-failure</span><br><span class="line">RestartSec=10s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start redis@6379.service</span><br><span class="line">systemctl enable redis@6379.service</span><br></pre></td></tr></table></figure>

<h2 id="主从模式"><a href="#主从模式" class="headerlink" title="主从模式"></a>主从模式</h2><h3 id="配置文件（slave节点）"><a href="#配置文件（slave节点）" class="headerlink" title="配置文件（slave节点）"></a>配置文件（slave节点）</h3><p>新增配置文件（slave节点）：<code>vim /data/local/redis/redis_6380.conf</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">include</span> <span class="string">/data/local/redis/redis_6379.conf</span></span><br><span class="line"></span><br><span class="line"><span class="attr">port</span> <span class="string">6380</span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">123456789</span></span><br><span class="line"><span class="attr">pidfile</span> <span class="string">/data/local/redis/pid/redis_6380.pid</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;/data/local/redis/log/redis_6380.log&quot;</span></span><br><span class="line"><span class="attr">dbfilename</span> <span class="string">dump_6380.rdb</span></span><br><span class="line"></span><br><span class="line"><span class="attr">appendfilename</span> <span class="string">&quot;appendonly_6380.aof&quot;</span></span><br><span class="line"><span class="attr">appenddirname</span> <span class="string">&quot;appendonlydir_6380&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################# REPLICATION #################################</span></span><br><span class="line"><span class="attr">replicaof</span> <span class="string">192.168.0.7 6379</span></span><br><span class="line"><span class="attr">masterauth</span> <span class="string">123456789</span></span><br><span class="line"><span class="attr">masteruser</span> <span class="string">worker</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">################################ REDIS CLUSTER  ###############################</span></span><br><span class="line"><span class="attr">cluster-config-file</span> <span class="string">/data/local/redis/cluster/nodes-6380.conf</span></span><br></pre></td></tr></table></figure>

<h2 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h2><h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p><font color="red">请在上述节点配置文件中，关闭集群模式，并配置主从关系。</font></p>
<p>编辑哨兵配置文件 <code>vim /data/local/redis/redis_sentinel_26379.conf</code>。或从解压目录复制一份哨兵配置文件后再修改：<code>cp /data/local/redis-8.4.0/sentinel.conf /data/local/redis/redis_sentinel_26379.conf</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">protected-mode</span> <span class="string">no</span></span><br><span class="line"><span class="attr">port</span> <span class="string">26379</span></span><br><span class="line"><span class="attr">daemonize</span> <span class="string">yes</span></span><br><span class="line"><span class="attr">pidfile</span> <span class="string">/data/local/redis/pid/redis_sentinel_26379.pid</span></span><br><span class="line"><span class="attr">loglevel</span> <span class="string">notice</span></span><br><span class="line"><span class="attr">logfile</span> <span class="string">&quot;/data/local/redis/log/redis_sentinel_26379.log&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 创建ACL用户</span></span><br><span class="line"><span class="attr">user</span> <span class="string">worker on ~* &amp;* +@all &gt;123456789</span></span><br><span class="line"><span class="comment"># 为哨兵的default用户设置密码</span></span><br><span class="line"><span class="attr">requirepass</span> <span class="string">123456789</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 其中 Redis-Maste 是给监控对象起的服务器名称，1 为至少有多少个哨兵同意迁移的数量。</span></span><br><span class="line"><span class="attr">sentinel</span> <span class="string">monitor mymaster 192.168.0.7 6379 1</span></span><br><span class="line"><span class="comment"># 设置连接master和slave时的密码，注意必须为主从设置一样的验证密码。</span></span><br><span class="line"><span class="attr">sentinel</span> <span class="string">auth-pass mymaster 123456789</span></span><br><span class="line"><span class="comment"># 这对于对具有ACL功能（即运行Redis6.0或更高版本）的实例进行身份验证非常有用。当仅提供auth-pass时，</span></span><br><span class="line"><span class="comment"># Sentinel实例将使用旧的“AUTH &lt;pass&gt;”方法向Redis进行身份验证。当还提供用户名时，它将使用“AUTH &lt;user&gt; &lt;pass&gt;”。</span></span><br><span class="line"><span class="attr">sentinel</span> <span class="string">auth-user mymaster worker</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># 您可以将 Sentinel 配置为使用特定用户名向其他 Sentinel 进行身份验证。</span></span><br><span class="line"><span class="attr">sentinel</span> <span class="string">sentinel-user worker</span></span><br><span class="line"><span class="comment"># 设置哨兵与其他哨兵的认证密码；（如果没有配置sentinel-user，将使用“default”用户和sentinel-pass命令进行验证）</span></span><br><span class="line"><span class="attr">sentinel</span> <span class="string">sentinel-pass 123456789</span></span><br></pre></td></tr></table></figure>

<h3 id="哨兵启动"><a href="#哨兵启动" class="headerlink" title="哨兵启动"></a>哨兵启动</h3><p><font color="red"><strong>sentinel不是数据节点，而是监控节点，所以在nodes节点无法运行select、keys等命令。</strong></font></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">redis-sentinel /data/local/redis/redis_sentinel_26379.conf</span><br><span class="line">ps -ef | grep redis</span><br><span class="line"></span><br><span class="line">redis-cli -u redis://worker:123456789@localhost:26379/0 -a 123456789 info sentinel</span><br><span class="line">redis-cli -p 26379 -a 123456789 info sentinel # 这种方式只能连接default用户</span><br><span class="line">redis-cli -p 26379 #-a 123456789 # 连接sentinel，默认端口26379</span><br><span class="line">auth sentinel-worker 123456789</span><br><span class="line">info sentinel</span><br><span class="line">acl list</span><br></pre></td></tr></table></figure>

<h3 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h3><p>反客为主后，会对原salve的配置进行rewrite（ <a target="_blank" rel="noopener" href="https://www.runoob.com/redis/server-config-rewrite.html">Redis Config rewrite 命令</a> ），而原master节点重新启动并不会成为现master节点的salve，需要重新配置。</p>
<h3 id="开机自启-1"><a href="#开机自启-1" class="headerlink" title="开机自启"></a>开机自启</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum install chkconfig # centos stream9 必须在init文件创建前安装，否则目录已存在则安装失败，可能是系统bug</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">从redis解压包复制init脚本，然后修改启动文件</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">cp</span> /data/local/redis-8.4.0/utils/redis_init_script /etc/init.d/redis</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或直接新增启动文件</span></span><br><span class="line">vim /etc/init.d/redis</span><br></pre></td></tr></table></figure>

<p>启动文件内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/sh</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"></span></span><br><span class="line"><span class="language-bash"><span class="comment"># Simple Redis init.d script conceived to work on Linux systems</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">as it does use of the /proc filesystem.</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## BEGIN INIT INFO</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Provides:     redis_6379</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Start:        2 3 4 5</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Default-Stop:         0 1 6</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Short-Description:    Redis data structure server</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Description:          Redis data structure server. See https://redis.io</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## END INIT INFO</span></span></span><br><span class="line"></span><br><span class="line">REDISPORT_6379=6379</span><br><span class="line">PIDFILE_6379=/data/local/redis/pid/redis_$&#123;REDISPORT_6379&#125;.pid</span><br><span class="line">CONF_6379=&quot;/data/local/redis/redis_$&#123;REDISPORT_6379&#125;.conf&quot;</span><br><span class="line"></span><br><span class="line">REDISPORT_6380=6380</span><br><span class="line">PIDFILE_6380=/data/local/redis/pid/redis_$&#123;REDISPORT_6380&#125;.pid</span><br><span class="line">CONF_6380=&quot;/data/local/redis/redis_$&#123;REDISPORT_6380&#125;.conf&quot;</span><br><span class="line"></span><br><span class="line">REDIS_SENTINELPORT_26379=26379</span><br><span class="line">PIDFILE_26379=/data/local/redis/pid/redis_sentinel_$&#123;REDIS_SENTINELPORT_26379&#125;.pid</span><br><span class="line">CONF_26379=&quot;/data/local/redis/redis_sentinel_$&#123;REDIS_SENTINELPORT_26379&#125;.conf&quot;</span><br><span class="line"></span><br><span class="line">EXEC=/data/local/redis/bin/redis-server</span><br><span class="line">SLEXEC=/data/local/redis/bin/redis-sentinel</span><br><span class="line">CLIEXEC=/data/local/redis/bin/redis-cli</span><br><span class="line"></span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    start)</span><br><span class="line">        if [ -f $PIDFILE_6379 ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;$PIDFILE_6379 exists, process is already running or crashed&quot;</span><br><span class="line">        else</span><br><span class="line">                echo &quot;Starting Redis $REDISPORT_6379 server...&quot;</span><br><span class="line">                $EXEC $CONF_6379</span><br><span class="line">        fi</span><br><span class="line">        </span><br><span class="line">        sleep 1</span><br><span class="line">        </span><br><span class="line">        if [ -f $PIDFILE_6380 ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;$PIDFILE_6380 exists, process is already running or crashed&quot;</span><br><span class="line">        else</span><br><span class="line">                echo &quot;Starting Redis $REDISPORT_6380 server...&quot;</span><br><span class="line">                $EXEC $CONF_6380</span><br><span class="line">        fi</span><br><span class="line">        </span><br><span class="line">        sleep 1</span><br><span class="line">        </span><br><span class="line">        if [ -f $PIDFILE_26379 ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;$PIDFILE_26379 exists, process is already running or crashed&quot;</span><br><span class="line">        else</span><br><span class="line">                echo &quot;Starting Redis $REDIS_SENTINELPORT_26379 server...&quot;</span><br><span class="line">                $SLEXEC $CONF_26379</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line">    stop)</span><br><span class="line">        if [ ! -f $PIDFILE_6379 ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;$PIDFILE_6379 does not exist, process is not running&quot;</span><br><span class="line">        else</span><br><span class="line">                PID_6379=$(cat $PIDFILE_6379)</span><br><span class="line">                echo &quot;Stopping $REDISPORT_6379 ...&quot;</span><br><span class="line">                $CLIEXEC -u redis://worker:123456789@localhost:6379/0 -a 123456789 --no-auth-warning shutdown</span><br><span class="line">                while [ -x /proc/$&#123;PID_6379&#125; ]</span><br><span class="line">                do</span><br><span class="line">                    echo &quot;Waiting for Redis $REDISPORT_6379 to shutdown ...&quot;</span><br><span class="line">                    sleep 1</span><br><span class="line">                done</span><br><span class="line">                echo &quot;Redis $REDISPORT_6379 stopped&quot;</span><br><span class="line">        fi</span><br><span class="line">        </span><br><span class="line">        sleep 1</span><br><span class="line">        </span><br><span class="line">        if [ ! -f $PIDFILE_6380 ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;$PIDFILE_6380 does not exist, process is not running&quot;</span><br><span class="line">        else</span><br><span class="line">                PID_6380=$(cat $PIDFILE_6380)</span><br><span class="line">                echo &quot;Stopping $REDISPORT_6380 ...&quot;</span><br><span class="line">                $CLIEXEC -u redis://worker:123456789@localhost:6380/0 -a 123456789 --no-auth-warning shutdown</span><br><span class="line">                while [ -x /proc/$&#123;PID_6380&#125; ]</span><br><span class="line">                do</span><br><span class="line">                    echo &quot;Waiting for Redis $REDISPORT_6380 to shutdown ...&quot;</span><br><span class="line">                    sleep 1</span><br><span class="line">                done</span><br><span class="line">                echo &quot;Redis $REDISPORT_6380 stopped&quot;</span><br><span class="line">        fi</span><br><span class="line">        </span><br><span class="line">        sleep 1</span><br><span class="line">        </span><br><span class="line">        if [ ! -f $PIDFILE_26379 ]</span><br><span class="line">        then</span><br><span class="line">                echo &quot;$PIDFILE_26379 does not exist, process is not running&quot;</span><br><span class="line">        else</span><br><span class="line">                PID_26379=$(cat $PIDFILE_26379)</span><br><span class="line">                echo &quot;Stopping $REDIS_SENTINELPORT_26379 ...&quot;</span><br><span class="line">                $CLIEXEC -u redis://worker:123456789@localhost:26379/0 -a 123456789 --no-auth-warning shutdown</span><br><span class="line">                while [ -x /proc/$&#123;PID_26379&#125; ]</span><br><span class="line">                do</span><br><span class="line">                    echo &quot;Waiting for Redis $REDIS_SENTINELPORT_26379 to shutdown ...&quot;</span><br><span class="line">                    sleep 1</span><br><span class="line">                done</span><br><span class="line">                echo &quot;Redis $REDIS_SENTINELPORT_26379 stopped&quot;</span><br><span class="line">        fi</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo &quot;Please use start or stop as first argument&quot;</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>

<p>修改文件权限</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /etc/init.d/redis</span><br></pre></td></tr></table></figure>

<p>启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service redis start</span><br><span class="line">service redis stop # 如果失败，请检查/etc/init.d/redis脚本中的redis密码</span><br></pre></td></tr></table></figure>

<p>设置开机启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置 redis 服务在运行级别为2、3、4、5时启动。--level 指定读系统服务要在哪一个Linux运行级别中开启或关闭。</span></span><br><span class="line">chkconfig --level 2345 redis on</span><br><span class="line">chkconfig --level 2345 redis off</span><br></pre></td></tr></table></figure>

<h2 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h2><p><font color="red">请在上述节点配置文件中，开启集群模式，并取消主从关系。</font></p>
<p>redisz主从集群最少需要6个节点。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /data/local/redis</span><br><span class="line">cp redis_6380.conf redis_6381.conf</span><br><span class="line">cp redis_6380.conf redis_6389.conf</span><br><span class="line">cp redis_6380.conf redis_6390.conf</span><br><span class="line">cp redis_6380.conf redis_6391.conf</span><br></pre></td></tr></table></figure>

<p>修改配置文件，启动6个服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">redis-server /data/local/redis/redis_6379.conf</span><br><span class="line">redis-server /data/local/redis/redis_6380.conf</span><br><span class="line">redis-server /data/local/redis/redis_6381.conf</span><br><span class="line">redis-server /data/local/redis/redis_6389.conf</span><br><span class="line">redis-server /data/local/redis/redis_6390.conf</span><br><span class="line">redis-server /data/local/redis/redis_6391.conf</span><br></pre></td></tr></table></figure>

<p>redis-trib.rb 是官方提供的Redis Cluster的管理工具，无需额外下载，默认位于源码包的src目录下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">将六个节点合成一个集群，组合之前，请确保所有redis实例启动后，nodes-xxxx.conf文件都生成正常。</span></span><br><span class="line"></span><br><span class="line">cd /data/local/redis-8.4.0/src/ # 必须在此目录下执行</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">此处不要用127.0.0.1，请用真实IP地址</span></span><br><span class="line">redis-cli --cluster create --cluster-replicas 1 -a 123456789 \</span><br><span class="line">192.168.0.7:6379 \</span><br><span class="line">192.168.0.7:6380 \</span><br><span class="line">192.168.0.7:6381 \</span><br><span class="line">192.168.0.7:6389 \</span><br><span class="line">192.168.0.7:6390 \</span><br><span class="line">192.168.0.7:6391</span><br></pre></td></tr></table></figure>

<p><font color="red"><strong>Redis集群的不足</strong></font></p>
<p>多键操作是不被支持的 </p>
<p>多键的Redis事务是不被支持的。lua脚本不被支持</p>
<p>由于集群方案出现较晚，很多公司已经采用了其他的集群方案，而代理或者客户端分片的方案想要迁移至redis cluster，需要整体迁移而不是逐步过渡，复杂度较大。</p>
<h1 id="Redis五种数据类型"><a href="#Redis五种数据类型" class="headerlink" title="Redis五种数据类型"></a>Redis五种数据类型</h1><p><font color="red">Redis 没有专门的整数类型</font></p>
<h2 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a><a target="_blank" rel="noopener" href="https://redis.io/docs/data-types/strings/">String（字符串）</a></h2><p><font color="red">string 是 redis 最基本的数据类型，一个 key 对应一个 value。</font></p>
<p>string 类型是二进制安全的。意思是 redis 的 string 可以包含任何数据。比如jpg图片或者序列化的对象。</p>
<p><font size="5"><strong>基本命令</strong></font> </p>
<p>请参阅<a target="_blank" rel="noopener" href="https://redis.io/commands/?group=string">字符串命令的完整列表</a>。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/set"><code>SET</code></a>存储一个字符串值。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/setnx"><code>SETNX</code></a>仅当键不存在时才存储字符串值。用于实现锁。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/get"><code>GET</code></a>检索字符串值。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/mget"><code>MGET</code></a>在单个操作中检索多个字符串值。</li>
</ul>
<p><font size="5"><strong>指标管理</strong></font> </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/incrby"><code>INCRBY</code></a>原子地递增（并在传递负数时递减）存储在给定键处的计数器。</li>
<li>浮点计数器存在另一个命令：<a target="_blank" rel="noopener" href="https://redis.io/commands/incrbyfloat">INCRBYFLOAT</a>。</li>
</ul>
<p><font size="5"><strong>按位运算</strong></font> </p>
<p>要对字符串执行按位运算，请参阅<a target="_blank" rel="noopener" href="https://redis.io/docs/data-types/bitmaps">位图数据类型</a>文档。</p>
<p><font size="5"><strong>表现</strong></font> </p>
<p>大多数字符串操作都是O(1)，这意味着它们的效率很高。但是，请小心使用<a target="_blank" rel="noopener" href="https://redis.io/commands/substr"><code>SUBSTR</code></a>复杂<a target="_blank" rel="noopener" href="https://redis.io/commands/getrange"><code>GETRANGE</code></a>度<a target="_blank" rel="noopener" href="https://redis.io/commands/setrange"><code>SETRANGE</code></a>命令，这些命令可以是O(n)。这些随机访问字符串命令在处理大字符串时可能会导致性能问题。</p>
<p><font size="5"><strong>限制</strong></font> </p>
<p>默认情况下，单个 Redis 字符串最大为 <font color="red"><strong>512MB</strong></font>。</p>
<p><font size="5"><strong>例子</strong></font> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">del mykey</span><br><span class="line">set mykey &quot;Hello\nWorld&quot;</span><br><span class="line">OK</span><br><span class="line">get mykey</span><br></pre></td></tr></table></figure>

<h2 id="List（列表）"><a href="#List（列表）" class="headerlink" title="List（列表）"></a><a target="_blank" rel="noopener" href="https://redis.io/docs/data-types/lists/">List（列表）</a></h2><p>Redis 列表是简单的字符串列表，按照插入顺序排序。可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p>
<p>每个列表最多可存储 2<sup>32</sup> - 1 个元素（<font color="red"><strong>40多亿</strong></font>）。</p>
<p>Redis 列表经常用于：</p>
<ul>
<li>实现栈和队列。</li>
<li>为后台工作系统构建队列管理。</li>
</ul>
<p><font size="5"><strong>基本命令</strong></font> </p>
<p>请参阅<a target="_blank" rel="noopener" href="https://redis.io/commands/?group=list">完整的列表命令系列</a>。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/lpush"><code>LPUSH</code></a>添加一个新元素到列表的头部；<a target="_blank" rel="noopener" href="https://redis.io/commands/rpush"><code>RPUSH</code></a>添加到尾巴。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/lpop"><code>LPOP</code></a>从列表的头部移除并返回一个元素；<a target="_blank" rel="noopener" href="https://redis.io/commands/rpop"><code>RPOP</code></a>做同样的事情，但从列表的尾部开始。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/llen"><code>LLEN</code></a>返回列表的长度。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/lmove"><code>LMOVE</code></a>原子地将元素从一个列表移动到另一个列表。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/ltrim"><code>LTRIM</code></a>将列表减少到指定的元素范围。</li>
</ul>
<p><font size="5"><strong>阻塞命令</strong></font> </p>
<p>列表支持多种阻塞命令。例如：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/blpop"><code>BLPOP</code></a>从列表的头部移除并返回一个元素。如果列表为空，则命令将阻塞，直到元素可用或达到指定的超时为止。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/blmove"><code>BLMOVE</code></a>原子地将元素从源列表移动到目标列表。如果源列表为空，则该命令将阻塞，直到有新元素可用为止。</li>
</ul>
<p><font size="5"><strong>表现</strong></font> </p>
<p>访问其头部或尾部的列表操作的复杂度为 O(1)，这意味着它们非常高效。但是，操作列表中元素的命令通常是 O(n)。这些示例包括<a target="_blank" rel="noopener" href="https://redis.io/commands/lindex"><code>LINDEX</code></a>、<a target="_blank" rel="noopener" href="https://redis.io/commands/linsert"><code>LINSERT</code></a>和<a target="_blank" rel="noopener" href="https://redis.io/commands/lset"><code>LSET</code></a>。运行这些命令时要小心，特别是在对大型列表进行操作时。</p>
<p><font size="5"><strong>限制</strong></font> </p>
<p>List的最大长度为 2<sup>32</sup> - 1（<font color="red"><strong>40多亿</strong></font>）。</p>
<p><font size="5"><strong>例子</strong></font> </p>
<p>将列表视为队列（先进先出）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">del ids</span><br><span class="line">lpush work:queue:ids 1</span><br><span class="line">lpush work:queue:ids 2</span><br><span class="line">lpush work:queue:ids 3</span><br><span class="line"></span><br><span class="line">rpop work:queue:ids</span><br><span class="line">&quot;1&quot;</span><br><span class="line">rpop work:queue:ids</span><br><span class="line">&quot;2&quot;</span><br></pre></td></tr></table></figure>

<p>将列表视为堆栈（先进后出）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">del ids</span><br><span class="line">lpush work:queue:ids 1</span><br><span class="line">lpush work:queue:ids 2</span><br><span class="line">lpush work:queue:ids 3</span><br><span class="line"></span><br><span class="line">lpop work:queue:ids</span><br><span class="line">&quot;3&quot;</span><br><span class="line">lpop work:queue:ids</span><br><span class="line">&quot;2&quot;</span><br></pre></td></tr></table></figure>

<p>检查列表的长度：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">llen work:queue:ids</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>创建一个上限为100个元素的列表，可以在每次调用 <strong>LPUSH</strong> 后调用 <strong>LTRIM</strong> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lpush notifications:user:1 &quot;You&#x27;ve got mail!&quot;</span><br><span class="line">ltrim notifications:user:1 0 99</span><br><span class="line">lpush notifications:user:1 &quot;Your package will be delivered at 12:01 today.&quot;</span><br><span class="line">ltrim notifications:user:1 0 99</span><br></pre></td></tr></table></figure>

<h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a><a target="_blank" rel="noopener" href="https://redis.io/docs/data-types/sets/">Set（集合）</a></h2><p>Redis 的 Set 是<font color="red"><strong>唯一</strong></font> string 类型元素的<font color="red"><strong>无序集合</strong></font>。</p>
<p>可以使用 Redis 集来高效地：</p>
<ul>
<li>跟踪唯一项目（例如，跟踪访问给定博客文章的所有唯一 IP 地址）。</li>
<li>表示关系（例如，具有给定角色的所有用户的集合）。</li>
<li>执行常见的集合运算，例如交集、并集和差集。</li>
</ul>
<p><font size="5"><strong>基本命令</strong></font> </p>
<p>请参阅<a target="_blank" rel="noopener" href="https://redis.io/commands/?group=set">set 命令的完整列表</a>。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/sadd"><code>SADD</code></a>将新成员添加到集合中。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/srem"><code>SREM</code></a>从集合中删除指定的成员。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/sismember"><code>SISMEMBER</code></a>测试集合成员的字符串。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/sinter"><code>SINTER</code></a>返回两个或多个集合共有的成员集合（即交集）。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/scard"><code>SCARD</code></a>返回集合的大小（又名基数）。</li>
</ul>
<p><font size="5"><strong>表现</strong></font> </p>
<p>集合是通过哈希表实现的，所以大多数集合操作，包括添加、删除和检查项是否为集合成员，复杂度都是O(1)。这意味着它们的效率很高。</p>
<p>但是，对于具有数十万或更多成员的大型集，在运行 <strong>SMEMBERS 命令</strong>时，应<strong>谨慎</strong>行事。此命令为O(n)，并在单个响应中返回整个集合。作为另一种选择，可以考虑SSCAN，它允许您迭代地检索集合的所有成员。</p>
<p><font size="5"><strong>限制</strong></font> </p>
<p>每个集合的最大成员数为 2<sup>32</sup> - 1（<font color="red"><strong>40多亿</strong></font>）。</p>
<p><font size="5"><strong>例子</strong></font> </p>
<p>存储用户 123 和 456 的收藏书 ID 集：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sadd user:123:favorites 347</span><br><span class="line">sadd user:123:favorites 561</span><br><span class="line">sadd user:123:favorites 742</span><br><span class="line">sadd user:456:favorites 561</span><br><span class="line"></span><br><span class="line">sadd user:456:favorites 99999</span><br><span class="line">srem user:456:favorites 99999</span><br></pre></td></tr></table></figure>

<p>检查用户 123 是否喜欢书籍 742 和 299</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sismember user:123:favorites 742</span><br><span class="line">sismember user:123:favorites 299</span><br></pre></td></tr></table></figure>

<p>用户 123 和 456 有没有共同喜欢的书？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sinter user:123:favorites user:456:favorites</span><br></pre></td></tr></table></figure>

<p>用户 123 收藏了多少本书？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scard <span class="keyword">user</span>:<span class="number">123</span>:favorites</span><br></pre></td></tr></table></figure>

<h2 id="Hash（哈希）"><a href="#Hash（哈希）" class="headerlink" title="Hash（哈希）"></a><a target="_blank" rel="noopener" href="https://redis.io/docs/data-types/hashes/">Hash（哈希）</a></h2><p>Redis hash 是一个键值对集合 (key&#x3D;&gt;value)。</p>
<p>Redis hash 是一个 string 类型的 field 和 value 的映射表（field&#x3D;&gt;value对），hash 特别适合用于<font color="red"><strong>存储对象</strong></font>。</p>
<p><font size="5"><strong>基本命令</strong></font> </p>
<p>请参阅<a target="_blank" rel="noopener" href="https://redis.io/commands/?group=hash">哈希命令的完整列表</a>。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/hset"><code>HSET</code></a>设置散列上一个或多个字段的值。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/hget"><code>HGET</code></a>返回给定字段的值。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/hmget"><code>HMGET</code></a>返回一个或多个给定字段的值。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/hincrby"><code>HINCRBY</code></a>通过提供的整数，增加给定字段的值。</li>
</ul>
<p><font size="5"><strong>表现</strong></font> </p>
<p>大多数 Redis 哈希命令的复杂度为 O(1)。</p>
<p>一些命令 - 例如<a target="_blank" rel="noopener" href="https://redis.io/commands/hkeys"><code>HKEYS</code></a>、<a target="_blank" rel="noopener" href="https://redis.io/commands/hvals"><code>HVALS</code></a>和<a target="_blank" rel="noopener" href="https://redis.io/commands/hgetall"><code>HGETALL</code></a>- 是 O(n)，其中<em>n</em>是字段值对的数量。</p>
<p><font size="5"><strong>限制</strong></font> </p>
<p>每个 hash 可以存储  2<sup>32</sup> - 1 个  <font color="red"><strong>键值对</strong></font>（<font color="red"><strong>40多亿</strong></font>）。实际上，仅受托管 Redis 部署的 VM 上的总内存的限制。</p>
<p><font size="5"><strong>例子</strong></font> </p>
<p>将用户对象存储为散列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">del zhangsan</span><br><span class="line">hset zhangsan sno 2022020037 name zhagnsan age 18 sex 1</span><br><span class="line">hget zhangsan sno</span><br><span class="line">hgetall zhangsan</span><br></pre></td></tr></table></figure>

<p>存储设备 777 对服务器执行 ping 操作、发送错误或发出请求的次数的计数器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">del device:777:stats</span><br><span class="line">hincrby device:777:stats pings 1 # key为pings的value加1</span><br><span class="line">hincrby device:777:stats pings 1 </span><br><span class="line">hincrby device:777:stats pings 10 # key为pings的value加10</span><br><span class="line"></span><br><span class="line">hincrby device:777:stats errors 1 # key为errors的value加1</span><br><span class="line"></span><br><span class="line">hincrby device:777:stats requests 1 # key为requests的value加1</span><br></pre></td></tr></table></figure>

<h2 id="zset-sorted-set：有序集合"><a href="#zset-sorted-set：有序集合" class="headerlink" title="zset(sorted set：有序集合)"></a><a target="_blank" rel="noopener" href="https://redis.io/docs/data-types/sorted-sets/">zset(sorted set：有序集合)</a></h2><p>Redis zset 和 set 一样，也是<font color="red"><strong>唯一</strong></font> string 类型元素的集合。</p>
<p>不同的是，每个元素都会关联一个double类型的<font color="red"><strong>分数</strong></font>，通过分数为集合中的成员<font color="red"><strong>排序</strong></font>（从大到小）。成员是唯一，分数(score)却可以重复。</p>
<p>当多个字符串具有相同的分数时，字符串按字典顺序排列。zset 的示例：</p>
<ul>
<li>排行榜。使用排序集轻松维护大型在线游戏中最高分的有序列表。</li>
<li>速率限制器。使用 zset 来构建滑动窗口速率限制器，以防止过多的 API 请求。</li>
</ul>
<p><font size="5"><strong>基本命令</strong></font> </p>
<p>请参阅<a target="_blank" rel="noopener" href="https://redis.io/commands/?group=sorted-set">排序集命令的完整列表</a>。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/zadd"><code>ZADD</code></a>将新成员和关联的分数添加到已排序的集合中。如果该成员已经存在，则更新分数。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/zrange"><code>ZRANGE</code></a>返回在给定范围内排序的有序集合的成员。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/zrank"><code>ZRANK</code></a>返回所提供成员的排名，假设排序是按升序排列。</li>
<li><a target="_blank" rel="noopener" href="https://redis.io/commands/zrevrank"><code>ZREVRANK</code></a>返回所提供成员的排名，假设排序集按降序排列。</li>
</ul>
<p><font size="5"><strong>表现</strong></font> </p>
<p>大多数有序集合操作的复杂度为 O(log(n))，其中<em>n</em>是成员数。</p>
<p><a target="_blank" rel="noopener" href="https://redis.io/commands/zrange"><code>ZRANGE</code></a>运行具有较大返回值（例如，数万或更多）的命令时要小心。此命令的时间复杂度为 O(log(n) + m)，其中<em>m</em>是返回的结果数。</p>
<p><font size="5"><strong>备择方案</strong></font> </p>
<p>Redis 排序集有时用于索引其他 Redis 数据结构。如果您需要索引和查询您的数据，请考虑<a target="_blank" rel="noopener" href="https://redis.io/docs/stack/search">RediSearch</a>和<a target="_blank" rel="noopener" href="https://redis.io/docs/stack/json">RedisJSON</a>。</p>
<p><font size="5"><strong>限制</strong></font> </p>
<p>每个集合的最大成员数为 2<sup>32</sup> - 1（<font color="red"><strong>40多亿</strong></font>）。</p>
<p><font size="5"><strong>例子</strong></font> </p>
<p>随着玩家分数的变化更新实时排行榜</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ZADD leaderboard:455 100 user:1</span><br><span class="line">ZADD leaderboard:455 75 user:2</span><br><span class="line">ZADD leaderboard:455 101 user:3</span><br><span class="line">ZADD leaderboard:455 15 user:4</span><br><span class="line">ZADD leaderboard:455 275 user:2</span><br><span class="line"></span><br><span class="line"># 请注意，在最后一次调用user:2中更新了 score 。ZADD</span><br></pre></td></tr></table></figure>

<p>获取前 3 名玩家的分数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ZRANGE leaderboard:455 0 2 REV WITHSCORES</span><br><span class="line">1) &quot;user:2&quot;</span><br><span class="line">2) &quot;275&quot;</span><br><span class="line">3) &quot;user:3&quot;</span><br><span class="line">4) &quot;101&quot;</span><br><span class="line">5) &quot;user:1&quot;</span><br><span class="line">6) &quot;100&quot;</span><br></pre></td></tr></table></figure>

<p>用户 2 的排名是多少？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZREVRANK leaderboard:455 user:2</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="zhaolq 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="zhaolq 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/article/2020/05/Linux%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/" rel="prev" title="Linux磁盘管理">
                  <i class="fa fa-angle-left"></i> Linux磁盘管理
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/article/2020/10/01-JVM%E4%B8%8EJava%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/" rel="next" title="01-JVM与Java体系结构">
                  01-JVM与Java体系结构 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2019 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">zhaolq</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
